<!-- HTML header for doxygen 1.8.20--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type">
<meta content="IE=9" http-equiv="X-UA-Compatible">
<meta content="Doxygen 1.8.20" name="generator">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>libcuspatial: Unit Testing in libcuspatial</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<script src="jquery.js" type="text/javascript"></script>
<script src="dynsections.js" type="text/javascript"></script>
<link href="search/search.css" rel="stylesheet" type="text/css">
<script src="search/searchdata.js" type="text/javascript"></script>
<script src="search/search.js" type="text/javascript"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<!-- RAPIDS CUSTOM JS & CSS: START, Please add these two lines back after every version upgrade -->
<script defer="" src="https://docs.rapids.ai/assets/js/custom.js"></script>
<link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet">
<!-- RAPIDS CUSTOM JS & CSS: END -->
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" id="rapids-fa-tag" rel="stylesheet"><script id="rapids-selector-pixel-src" src="https://assets.adobedtm.com/5d4962a43b79/814eb6e9b4e1/launch-4bc07f1e0b0b.min.js"></script><link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea"><div id="rapids-doxygen-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">libcuspatial</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/nightly">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/libcuspatial/stable">libcuspatial</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">legacy (22.10)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/libcuspatial/nightly">nightly (23.02)</a><a class="rapids-selector__menu-item" href="/api/libcuspatial/stable">stable (22.12)</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/libcuspatial/legacy">legacy (22.10)</a></div></div></div>

</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script src="menudata.js" type="text/javascript"></script>
<script src="menu.js" type="text/javascript"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Unit Testing in libcuspatial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Unit tests in libcuspatial are written using <a href="https://github.com/google/googletest/blob/master/docs/primer.md">Google Test</a>.</p>
<h1><a class="anchor" id="autotoc_md70"></a>
Best Practices: What Should We Test?</h1>
<p>In general we should test to make sure all code paths are covered. This is not always easy or possible. But generally this means we test all supported combinations of algorithms and data types, and the main iterator and container types supported by algorithms. Here are some other guidelines.</p>
<ul>
<li>Test public APIs. Try to ensure that public API tests result in 100% coverage of libcuspatial code (including internal details and utilities).</li>
<li>Test exceptional cases. For example, anything that causes the function to <code>throw</code>.</li>
<li>Test boundary cases. For example points that fall exactly on lines or boundaries.</li>
<li>In general empty input is not an error in libcuspatial. Typically empty input results in empty output. Tests should verify this.</li>
<li>Most algorithms should have one or more tests exercising inputs with a large enough number of rows to require launching multiple thread blocks, especially when values are ultimately communicated between blocks (e.g. reductions). This is especially important for custom kernels but also applies to Thrust and CUB algorithm calls with lambdas / functors.</li>
</ul>
<h1><a class="anchor" id="autotoc_md71"></a>
Header-only and Column-based API tests</h1>
<p>libcuspatial currently has two C++ APIs: the column-based API uses libcudf data structures as input and output. These tests live in <code>cpp/tests/</code> and can use libcudf features for constructing columns and tables. The header-only API does not depend on libcudf at all and so tests of these APIs should not include any libcudf headers. These tests currently live in <code>cpp/tests/experimental</code>.</p>
<p>Generally, we test algorithms and business logic in the header-only API's unit tests. Column-based API tests should only cover specifics of the column-based API, such as type handling, input validation, and exceptions that are only thrown by that API.</p>
<h1><a class="anchor" id="autotoc_md72"></a>
Directory and File Naming</h1>
<p>The naming of unit test directories and source files should be consistent with the feature being tested. For example, the tests for APIs in <code><a class="el" href="point__in__polygon_8hpp.html">point_in_polygon.hpp</a></code> should live in <code>cuspatial/cpp/tests/point_in_polygon_test.cpp</code>. Each feature (or set of related features) should have its own test source file named <code>&lt;feature&gt;_test.cu/cpp</code>.</p>
<p>In the interest of improving compile time, whenever possible, test source files should be <code>.cpp</code> files because <code>nvcc</code> is slower than <code>gcc</code> in compiling host code. Note that <code>thrust::device_vector</code> includes device code, and so must only be used in <code>.cu</code> files. <code>rmm::device_uvector</code>, <code>rmm::device_buffer</code> and the various <code>column_wrapper</code> types described later can be used in <code>.cpp</code> files, and are therefore preferred in test code over <code>thrust::device_vector</code>.</p>
<p>Testing header-only APIs requires CUDA compilation so should be done in <code>.cu</code> files.</p>
<h1><a class="anchor" id="autotoc_md73"></a>
Base Fixture</h1>
<p>All libcuspatial unit tests should make use of a GTest <a href="https://github.com/google/googletest/blob/master/docs/primer.md#test-fixtures-using-the-same-data-configuration-for-multiple-tests-same-data-multiple-tests">"Test Fixture"</a>. Even if the fixture is empty, it should inherit from the base fixture <code>cuspatial::test::BaseFixture</code> found in <code>cpp/tests/base_fixture.hpp</code>. This ensures that RMM is properly initialized and finalized. <code>cuspatial::test::BaseFixture</code> already inherits from <code>testing::Test</code> and therefore it is not necessary for your test fixtures to inherit from it.</p>
<p>Example: </p><pre class="fragment">class MyTestFixture : public cuspatial::test::BaseFixture {...};
</pre><h1><a class="anchor" id="autotoc_md74"></a>
Typed Tests</h1>
<p>In general, libcuspatial features must work across all supported types (for cuspatial this typically just means <code>float</code> and <code>double</code>). In order to automate the process of running the same tests across multiple types, we use GTest's <a href="https://github.com/google/googletest/blob/master/docs/advanced.md#typed-tests">Typed Tests</a>. Typed tests allow you to write a test once and run it across a list of types.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Fixture must be a template</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>TypedTestFixture : cuspatial::test::BaseFixture {...};</div>
<div class="line"><span class="keyword">using</span> TestTypes = ::test::types&lt;float,double&gt;; <span class="comment">// Notice custom cudf type list type</span></div>
<div class="line">TYPED_TEST_SUITE(TypedTestFixture, TestTypes);</div>
<div class="line">TYPED_TEST(TypedTestFixture, FirstTest){</div>
<div class="line">    <span class="comment">// Access the current type using `TypeParam`</span></div>
<div class="line">    <span class="keyword">using</span> T = TypeParam;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this example, all tests using the <code>TypedTestFixture</code> fixture will run once for each type in the list defined in <code>TestTypes</code> (<code>float, double</code>).</p>
<h1><a class="anchor" id="autotoc_md75"></a>
Utilities</h1>
<p>libcuspatial test utilities include <code>cuspatial::test::expect_vector_equivalent()</code> in <code>cpp/tests/utility/vector_equality()</code>. This function compares two containers using Google Test's approximate matching for floating-point values. It can handle vectors of <code><a class="el" href="structcuspatial_1_1vec__2d.html" title="A generic 2D vector type.">cuspatial::vec_2d</a>&lt;T&gt;</code>, where <code>T</code> is <code>float</code> or <code>double</code>. It automatically copies data in device containers to host containers before comparing, so you can pass it one host and one device vector, for example.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> h_expected = std::vector&lt;cuspatial::vec_2d&lt;float&gt;&gt;{...}; <span class="comment">// expected values</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> d_actual = rmm::device_vector&lt;cuspatial::vec_2d&lt;float&gt;&gt;{...}; <span class="comment">// actual computed values</span></div>
<div class="line"> </div>
<div class="line">cuspatial::test::expect_vector_equivalent(h_expected, d_actual);</div>
</div><!-- fragment --><p>Before creating your own test utilities, look to see if one already exists that does what you need. If not, consider adding a new utility to do what you need. However, make sure that the utility is generic enough to be useful for other tests and is not overly tailored to your specific testing need. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"><address class="footer"><small>
Generated by&nbsp;<a href="http://www.doxygen.org/index.html"><img alt="doxygen" class="footer" height="31" src="doxygen.svg" width="104"></a> 1.8.20
</small></address>


<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script><script id="rapids-selector-pixel-invocation" type="text/javascript">_satellite.pageBottom();</script></body></html>