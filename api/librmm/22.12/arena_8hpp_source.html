<!-- HTML header for doxygen 1.8.20--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type">
<meta content="IE=9" http-equiv="X-UA-Compatible">
<meta content="Doxygen 1.8.20" name="generator">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>RMM: arena.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<script src="jquery.js" type="text/javascript"></script>
<script src="dynsections.js" type="text/javascript"></script>
<link href="search/search.css" rel="stylesheet" type="text/css">
<script src="search/searchdata.js" type="text/javascript"></script>
<script src="search/search.js" type="text/javascript"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<!-- RAPIDS CUSTOM JS & CSS: START, Please add these two lines back after every version upgrade -->
<script defer src="https://docs.rapids.ai/assets/js/custom.js"></script>
<link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet">
<!-- RAPIDS CUSTOM JS & CSS: END -->
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" id="rapids-fa-tag" rel="stylesheet"><script id="rapids-selector-pixel-src" src="https://assets.adobedtm.com/5d4962a43b79/814eb6e9b4e1/launch-4bc07f1e0b0b.min.js"></script><link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea"><div id="rapids-doxygen-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">librmm</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libcuspatial/stable">libcuspatial</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">legacy (22.12)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/librmm/nightly/annotated.html">nightly (23.04)</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">stable (23.02)</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/librmm/legacy/annotated.html">legacy (22.12)</a></div></div></div>

</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script src="menudata.js" type="text/javascript"></script>
<script src="menu.js" type="text/javascript"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)">
</iframe>
</div>

<div class="navpath" id="nav-path">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_5337baf0b33a4669aff4110e3e3840c1.html">rmm</a></li><li class="navelem"><a class="el" href="dir_ae5c469e7b915eb6e477229fa888af20.html">mr</a></li><li class="navelem"><a class="el" href="dir_f1ed285de97e886a5c5f9bcf93707a3b.html">device</a></li><li class="navelem"><a class="el" href="dir_451ff660feb5839939aca8d015f8b8db.html">detail</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">arena.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&nbsp;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&nbsp;<span class="comment"> * Copyright (c) 2019-2022, NVIDIA CORPORATION.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&nbsp;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&nbsp;<span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License");</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&nbsp;<span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&nbsp;<span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&nbsp;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&nbsp;<span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&nbsp;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&nbsp;<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&nbsp;<span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&nbsp;<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&nbsp;<span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&nbsp;<span class="comment"> * limitations under the License.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&nbsp;<span class="comment"> */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&nbsp; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&nbsp;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&nbsp; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&nbsp;<span class="preprocessor">#include &lt;rmm/cuda_stream_view.hpp&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&nbsp;<span class="preprocessor">#include &lt;rmm/detail/aligned.hpp&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&nbsp;<span class="preprocessor">#include &lt;rmm/detail/cuda_util.hpp&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&nbsp;<span class="preprocessor">#include &lt;rmm/detail/error.hpp&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&nbsp;<span class="preprocessor">#include &lt;rmm/logger.hpp&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&nbsp; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&nbsp;<span class="preprocessor">#include &lt;cuda_runtime_api.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&nbsp; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&nbsp;<span class="preprocessor">#include &lt;spdlog/common.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&nbsp;<span class="preprocessor">#include &lt;spdlog/fmt/ostr.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&nbsp; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&nbsp;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&nbsp;<span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&nbsp;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&nbsp;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&nbsp;<span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&nbsp;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&nbsp;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&nbsp;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&nbsp; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&nbsp;<span class="keyword">namespace </span>rmm::mr::detail::arena {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&nbsp; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&nbsp;<span class="keyword">inline</span> std::size_t align_to_size_class(std::size_t value) noexcept</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&nbsp;{</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&nbsp;  <span class="comment">// See http://jemalloc.net/jemalloc.3.html.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&nbsp;  <span class="comment">// NOLINTBEGIN(readability-magic-numbers,cppcoreguidelines-avoid-magic-numbers)</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&nbsp;  <span class="keyword">static</span> std::array&lt;std::size_t, 117&gt; size_classes{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&nbsp;    <span class="comment">// clang-format off</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&nbsp;    <span class="comment">// Spacing 256:</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&nbsp;    256UL, 512UL, 768UL, 1024UL, 1280UL, 1536UL, 1792UL, 2048UL,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&nbsp;    <span class="comment">// Spacing 512:</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&nbsp;    2560UL, 3072UL, 3584UL, 4096UL,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&nbsp;    <span class="comment">// Spacing 1 KiB:</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&nbsp;    5UL &lt;&lt; 10, 6UL &lt;&lt; 10, 7UL &lt;&lt; 10, 8UL &lt;&lt; 10,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&nbsp;    <span class="comment">// Spacing 2 KiB:</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&nbsp;    10UL &lt;&lt; 10, 12UL &lt;&lt; 10, 14UL &lt;&lt; 10, 16UL &lt;&lt; 10,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&nbsp;    <span class="comment">// Spacing 4 KiB:</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&nbsp;    20UL &lt;&lt; 10, 24UL &lt;&lt; 10, 28UL &lt;&lt; 10, 32UL &lt;&lt; 10,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&nbsp;    <span class="comment">// Spacing 8 KiB:</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&nbsp;    40UL &lt;&lt; 10, 48UL &lt;&lt; 10, 54UL &lt;&lt; 10, 64UL &lt;&lt; 10,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&nbsp;    <span class="comment">// Spacing 16 KiB:</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&nbsp;    80UL &lt;&lt; 10, 96UL &lt;&lt; 10, 112UL &lt;&lt; 10, 128UL &lt;&lt; 10,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&nbsp;    <span class="comment">// Spacing 32 KiB:</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&nbsp;    160UL &lt;&lt; 10, 192UL &lt;&lt; 10, 224UL &lt;&lt; 10, 256UL &lt;&lt; 10,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&nbsp;    <span class="comment">// Spacing 64 KiB:</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&nbsp;    320UL &lt;&lt; 10, 384UL &lt;&lt; 10, 448UL &lt;&lt; 10, 512UL &lt;&lt; 10,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&nbsp;    <span class="comment">// Spacing 128 KiB:</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&nbsp;    640UL &lt;&lt; 10, 768UL &lt;&lt; 10, 896UL &lt;&lt; 10, 1UL &lt;&lt; 20,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&nbsp;    <span class="comment">// Spacing 256 KiB:</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&nbsp;    1280UL &lt;&lt; 10, 1536UL &lt;&lt; 10, 1792UL &lt;&lt; 10, 2UL &lt;&lt; 20,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&nbsp;    <span class="comment">// Spacing 512 KiB:</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&nbsp;    2560UL &lt;&lt; 10, 3UL &lt;&lt; 20, 3584UL &lt;&lt; 10, 4UL &lt;&lt; 20,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&nbsp;    <span class="comment">// Spacing 1 MiB:</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&nbsp;    5UL &lt;&lt; 20, 6UL &lt;&lt; 20, 7UL &lt;&lt; 20, 8UL &lt;&lt; 20,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&nbsp;    <span class="comment">// Spacing 2 MiB:</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&nbsp;    10UL &lt;&lt; 20, 12UL &lt;&lt; 20, 14UL &lt;&lt; 20, 16UL &lt;&lt; 20,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&nbsp;    <span class="comment">// Spacing 4 MiB:</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&nbsp;    20UL &lt;&lt; 20, 24UL &lt;&lt; 20, 28UL &lt;&lt; 20, 32UL &lt;&lt; 20,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&nbsp;    <span class="comment">// Spacing 8 MiB:</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&nbsp;    40UL &lt;&lt; 20, 48UL &lt;&lt; 20, 56UL &lt;&lt; 20, 64UL &lt;&lt; 20,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&nbsp;    <span class="comment">// Spacing 16 MiB:</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&nbsp;    80UL &lt;&lt; 20, 96UL &lt;&lt; 20, 112UL &lt;&lt; 20, 128UL &lt;&lt; 20,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&nbsp;    <span class="comment">// Spacing 32 MiB:</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&nbsp;    160UL &lt;&lt; 20, 192UL &lt;&lt; 20, 224UL &lt;&lt; 20, 256UL &lt;&lt; 20,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&nbsp;    <span class="comment">// Spacing 64 MiB:</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&nbsp;    320UL &lt;&lt; 20, 384UL &lt;&lt; 20, 448UL &lt;&lt; 20, 512UL &lt;&lt; 20,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&nbsp;    <span class="comment">// Spacing 128 MiB:</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&nbsp;    640UL &lt;&lt; 20, 768UL &lt;&lt; 20, 896UL &lt;&lt; 20, 1UL &lt;&lt; 30,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&nbsp;    <span class="comment">// Spacing 256 MiB:</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&nbsp;    1280UL &lt;&lt; 20, 1536UL &lt;&lt; 20, 1792UL &lt;&lt; 20, 2UL &lt;&lt; 30,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&nbsp;    <span class="comment">// Spacing 512 MiB:</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&nbsp;    2560UL &lt;&lt; 20, 3UL &lt;&lt; 30, 3584UL &lt;&lt; 20, 4UL &lt;&lt; 30,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&nbsp;    <span class="comment">// Spacing 1 GiB:</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&nbsp;    5UL &lt;&lt; 30, 6UL &lt;&lt; 30, 7UL &lt;&lt; 30, 8UL &lt;&lt; 30,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&nbsp;    <span class="comment">// Spacing 2 GiB:</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&nbsp;    10UL &lt;&lt; 30, 12UL &lt;&lt; 30, 14UL &lt;&lt; 30, 16UL &lt;&lt; 30,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&nbsp;    <span class="comment">// Spacing 4 GiB:</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&nbsp;    20UL &lt;&lt; 30, 24UL &lt;&lt; 30, 28UL &lt;&lt; 30, 32UL &lt;&lt; 30,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&nbsp;    <span class="comment">// Spacing 8 GiB:</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&nbsp;    40UL &lt;&lt; 30, 48UL &lt;&lt; 30, 56UL &lt;&lt; 30, 64UL &lt;&lt; 30,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&nbsp;    <span class="comment">// Spacing 16 GiB:</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&nbsp;    80UL &lt;&lt; 30, 96UL &lt;&lt; 30, 112UL &lt;&lt; 30, 128UL &lt;&lt; 30,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&nbsp;    <span class="comment">// Spacing 32 Gib:</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&nbsp;    160UL &lt;&lt; 30, 192UL &lt;&lt; 30, 224UL &lt;&lt; 30, 256UL &lt;&lt; 30,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&nbsp;    <span class="comment">// Catch all:</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&nbsp;    std::numeric_limits&lt;std::size_t&gt;::max()</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&nbsp;    <span class="comment">// clang-format on</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&nbsp;  };</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&nbsp;  <span class="comment">// NOLINTEND(readability-magic-numbers,cppcoreguidelines-avoid-magic-numbers)</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&nbsp; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&nbsp;  <span class="keyword">auto</span>* bound = std::lower_bound(size_classes.begin(), size_classes.end(), value);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&nbsp;  RMM_LOGGING_ASSERT(bound != size_classes.end());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&nbsp;  <span class="keywordflow">return</span> *bound;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&nbsp;}</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&nbsp; </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">  123</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">byte_span</a> {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#af3f67e8fbbb614924d8aa698b0fd1691">  128</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#af3f67e8fbbb614924d8aa698b0fd1691">byte_span</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&nbsp; </div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#ad85c3457cbaf4613c42c780db9bd28e1">  136</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#af3f67e8fbbb614924d8aa698b0fd1691">byte_span</a>(<span class="keywordtype">void</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>, std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>) : pointer_{<span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>)}, size_{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&nbsp;  {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a> &gt; 0);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&nbsp;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&nbsp; </div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">  143</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">char</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> pointer_; }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&nbsp; </div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">  146</a></span>&nbsp;  [[nodiscard]] std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> size_; }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&nbsp; </div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a6f0dfec99f4c6db1cc3f62098eed73e5">  149</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">char</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a6f0dfec99f4c6db1cc3f62098eed73e5">end</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&nbsp;    <span class="keywordflow">return</span> pointer_ + size_;  <span class="comment">// NOLINT(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&nbsp;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&nbsp; </div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">  155</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> pointer_ != <span class="keyword">nullptr</span> &amp;&amp; size_ &gt; 0; }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&nbsp; </div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a02eda99646752132369e671bdc92d09a">  158</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a02eda99646752132369e671bdc92d09a">operator&lt;</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">byte_span</a> <span class="keyword">const</span>&amp; span)<span class="keyword"> const</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&nbsp;    RMM_LOGGING_ASSERT(span.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&nbsp;    <span class="keywordflow">return</span> pointer_ &lt; span.pointer_;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&nbsp;  }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&nbsp; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&nbsp; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&nbsp;  <span class="keywordtype">char</span>* pointer_{};     </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&nbsp;  std::size_t size_{};  </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&nbsp;};</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&nbsp; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&nbsp;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&nbsp;<span class="keyword">inline</span> <span class="keyword">auto</span> total_memory_size(std::set&lt;T&gt; <span class="keyword">const</span>&amp; spans)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&nbsp;{</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&nbsp;  <span class="keywordflow">return</span> std::accumulate(</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&nbsp;    spans.cbegin(), spans.cend(), std::size_t{}, [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; lhs, <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rhs) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&nbsp;      return lhs + rhs.size();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&nbsp;    });</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&nbsp;}</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&nbsp; </div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">  182</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> final : <span class="keyword">public</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">byte_span</a> {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&nbsp;  <span class="keyword">using</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#af3f67e8fbbb614924d8aa698b0fd1691">byte_span::byte_span</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&nbsp; </div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#a5c5b223322005db7d414f0bfdba2551f">  192</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#a5c5b223322005db7d414f0bfdba2551f">fits</a>(std::size_t bytes)<span class="keyword"> const</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&nbsp;    RMM_LOGGING_ASSERT(bytes &gt; 0);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() &gt;= bytes;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&nbsp;  }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&nbsp; </div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#abad2f881436844da18b27b5899c3769f">  205</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#abad2f881436844da18b27b5899c3769f">is_contiguous_before</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <span class="keyword">const</span>&amp; blk)<span class="keyword"> const</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&nbsp;    RMM_LOGGING_ASSERT(blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&nbsp;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() == blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&nbsp;  }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&nbsp; </div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#aac16b2414587cf7340b0eb2b66f6fdca">  219</a></span>&nbsp;  [[nodiscard]] std::pair&lt;block, block&gt; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#aac16b2414587cf7340b0eb2b66f6fdca">split</a>(std::size_t bytes)<span class="keyword"> const</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() &gt; bytes);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&nbsp;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&nbsp;    <span class="keywordflow">return</span> {{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), bytes}, {<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + bytes, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() - bytes}};</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&nbsp;  }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&nbsp; </div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#af2895c1a6f4a5d26cd5ce0bb011f1938">  235</a></span>&nbsp;  [[nodiscard]] <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#af2895c1a6f4a5d26cd5ce0bb011f1938">merge</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <span class="keyword">const</span>&amp; blk)<span class="keyword"> const</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#abad2f881436844da18b27b5899c3769f">is_contiguous_before</a>(blk));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&nbsp;    <span class="keywordflow">return</span> {<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() + blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>()};</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&nbsp;  }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&nbsp;};</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&nbsp; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&nbsp;<span class="keyword">inline</span> <span class="keywordtype">bool</span> block_size_compare(<a class="code" href="structrmm_1_1mr_1_1detail_1_1block.html">block</a> <span class="keyword">const</span>&amp; lhs, <a class="code" href="structrmm_1_1mr_1_1detail_1_1block.html">block</a> <span class="keyword">const</span>&amp; rhs)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&nbsp;{</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&nbsp;  RMM_LOGGING_ASSERT(lhs.<a class="code" href="structrmm_1_1mr_1_1detail_1_1block__base.html#aa2c5c4fdc11701c5f2786beca86d38f3">is_valid</a>());</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&nbsp;  RMM_LOGGING_ASSERT(rhs.<a class="code" href="structrmm_1_1mr_1_1detail_1_1block__base.html#aa2c5c4fdc11701c5f2786beca86d38f3">is_valid</a>());</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&nbsp;  <span class="keywordflow">return</span> lhs.<a class="code" href="structrmm_1_1mr_1_1detail_1_1block.html#a95793d6bf9d616a58f07f7d4490e4f81">size</a>() &lt; rhs.<a class="code" href="structrmm_1_1mr_1_1detail_1_1block.html#a95793d6bf9d616a58f07f7d4490e4f81">size</a>();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&nbsp;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&nbsp; </div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">  254</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a> final : <span class="keyword">public</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">byte_span</a> {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">  257</a></span>&nbsp;  <span class="keyword">static</span> constexpr std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">minimum_size</a>{1UL &lt;&lt; 20};</div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a7c771ecdb84087baa923722ea36b3aea">  259</a></span>&nbsp;  <span class="keyword">static</span> constexpr std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a7c771ecdb84087baa923722ea36b3aea">maximum_size</a>{1UL &lt;&lt; 40};</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&nbsp; </div>
<div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">  264</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&nbsp; </div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a8ea197d2d11c3756d31fe0bd3793169e">  272</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a8ea197d2d11c3756d31fe0bd3793169e">superblock</a>(<span class="keywordtype">void</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>, std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>) : <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">byte_span</a>{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&nbsp;  {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a> &gt;= <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">minimum_size</a>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a> &lt;= <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a7c771ecdb84087baa923722ea36b3aea">maximum_size</a>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&nbsp;    free_blocks_.emplace(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&nbsp;  }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&nbsp; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&nbsp;  <span class="comment">// Disable copy semantics.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&nbsp;  <span class="comment">// Allow move semantics.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>&amp;&amp;) noexcept = default;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>&amp;&amp;) noexcept = default;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&nbsp; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&nbsp;  ~<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">superblock</a>() = default;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&nbsp; </div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">  293</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">empty</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&nbsp;    <span class="keywordflow">return</span> free_blocks_.size() == 1 &amp;&amp; free_blocks_.cbegin()-&gt;size() == <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&nbsp;  }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&nbsp; </div>
<div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a69eb1f1b6ba688ed68c8ffc5ba701f02">  304</a></span>&nbsp;  [[nodiscard]] std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a69eb1f1b6ba688ed68c8ffc5ba701f02">free_blocks</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&nbsp;    <span class="keywordflow">return</span> free_blocks_.size();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&nbsp;  }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&nbsp; </div>
<div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a66c134206808a456bf4adb9c8d0960c7">  316</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a66c134206808a456bf4adb9c8d0960c7">contains</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <span class="keyword">const</span>&amp; blk)<span class="keyword"> const</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&nbsp;    RMM_LOGGING_ASSERT(blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&nbsp;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() &lt;= blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() &amp;&amp; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() &gt;= blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&nbsp;  }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&nbsp; </div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#aac9d73a1c95d883104400bb7f04dc12f">  330</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#aac9d73a1c95d883104400bb7f04dc12f">fits</a>(std::size_t bytes)<span class="keyword"> const</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&nbsp;    <span class="keywordflow">return</span> std::any_of(free_blocks_.cbegin(), free_blocks_.cend(), [bytes](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; blk) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&nbsp;      return blk.fits(bytes);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&nbsp;    });</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&nbsp;  }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&nbsp; </div>
<div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a1585e6f315485a8780977869267e79f0">  345</a></span>&nbsp;  [[nodiscard]] <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a1585e6f315485a8780977869267e79f0">is_contiguous_before</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a> <span class="keyword">const</span>&amp; sblk)<span class="keyword"> const</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&nbsp;    RMM_LOGGING_ASSERT(sblk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&nbsp;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">empty</a>() &amp;&amp; sblk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">empty</a>() &amp;&amp; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() == sblk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&nbsp;  }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&nbsp; </div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">  359</a></span>&nbsp;  [[nodiscard]] std::pair&lt;superblock, superblock&gt; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">split</a>(std::size_t bytes)<span class="keyword"> const</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">empty</a>() &amp;&amp; bytes &gt;= <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">minimum_size</a> &amp;&amp; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() &gt;= bytes + <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">minimum_size</a>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&nbsp;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&nbsp;    <span class="keywordflow">return</span> {<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a>{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), bytes}, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a>{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>() + bytes, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() - bytes}};</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&nbsp;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&nbsp; </div>
<div class="line"><a name="l00375"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a011bb2dd81e98782defb82a7a0a005c1">  375</a></span>&nbsp;  [[nodiscard]] <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a011bb2dd81e98782defb82a7a0a005c1">merge</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a> <span class="keyword">const</span>&amp; sblk)<span class="keyword"> const</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a1585e6f315485a8780977869267e79f0">is_contiguous_before</a>(sblk));</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&nbsp;    <span class="keywordflow">return</span> {<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>() + sblk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>()};</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&nbsp;  }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&nbsp; </div>
<div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a951c1423919ea2df0f090efb1728a9bc">  387</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a951c1423919ea2df0f090efb1728a9bc">first_fit</a>(std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&nbsp;  {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a> &gt; 0);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&nbsp; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&nbsp;    <span class="keyword">auto</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#aac9d73a1c95d883104400bb7f04dc12f">fits</a>       = [<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; blk) { <span class="keywordflow">return</span> blk.fits(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>); };</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(free_blocks_.cbegin(), free_blocks_.cend(), <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#aac9d73a1c95d883104400bb7f04dc12f">fits</a>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&nbsp;    <span class="keywordflow">if</span> (iter == free_blocks_.cend()) { <span class="keywordflow">return</span> {}; }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&nbsp; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&nbsp;    <span class="comment">// Remove the block from the free list.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> blk  = *iter;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> next = free_blocks_.erase(iter);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&nbsp; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&nbsp;    <span class="keywordflow">if</span> (blk.size() &gt; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&nbsp;      <span class="comment">// Split the block and put the remainder back.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">split</a> = blk.split(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&nbsp;      free_blocks_.insert(next, <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">split</a>.second);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&nbsp;      <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">split</a>.first;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&nbsp;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&nbsp;    <span class="keywordflow">return</span> blk;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&nbsp;  }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&nbsp; </div>
<div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#abc8f2a426d13a535c507fe45cbc64e51">  414</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#abc8f2a426d13a535c507fe45cbc64e51">coalesce</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <span class="keyword">const</span>&amp; blk)  <span class="comment">// NOLINT(readability-function-cognitive-complexity)</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&nbsp;  {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&nbsp;    RMM_LOGGING_ASSERT(blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">is_valid</a>());</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a66c134206808a456bf4adb9c8d0960c7">contains</a>(blk));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&nbsp; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&nbsp;    <span class="comment">// Find the right place (in ascending address order) to insert the block.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> next     = free_blocks_.lower_bound(blk);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> previous = next == free_blocks_.cbegin() ? next : std::prev(next);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&nbsp; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&nbsp;    <span class="comment">// Coalesce with neighboring blocks.</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&nbsp;    <span class="keywordtype">bool</span> <span class="keyword">const</span> merge_prev = previous != free_blocks_.cend() &amp;&amp; previous-&gt;is_contiguous_before(blk);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&nbsp;    <span class="keywordtype">bool</span> <span class="keyword">const</span> merge_next = next != free_blocks_.cend() &amp;&amp; blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#abad2f881436844da18b27b5899c3769f">is_contiguous_before</a>(*next);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&nbsp; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&nbsp;    <span class="keywordflow">if</span> (merge_prev &amp;&amp; merge_next) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> merged = previous-&gt;merge(blk).merge(*next);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&nbsp;      free_blocks_.erase(previous);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> iter = free_blocks_.erase(next);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&nbsp;      free_blocks_.insert(iter, merged);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&nbsp;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (merge_prev) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> merged = previous-&gt;merge(blk);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> iter   = free_blocks_.erase(previous);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&nbsp;      free_blocks_.insert(iter, merged);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&nbsp;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (merge_next) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> merged = blk.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#af2895c1a6f4a5d26cd5ce0bb011f1938">merge</a>(*next);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> iter   = free_blocks_.erase(next);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&nbsp;      free_blocks_.insert(iter, merged);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&nbsp;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&nbsp;      free_blocks_.insert(next, blk);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&nbsp;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&nbsp;  }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&nbsp; </div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a3be5a28aebf5f9f964af822cb703d0aa">  450</a></span>&nbsp;  [[nodiscard]] std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a3be5a28aebf5f9f964af822cb703d0aa">total_free_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> total_memory_size(free_blocks_); }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&nbsp; </div>
<div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a01cf0929b1f25190b3225d55e268e599">  456</a></span>&nbsp;  [[nodiscard]] std::size_t <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a01cf0929b1f25190b3225d55e268e599">max_free_size</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&nbsp;    <span class="keywordflow">if</span> (free_blocks_.empty()) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&nbsp;    <span class="keywordflow">return</span> std::max_element(free_blocks_.cbegin(), free_blocks_.cend(), block_size_compare)-&gt;size();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&nbsp;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&nbsp; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&nbsp; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&nbsp;  std::set&lt;block&gt; free_blocks_{};</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&nbsp;};</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&nbsp; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&nbsp;<span class="keyword">inline</span> <span class="keyword">auto</span> total_free_size(std::set&lt;superblock&gt; <span class="keyword">const</span>&amp; superblocks)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&nbsp;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&nbsp;  <span class="keywordflow">return</span> std::accumulate(</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&nbsp;    superblocks.cbegin(), superblocks.cend(), std::size_t{}, [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; lhs, <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rhs) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&nbsp;      return lhs + rhs.total_free_size();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&nbsp;    });</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&nbsp;}</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&nbsp; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&nbsp;<span class="keyword">inline</span> <span class="keyword">auto</span> max_free_size(std::set&lt;superblock&gt; <span class="keyword">const</span>&amp; superblocks)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&nbsp;{</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&nbsp;  std::size_t size{};</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&nbsp;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk : superblocks) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&nbsp;    size = std::max(size, sblk.max_free_size());</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&nbsp;  }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&nbsp;  <span class="keywordflow">return</span> size;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&nbsp;};</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&nbsp; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&nbsp;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Upstream&gt;</div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">  495</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">global_arena</a> final {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">  506</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>(Upstream* upstream_mr, std::optional&lt;std::size_t&gt; arena_size)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&nbsp;    : upstream_mr_{upstream_mr}</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&nbsp;  {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&nbsp;    RMM_EXPECTS(<span class="keyword">nullptr</span> != upstream_mr_, <span class="stringliteral">"Unexpected null upstream pointer."</span>);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> size = rmm::detail::align_down(arena_size.value_or(default_size()),</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&nbsp;                                              rmm::detail::CUDA_ALLOCATION_ALIGNMENT);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&nbsp;    RMM_EXPECTS(size &gt;= <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">superblock::minimum_size</a>,</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&nbsp;                <span class="stringliteral">"Arena size smaller than minimum superblock size."</span>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&nbsp;    initialize(size);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&nbsp;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&nbsp; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&nbsp;  <span class="comment">// Disable copy (and move) semantics.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>&amp;&amp;) noexcept        = delete;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">global_arena</a>&amp;&amp;) noexcept = delete;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&nbsp; </div>
<div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a16bbded32f0ed473296d5ad10dfc0b64">  527</a></span>&nbsp;  ~<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">global_arena</a>()</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&nbsp;  {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&nbsp;    upstream_mr_-&gt;deallocate(upstream_block_.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), upstream_block_.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>());</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&nbsp;  }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&nbsp; </div>
<div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">  539</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">handles</a>(std::size_t size)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> size &gt; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">superblock::minimum_size</a>; }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&nbsp; </div>
<div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a8b1e901d7c1fbaff649f18d14dab0f28">  547</a></span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a8b1e901d7c1fbaff649f18d14dab0f28">acquire</a>(std::size_t size)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&nbsp;  {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&nbsp;    <span class="comment">// Superblocks should only be acquired if the size is not directly handled by the global arena.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&nbsp;    RMM_LOGGING_ASSERT(!<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">handles</a>(size));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&nbsp;    <span class="keywordflow">return</span> first_fit(size);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&nbsp;  }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&nbsp; </div>
<div class="line"><a name="l00560"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a9be140e0b78e0625b297f5dc79c3a8b3">  560</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a9be140e0b78e0625b297f5dc79c3a8b3">release</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">superblock</a>&amp;&amp; sblk)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&nbsp;  {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&nbsp;    RMM_LOGGING_ASSERT(sblk.is_valid());</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&nbsp;    coalesce(std::move(sblk));</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&nbsp;  }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&nbsp; </div>
<div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#abf2d3557e8a1966b05b6b9ff7335a504">  572</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#abf2d3557e8a1966b05b6b9ff7335a504">release</a>(std::set&lt;superblock&gt;&amp; superblocks)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&nbsp;  {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&nbsp;    <span class="keywordflow">while</span> (!superblocks.empty()) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&nbsp;      <span class="keyword">auto</span> sblk = std::move(superblocks.extract(superblocks.cbegin()).value());</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&nbsp;      RMM_LOGGING_ASSERT(sblk.is_valid());</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&nbsp;      coalesce(std::move(sblk));</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&nbsp;    }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&nbsp;  }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&nbsp; </div>
<div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a7d001d9da8a02a18227061b8f6ccaacb">  588</a></span>&nbsp;  <span class="keywordtype">void</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a7d001d9da8a02a18227061b8f6ccaacb">allocate</a>(std::size_t size)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&nbsp;  {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">handles</a>(size));</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&nbsp;    <span class="keyword">auto</span> sblk = first_fit(size);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&nbsp;    <span class="keywordflow">if</span> (sblk.is_valid()) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&nbsp;      <span class="keyword">auto</span> blk = sblk.first_fit(size);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&nbsp;      superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&nbsp;      <span class="keywordflow">return</span> blk.pointer();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&nbsp;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&nbsp;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&nbsp;  }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&nbsp; </div>
<div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a6422e1e307f30909ab7f23e6ca4bfaee">  610</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a6422e1e307f30909ab7f23e6ca4bfaee">deallocate</a>(<span class="keywordtype">void</span>* ptr, std::size_t size, <a class="code" href="classrmm_1_1cuda__stream__view.html">cuda_stream_view</a> stream)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&nbsp;  {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&nbsp;    RMM_LOGGING_ASSERT(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">handles</a>(size));</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&nbsp;    stream.<a class="code" href="classrmm_1_1cuda__stream__view.html#ac41b02768d2afeba32d766db722748c0">synchronize_no_throw</a>();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a6422e1e307f30909ab7f23e6ca4bfaee">deallocate</a>(ptr, size);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&nbsp;  }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&nbsp; </div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a36ab31c91fa7f6f329838b4c4c40b123">  625</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a36ab31c91fa7f6f329838b4c4c40b123">deallocate</a>(<span class="keywordtype">void</span>* ptr, std::size_t bytes)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&nbsp;  {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&nbsp; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&nbsp;    <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> <span class="keyword">const</span> blk{ptr, bytes};</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(superblocks_.cbegin(),</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&nbsp;                                   superblocks_.cend(),</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&nbsp;                                   [&amp;](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk) { return sblk.contains(blk); });</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&nbsp;    <span class="keywordflow">if</span> (iter == superblocks_.cend()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&nbsp; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&nbsp;    <span class="keyword">auto</span> sblk = std::move(superblocks_.extract(iter).value());</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&nbsp;    sblk.coalesce(blk);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&nbsp;    <span class="keywordflow">if</span> (sblk.empty()) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&nbsp;      coalesce(std::move(sblk));</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&nbsp;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&nbsp;      superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&nbsp;    }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&nbsp;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&nbsp;  }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&nbsp; </div>
<div class="line"><a name="l00650"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a40b2e0848aa2af6e8317f985ee3819c6">  650</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a40b2e0848aa2af6e8317f985ee3819c6">dump_memory_log</a>(std::shared_ptr&lt;spdlog::logger&gt; <span class="keyword">const</span>&amp; logger)<span class="keyword"> const</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&nbsp; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&nbsp;    logger-&gt;info(<span class="stringliteral">"  Arena size: {}"</span>, <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{upstream_block_.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">size</a>()});</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&nbsp;    logger-&gt;info(<span class="stringliteral">"  # superblocks: {}"</span>, superblocks_.size());</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&nbsp;    <span class="keywordflow">if</span> (!superblocks_.empty()) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&nbsp;      logger-&gt;debug(<span class="stringliteral">"  Total size of superblocks: {}"</span>,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&nbsp;                    <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{total_memory_size(superblocks_)});</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> total_free    = total_free_size(superblocks_);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> max_free      = max_free_size(superblocks_);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> fragmentation = (1 - max_free / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(total_free)) * 100;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&nbsp;      logger-&gt;info(<span class="stringliteral">"  Total free memory: {}"</span>, <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{total_free});</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&nbsp;      logger-&gt;info(<span class="stringliteral">"  Largest block of free memory: {}"</span>, <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{max_free});</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&nbsp;      logger-&gt;info(<span class="stringliteral">"  Fragmentation: {:.2f}%"</span>, fragmentation);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&nbsp; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&nbsp;      <span class="keyword">auto</span> index = 0;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&nbsp;      <span class="keywordtype">char</span>* prev_end{};</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&nbsp;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk : superblocks_) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&nbsp;        <span class="keywordflow">if</span> (prev_end == <span class="keyword">nullptr</span>) { prev_end = sblk.pointer(); }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&nbsp;        logger-&gt;debug(</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&nbsp;          <span class="stringliteral">"    Superblock {}: start={}, end={}, size={}, empty={}, # free blocks={}, max free={}, "</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&nbsp;          <span class="stringliteral">"gap={}"</span>,</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&nbsp;          index,</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&nbsp;          fmt::ptr(sblk.pointer()),</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&nbsp;          fmt::ptr(sblk.end()),</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&nbsp;          <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{sblk.size()},</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&nbsp;          sblk.empty(),</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&nbsp;          sblk.free_blocks(),</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&nbsp;          <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{sblk.max_free_size()},</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&nbsp;          <a class="code" href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a>{<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(sblk.pointer() - prev_end)});</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&nbsp;        prev_end = sblk.end();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&nbsp;        index++;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&nbsp;      }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&nbsp;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&nbsp;  }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&nbsp; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&nbsp; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&nbsp;  constexpr std::size_t default_size()<span class="keyword"> const</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&nbsp;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> [free, total] = rmm::detail::available_device_memory();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&nbsp;    <span class="keywordflow">return</span> free / 2;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&nbsp;  }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&nbsp; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&nbsp;  <span class="keywordtype">void</span> initialize(std::size_t size)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&nbsp;  {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&nbsp;    upstream_block_ = {upstream_mr_-&gt;allocate(size), size};</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&nbsp;    superblocks_.emplace(upstream_block_.<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>(), size);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&nbsp;  }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&nbsp; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&nbsp;  superblock first_fit(std::size_t size)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&nbsp;  {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(superblocks_.cbegin(),</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&nbsp;                                   superblocks_.cend(),</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&nbsp;                                   [=](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk) { return sblk.fits(size); });</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&nbsp;    <span class="keywordflow">if</span> (iter == superblocks_.cend()) { <span class="keywordflow">return</span> {}; }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&nbsp; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&nbsp;    <span class="keyword">auto</span> sblk           = std::move(superblocks_.extract(iter).value());</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> min_size = std::max(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">superblock::minimum_size</a>, size);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&nbsp;    <span class="keywordflow">if</span> (sblk.empty() &amp;&amp; sblk.size() &gt;= min_size + <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">superblock::minimum_size</a>) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&nbsp;      <span class="comment">// Split the superblock and put the remainder back.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&nbsp;      <span class="keyword">auto</span> [head, tail] = sblk.split(min_size);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&nbsp;      superblocks_.insert(std::move(tail));</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&nbsp;      <span class="keywordflow">return</span> std::move(head);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&nbsp;    }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&nbsp;    <span class="keywordflow">return</span> sblk;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&nbsp;  }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&nbsp; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&nbsp;  <span class="keywordtype">void</span> coalesce(superblock&amp;&amp; sblk)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&nbsp;  {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&nbsp;    RMM_LOGGING_ASSERT(sblk.is_valid());</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&nbsp; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&nbsp;    <span class="comment">// Find the right place (in ascending address order) to insert the block.</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> next     = superblocks_.lower_bound(sblk);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> previous = next == superblocks_.cbegin() ? next : std::prev(next);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&nbsp; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&nbsp;    <span class="comment">// Coalesce with neighboring blocks.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&nbsp;    <span class="keywordtype">bool</span> <span class="keyword">const</span> merge_prev = previous != superblocks_.cend() &amp;&amp; previous-&gt;is_contiguous_before(sblk);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&nbsp;    <span class="keywordtype">bool</span> <span class="keyword">const</span> merge_next = next != superblocks_.cend() &amp;&amp; sblk.is_contiguous_before(*next);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&nbsp; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&nbsp;    <span class="keywordflow">if</span> (merge_prev &amp;&amp; merge_next) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&nbsp;      <span class="keyword">auto</span> prev_sb = std::move(superblocks_.extract(previous).value());</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&nbsp;      <span class="keyword">auto</span> next_sb = std::move(superblocks_.extract(next).value());</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&nbsp;      <span class="keyword">auto</span> merged  = prev_sb.merge(sblk).merge(next_sb);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&nbsp;      superblocks_.insert(std::move(merged));</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&nbsp;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (merge_prev) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&nbsp;      <span class="keyword">auto</span> prev_sb = std::move(superblocks_.extract(previous).value());</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&nbsp;      <span class="keyword">auto</span> merged  = prev_sb.merge(sblk);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&nbsp;      superblocks_.insert(std::move(merged));</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&nbsp;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (merge_next) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&nbsp;      <span class="keyword">auto</span> next_sb = std::move(superblocks_.extract(next).value());</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&nbsp;      <span class="keyword">auto</span> merged  = sblk.merge(next_sb);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&nbsp;      superblocks_.insert(std::move(merged));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&nbsp;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&nbsp;      superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&nbsp;    }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&nbsp;  }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&nbsp; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&nbsp;  Upstream* upstream_mr_;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&nbsp;  block upstream_block_;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&nbsp;  std::set&lt;superblock&gt; superblocks_;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&nbsp;  <span class="keyword">mutable</span> std::mutex mtx_;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&nbsp;};</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&nbsp; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&nbsp;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Upstream&gt;</div>
<div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">  796</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">arena</a> {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">  803</a></span>&nbsp;  <span class="keyword">explicit</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">global_arena&lt;Upstream&gt;</a>&amp; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">global_arena</a>) : global_arena_{<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">global_arena</a>} {}</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&nbsp; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&nbsp;  <span class="comment">// Disable copy (and move) semantics.</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>&amp;&amp;) noexcept        = delete;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>&amp;&amp;) noexcept = delete;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&nbsp; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&nbsp;  ~<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">arena</a>() = default;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&nbsp; </div>
<div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ad65c2e0f33737a49a14ff618ca6fa528">  819</a></span>&nbsp;  <span class="keywordtype">void</span>* <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ad65c2e0f33737a49a14ff618ca6fa528">allocate</a>(std::<span class="keywordtype">size_t</span> size)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&nbsp;  {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&nbsp;    <span class="keywordflow">if</span> (global_arena_.handles(size)) { <span class="keywordflow">return</span> global_arena_.allocate(size); }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&nbsp;    <span class="keywordflow">return</span> get_block(size).<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">pointer</a>();</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&nbsp;  }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&nbsp; </div>
<div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab1346c0e4056215e46dd1f669711ba2f">  835</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab1346c0e4056215e46dd1f669711ba2f">deallocate</a>(<span class="keywordtype">void</span>* ptr, std::size_t size, <a class="code" href="classrmm_1_1cuda__stream__view.html">cuda_stream_view</a> stream)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&nbsp;  {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&nbsp;    <span class="keywordflow">if</span> (global_arena_.handles(size) &amp;&amp; global_arena_.deallocate(ptr, size, stream)) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&nbsp;    <span class="keywordflow">return</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab1346c0e4056215e46dd1f669711ba2f">deallocate</a>(ptr, size);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&nbsp;  }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&nbsp; </div>
<div class="line"><a name="l00849"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a5237e7e1e736d0f6e470914187393d26">  849</a></span>&nbsp;  <span class="keywordtype">bool</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a5237e7e1e736d0f6e470914187393d26">deallocate</a>(<span class="keywordtype">void</span>* ptr, std::size_t size)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&nbsp;  {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&nbsp;    <span class="keywordflow">return</span> deallocate_from_superblock({ptr, size});</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&nbsp;  }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&nbsp; </div>
<div class="line"><a name="l00858"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab98c95b4d8f1781aabda59abc5eec4ae">  858</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab98c95b4d8f1781aabda59abc5eec4ae">clean</a>()</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&nbsp;  {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&nbsp;    global_arena_.release(superblocks_);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&nbsp;    superblocks_.clear();</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&nbsp;  }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&nbsp; </div>
<div class="line"><a name="l00868"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#af62bbb515fd810603d46852291bffa22">  868</a></span>&nbsp;  <span class="keywordtype">void</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#af62bbb515fd810603d46852291bffa22">defragment</a>()</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&nbsp;  {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&nbsp;    std::lock_guard lock(mtx_);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&nbsp;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&nbsp;        superblocks_.cbegin(), superblocks_.cend(), [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk) { return sblk.empty(); });</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&nbsp;      <span class="keywordflow">if</span> (iter == superblocks_.cend()) { <span class="keywordflow">return</span>; }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&nbsp;      global_arena_.release(std::move(superblocks_.extract(iter).value()));</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&nbsp;    }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&nbsp;  }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&nbsp; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&nbsp; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">block</a> get_block(std::size_t size)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&nbsp;  {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&nbsp;    <span class="comment">// Find the first-fit free block.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> blk = first_fit(size);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&nbsp;    <span class="keywordflow">if</span> (blk.is_valid()) { <span class="keywordflow">return</span> blk; }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&nbsp; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&nbsp;    <span class="comment">// No existing larger blocks available, so grow the arena and obtain a superblock.</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&nbsp;    <span class="keywordflow">return</span> expand_arena(size);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&nbsp;  }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&nbsp; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&nbsp;  block first_fit(std::size_t size)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&nbsp;  {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(superblocks_.cbegin(),</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&nbsp;                                   superblocks_.cend(),</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&nbsp;                                   [size](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk) { return sblk.fits(size); });</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&nbsp;    <span class="keywordflow">if</span> (iter == superblocks_.cend()) { <span class="keywordflow">return</span> {}; }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&nbsp; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&nbsp;    <span class="keyword">auto</span> sblk      = std::move(superblocks_.extract(iter).value());</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> blk = sblk.first_fit(size);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&nbsp;    superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&nbsp;    <span class="keywordflow">return</span> blk;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&nbsp;  }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&nbsp; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&nbsp;  <span class="keywordtype">bool</span> deallocate_from_superblock(block <span class="keyword">const</span>&amp; blk)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&nbsp;  {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&nbsp;    <span class="keyword">auto</span> <span class="keyword">const</span> iter = std::find_if(superblocks_.cbegin(),</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&nbsp;                                   superblocks_.cend(),</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&nbsp;                                   [&amp;](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; sblk) { return sblk.contains(blk); });</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&nbsp;    <span class="keywordflow">if</span> (iter == superblocks_.cend()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&nbsp; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&nbsp;    <span class="keyword">auto</span> sblk = std::move(superblocks_.extract(iter).value());</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&nbsp;    sblk.coalesce(blk);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&nbsp;    superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&nbsp;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&nbsp;  }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&nbsp; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&nbsp;  block expand_arena(std::size_t size)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&nbsp;  {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&nbsp;    <span class="keyword">auto</span> sblk = global_arena_.acquire(size);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&nbsp;    <span class="keywordflow">if</span> (sblk.is_valid()) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&nbsp;      RMM_LOGGING_ASSERT(sblk.size() &gt;= <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">superblock::minimum_size</a>);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&nbsp;      <span class="keyword">auto</span> <span class="keyword">const</span> blk = sblk.first_fit(size);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&nbsp;      superblocks_.insert(std::move(sblk));</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&nbsp;      <span class="keywordflow">return</span> blk;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&nbsp;    }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&nbsp;    <span class="keywordflow">return</span> {};</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&nbsp;  }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&nbsp; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&nbsp;  global_arena&lt;Upstream&gt;&amp; global_arena_;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&nbsp;  std::set&lt;superblock&gt; superblocks_;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&nbsp;  <span class="keyword">mutable</span> std::mutex mtx_;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&nbsp;};</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&nbsp; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&nbsp;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Upstream&gt;</div>
<div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">  977</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a> {</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&nbsp; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&nbsp;  <span class="keyword">explicit</span> <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>(std::shared_ptr&lt;<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">arena&lt;Upstream&gt;</a>&gt; <span class="keyword">const</span>&amp; <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">arena</a>) : arena_(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">arena</a>) {}</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&nbsp; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&nbsp;  <span class="comment">// Disable copy (and move) semantics.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a> <span class="keyword">const</span>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>&amp;&amp;) noexcept        = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&nbsp;  <a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>&amp; operator=(<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>&amp;&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&nbsp; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&nbsp;  ~<a class="code" href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">arena_cleaner</a>()</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&nbsp;  {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&nbsp;    <span class="keywordflow">if</span> (!arena_.expired()) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&nbsp;      <span class="keyword">auto</span> arena_ptr = arena_.lock();</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&nbsp;      arena_ptr-&gt;clean();</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&nbsp;    }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&nbsp;  }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&nbsp; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&nbsp; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&nbsp;  std::weak_ptr&lt;arena&lt;Upstream&gt;&gt; arena_;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&nbsp;};</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&nbsp; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&nbsp;}  <span class="comment">// namespace rmm::mr::detail::arena</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_a7ccf80e8a5e8afebefde91627fe0282e"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a7ccf80e8a5e8afebefde91627fe0282e">rmm::mr::detail::arena::byte_span::pointer</a></div><div class="ttdeci">char * pointer() const</div><div class="ttdoc">Returns the underlying pointer.</div><div class="ttdef"><b>Definition:</b> arena.hpp:143</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_aecc991df54b1018c6681900f4a372cab"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#aecc991df54b1018c6681900f4a372cab">rmm::mr::detail::arena::byte_span::size</a></div><div class="ttdeci">std::size_t size() const</div><div class="ttdoc">Returns the size of the span.</div><div class="ttdef"><b>Definition:</b> arena.hpp:146</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1block_html_af2895c1a6f4a5d26cd5ce0bb011f1938"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#af2895c1a6f4a5d26cd5ce0bb011f1938">rmm::mr::detail::arena::block::merge</a></div><div class="ttdeci">block merge(block const &amp;blk) const</div><div class="ttdoc">Coalesce two contiguous blocks into one.</div><div class="ttdef"><b>Definition:</b> arena.hpp:235</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_af62bbb515fd810603d46852291bffa22"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#af62bbb515fd810603d46852291bffa22">rmm::mr::detail::arena::arena::defragment</a></div><div class="ttdeci">void defragment()</div><div class="ttdoc">Defragment the arena and release empty superblock to the global arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:868</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html">rmm::mr::detail::arena::superblock</a></div><div class="ttdoc">Represents a large chunk of memory that is exchanged between the global arena and per-thread arenas.</div><div class="ttdef"><b>Definition:</b> arena.hpp:254</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a01cf0929b1f25190b3225d55e268e599"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a01cf0929b1f25190b3225d55e268e599">rmm::mr::detail::arena::superblock::max_free_size</a></div><div class="ttdeci">std::size_t max_free_size() const</div><div class="ttdoc">Find the max free block size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:456</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_abf2d3557e8a1966b05b6b9ff7335a504"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#abf2d3557e8a1966b05b6b9ff7335a504">rmm::mr::detail::arena::global_arena::release</a></div><div class="ttdeci">void release(std::set&lt; superblock &gt; &amp;superblocks)</div><div class="ttdoc">Release a set of superblocks from a dying arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:572</div></div>
<div class="ttc" id="astructrmm_1_1detail_1_1bytes_html"><div class="ttname"><a href="structrmm_1_1detail_1_1bytes.html">rmm::detail::bytes</a></div><div class="ttdoc">Represent a size in number of bytes.</div><div class="ttdef"><b>Definition:</b> logger.hpp:75</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a69eb1f1b6ba688ed68c8ffc5ba701f02"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a69eb1f1b6ba688ed68c8ffc5ba701f02">rmm::mr::detail::arena::superblock::free_blocks</a></div><div class="ttdeci">std::size_t free_blocks() const</div><div class="ttdoc">Return the number of free blocks.</div><div class="ttdef"><b>Definition:</b> arena.hpp:304</div></div>
<div class="ttc" id="aclassrmm_1_1cuda__stream__view_html"><div class="ttname"><a href="classrmm_1_1cuda__stream__view.html">rmm::cuda_stream_view</a></div><div class="ttdoc">Strongly-typed non-owning wrapper for CUDA streams with default constructor.</div><div class="ttdef"><b>Definition:</b> cuda_stream_view.hpp:34</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a1585e6f315485a8780977869267e79f0"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a1585e6f315485a8780977869267e79f0">rmm::mr::detail::arena::superblock::is_contiguous_before</a></div><div class="ttdeci">bool is_contiguous_before(superblock const &amp;sblk) const</div><div class="ttdoc">Verifies whether this superblock can be merged to the beginning of superblock s.</div><div class="ttdef"><b>Definition:</b> arena.hpp:345</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a7c771ecdb84087baa923722ea36b3aea"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a7c771ecdb84087baa923722ea36b3aea">rmm::mr::detail::arena::superblock::maximum_size</a></div><div class="ttdeci">static constexpr std::size_t maximum_size</div><div class="ttdoc">Maximum size of a superblock (1 TiB), as a sanity check.</div><div class="ttdef"><b>Definition:</b> arena.hpp:259</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a7d001d9da8a02a18227061b8f6ccaacb"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a7d001d9da8a02a18227061b8f6ccaacb">rmm::mr::detail::arena::global_arena::allocate</a></div><div class="ttdeci">void * allocate(std::size_t size)</div><div class="ttdoc">Allocate a large block directly.</div><div class="ttdef"><b>Definition:</b> arena.hpp:588</div></div>
<div class="ttc" id="astructrmm_1_1mr_1_1detail_1_1block__base_html_aa2c5c4fdc11701c5f2786beca86d38f3"><div class="ttname"><a href="structrmm_1_1mr_1_1detail_1_1block__base.html#aa2c5c4fdc11701c5f2786beca86d38f3">rmm::mr::detail::block_base::is_valid</a></div><div class="ttdeci">bool is_valid() const</div><div class="ttdoc">Returns true if this block is valid (non-null), false otherwise.</div><div class="ttdef"><b>Definition:</b> free_list.hpp:34</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a310cda339b94b65f737385e3b8aba976"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a310cda339b94b65f737385e3b8aba976">rmm::mr::detail::arena::global_arena::global_arena</a></div><div class="ttdeci">global_arena(Upstream *upstream_mr, std::optional&lt; std::size_t &gt; arena_size)</div><div class="ttdoc">Construct a global arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:506</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_a02eda99646752132369e671bdc92d09a"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a02eda99646752132369e671bdc92d09a">rmm::mr::detail::arena::byte_span::operator&lt;</a></div><div class="ttdeci">bool operator&lt;(byte_span const &amp;span) const</div><div class="ttdoc">Used by std::set to compare spans.</div><div class="ttdef"><b>Definition:</b> arena.hpp:158</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_aac9d73a1c95d883104400bb7f04dc12f"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#aac9d73a1c95d883104400bb7f04dc12f">rmm::mr::detail::arena::superblock::fits</a></div><div class="ttdeci">bool fits(std::size_t bytes) const</div><div class="ttdoc">Can this superblock fit bytes bytes?</div><div class="ttdef"><b>Definition:</b> arena.hpp:330</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a66c134206808a456bf4adb9c8d0960c7"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a66c134206808a456bf4adb9c8d0960c7">rmm::mr::detail::arena::superblock::contains</a></div><div class="ttdeci">bool contains(block const &amp;blk) const</div><div class="ttdoc">Whether this superblock contains the given block.</div><div class="ttdef"><b>Definition:</b> arena.hpp:316</div></div>
<div class="ttc" id="astructrmm_1_1mr_1_1detail_1_1block_html"><div class="ttname"><a href="structrmm_1_1mr_1_1detail_1_1block.html">rmm::mr::detail::block</a></div><div class="ttdoc">A simple block structure specifying the size and location of a block of memory, with a flag indicatin...</div><div class="ttdef"><b>Definition:</b> coalescing_free_list.hpp:36</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a9be140e0b78e0625b297f5dc79c3a8b3"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a9be140e0b78e0625b297f5dc79c3a8b3">rmm::mr::detail::arena::global_arena::release</a></div><div class="ttdeci">void release(superblock &amp;&amp;sblk)</div><div class="ttdoc">Release a superblock.</div><div class="ttdef"><b>Definition:</b> arena.hpp:560</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_ab1346c0e4056215e46dd1f669711ba2f"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab1346c0e4056215e46dd1f669711ba2f">rmm::mr::detail::arena::arena::deallocate</a></div><div class="ttdeci">bool deallocate(void *ptr, std::size_t size, cuda_stream_view stream)</div><div class="ttdoc">Deallocate memory pointed to by ptr, and possibly return superblocks to upstream.</div><div class="ttdef"><b>Definition:</b> arena.hpp:835</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a8b1e901d7c1fbaff649f18d14dab0f28"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a8b1e901d7c1fbaff649f18d14dab0f28">rmm::mr::detail::arena::global_arena::acquire</a></div><div class="ttdeci">superblock acquire(std::size_t size)</div><div class="ttdoc">Acquire a superblock that can fit a block of the given size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:547</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a0e108c13832fd80c06f310cd13ec62f8"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a0e108c13832fd80c06f310cd13ec62f8">rmm::mr::detail::arena::superblock::minimum_size</a></div><div class="ttdeci">static constexpr std::size_t minimum_size</div><div class="ttdoc">Minimum size of a superblock (1 MiB).</div><div class="ttdef"><b>Definition:</b> arena.hpp:257</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena__cleaner.html">rmm::mr::detail::arena::arena_cleaner</a></div><div class="ttdoc">RAII-style cleaner for an arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:977</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a726e6385bbee8ae6fbee2b754457e3af"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a726e6385bbee8ae6fbee2b754457e3af">rmm::mr::detail::arena::superblock::superblock</a></div><div class="ttdeci">superblock()=default</div><div class="ttdoc">Construct a default superblock.</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_a0b39c4311a2a2cd0eec908b4e3778afe"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a0b39c4311a2a2cd0eec908b4e3778afe">rmm::mr::detail::arena::byte_span::is_valid</a></div><div class="ttdeci">bool is_valid() const</div><div class="ttdoc">Returns true if this span is valid (non-null), false otherwise.</div><div class="ttdef"><b>Definition:</b> arena.hpp:155</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_a6f0dfec99f4c6db1cc3f62098eed73e5"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#a6f0dfec99f4c6db1cc3f62098eed73e5">rmm::mr::detail::arena::byte_span::end</a></div><div class="ttdeci">char * end() const</div><div class="ttdoc">Returns the end of the span.</div><div class="ttdef"><b>Definition:</b> arena.hpp:149</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a40b2e0848aa2af6e8317f985ee3819c6"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a40b2e0848aa2af6e8317f985ee3819c6">rmm::mr::detail::arena::global_arena::dump_memory_log</a></div><div class="ttdeci">void dump_memory_log(std::shared_ptr&lt; spdlog::logger &gt; const &amp;logger) const</div><div class="ttdoc">Dump memory to log.</div><div class="ttdef"><b>Definition:</b> arena.hpp:650</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a6422e1e307f30909ab7f23e6ca4bfaee"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a6422e1e307f30909ab7f23e6ca4bfaee">rmm::mr::detail::arena::global_arena::deallocate</a></div><div class="ttdeci">bool deallocate(void *ptr, std::size_t size, cuda_stream_view stream)</div><div class="ttdoc">Deallocate memory pointed to by ptr.</div><div class="ttdef"><b>Definition:</b> arena.hpp:610</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html">rmm::mr::detail::arena::byte_span</a></div><div class="ttdoc">Represents a contiguous region of memory.</div><div class="ttdef"><b>Definition:</b> arena.hpp:123</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_a36ab31c91fa7f6f329838b4c4c40b123"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#a36ab31c91fa7f6f329838b4c4c40b123">rmm::mr::detail::arena::global_arena::deallocate</a></div><div class="ttdeci">bool deallocate(void *ptr, std::size_t bytes)</div><div class="ttdoc">Deallocate memory pointed to by ptr.</div><div class="ttdef"><b>Definition:</b> arena.hpp:625</div></div>
<div class="ttc" id="astructrmm_1_1mr_1_1detail_1_1block_html_a95793d6bf9d616a58f07f7d4490e4f81"><div class="ttname"><a href="structrmm_1_1mr_1_1detail_1_1block.html#a95793d6bf9d616a58f07f7d4490e4f81">rmm::mr::detail::block::size</a></div><div class="ttdeci">std::size_t size() const</div><div class="ttdoc">Returns the size of the memory represented by this block.</div><div class="ttdef"><b>Definition:</b> coalescing_free_list.hpp:55</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1block_html_aac16b2414587cf7340b0eb2b66f6fdca"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#aac16b2414587cf7340b0eb2b66f6fdca">rmm::mr::detail::arena::block::split</a></div><div class="ttdeci">std::pair&lt; block, block &gt; split(std::size_t bytes) const</div><div class="ttdoc">Split this block into two by the given size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:219</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html">rmm::mr::detail::arena::arena</a></div><div class="ttdoc">An arena for allocating memory for a thread.</div><div class="ttdef"><b>Definition:</b> arena.hpp:796</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a951c1423919ea2df0f090efb1728a9bc"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a951c1423919ea2df0f090efb1728a9bc">rmm::mr::detail::arena::superblock::first_fit</a></div><div class="ttdeci">block first_fit(std::size_t size)</div><div class="ttdoc">Get the first free block of at least size bytes.</div><div class="ttdef"><b>Definition:</b> arena.hpp:387</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a011bb2dd81e98782defb82a7a0a005c1"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a011bb2dd81e98782defb82a7a0a005c1">rmm::mr::detail::arena::superblock::merge</a></div><div class="ttdeci">superblock merge(superblock const &amp;sblk) const</div><div class="ttdoc">Coalesce two contiguous superblocks into one.</div><div class="ttdef"><b>Definition:</b> arena.hpp:375</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a3be5a28aebf5f9f964af822cb703d0aa"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a3be5a28aebf5f9f964af822cb703d0aa">rmm::mr::detail::arena::superblock::total_free_size</a></div><div class="ttdeci">std::size_t total_free_size() const</div><div class="ttdoc">Find the total free block size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:450</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a8ea197d2d11c3756d31fe0bd3793169e"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a8ea197d2d11c3756d31fe0bd3793169e">rmm::mr::detail::arena::superblock::superblock</a></div><div class="ttdeci">superblock(void *pointer, std::size_t size)</div><div class="ttdoc">Construct a superblock given a pointer and size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:272</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_a13607a394c16e31c0d6e64fc4fde1a32"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#a13607a394c16e31c0d6e64fc4fde1a32">rmm::mr::detail::arena::superblock::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Is this superblock empty?</div><div class="ttdef"><b>Definition:</b> arena.hpp:293</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1block_html_abad2f881436844da18b27b5899c3769f"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#abad2f881436844da18b27b5899c3769f">rmm::mr::detail::arena::block::is_contiguous_before</a></div><div class="ttdeci">bool is_contiguous_before(block const &amp;blk) const</div><div class="ttdoc">Verifies whether this block can be merged to the beginning of block blk.</div><div class="ttdef"><b>Definition:</b> arena.hpp:205</div></div>
<div class="ttc" id="aclassrmm_1_1cuda__stream__view_html_ac41b02768d2afeba32d766db722748c0"><div class="ttname"><a href="classrmm_1_1cuda__stream__view.html#ac41b02768d2afeba32d766db722748c0">rmm::cuda_stream_view::synchronize_no_throw</a></div><div class="ttdeci">void synchronize_no_throw() const noexcept</div><div class="ttdoc">Synchronize the viewed CUDA stream. Does not throw if there is an error.</div><div class="ttdef"><b>Definition:</b> cuda_stream_view.hpp:88</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_abc8f2a426d13a535c507fe45cbc64e51"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#abc8f2a426d13a535c507fe45cbc64e51">rmm::mr::detail::arena::superblock::coalesce</a></div><div class="ttdeci">void coalesce(block const &amp;blk)</div><div class="ttdoc">Coalesce the given block with other free blocks.</div><div class="ttdef"><b>Definition:</b> arena.hpp:414</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html_aaa96059e3e8ce16586c27229cd4243cf"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html#aaa96059e3e8ce16586c27229cd4243cf">rmm::mr::detail::arena::global_arena::handles</a></div><div class="ttdeci">bool handles(std::size_t size) const</div><div class="ttdoc">Should allocation of size bytes be handled by the global arena directly?</div><div class="ttdef"><b>Definition:</b> arena.hpp:539</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1superblock_html_afdcf390e824ace6527fad552fdab9469"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1superblock.html#afdcf390e824ace6527fad552fdab9469">rmm::mr::detail::arena::superblock::split</a></div><div class="ttdeci">std::pair&lt; superblock, superblock &gt; split(std::size_t bytes) const</div><div class="ttdoc">Split this superblock into two by the given size.</div><div class="ttdef"><b>Definition:</b> arena.hpp:359</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1block_html_a5c5b223322005db7d414f0bfdba2551f"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html#a5c5b223322005db7d414f0bfdba2551f">rmm::mr::detail::arena::block::fits</a></div><div class="ttdeci">bool fits(std::size_t bytes) const</div><div class="ttdoc">Is this block large enough to fit bytes bytes?</div><div class="ttdef"><b>Definition:</b> arena.hpp:192</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_ab98c95b4d8f1781aabda59abc5eec4ae"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ab98c95b4d8f1781aabda59abc5eec4ae">rmm::mr::detail::arena::arena::clean</a></div><div class="ttdeci">void clean()</div><div class="ttdoc">Clean the arena and release all superblocks to the global arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:858</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1global__arena_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1global__arena.html">rmm::mr::detail::arena::global_arena</a></div><div class="ttdoc">The global arena for allocating memory from the upstream memory resource.</div><div class="ttdef"><b>Definition:</b> arena.hpp:495</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1byte__span_html_af3f67e8fbbb614924d8aa698b0fd1691"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1byte__span.html#af3f67e8fbbb614924d8aa698b0fd1691">rmm::mr::detail::arena::byte_span::byte_span</a></div><div class="ttdeci">byte_span()=default</div><div class="ttdoc">Construct a default span.</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_ad65c2e0f33737a49a14ff618ca6fa528"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#ad65c2e0f33737a49a14ff618ca6fa528">rmm::mr::detail::arena::arena::allocate</a></div><div class="ttdeci">void * allocate(std::size_t size)</div><div class="ttdoc">Allocates memory of size at least size bytes.</div><div class="ttdef"><b>Definition:</b> arena.hpp:819</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_a5237e7e1e736d0f6e470914187393d26"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a5237e7e1e736d0f6e470914187393d26">rmm::mr::detail::arena::arena::deallocate</a></div><div class="ttdeci">bool deallocate(void *ptr, std::size_t size)</div><div class="ttdoc">Deallocate memory pointed to by ptr, and possibly return superblocks to upstream.</div><div class="ttdef"><b>Definition:</b> arena.hpp:849</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1block_html"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1block.html">rmm::mr::detail::arena::block</a></div><div class="ttdoc">Represents a chunk of memory that can be allocated and deallocated.</div><div class="ttdef"><b>Definition:</b> arena.hpp:182</div></div>
<div class="ttc" id="aclassrmm_1_1mr_1_1detail_1_1arena_1_1arena_html_a22599f2dab3727a7b2e1019bf5a9dfff"><div class="ttname"><a href="classrmm_1_1mr_1_1detail_1_1arena_1_1arena.html#a22599f2dab3727a7b2e1019bf5a9dfff">rmm::mr::detail::arena::arena::arena</a></div><div class="ttdeci">arena(global_arena&lt; Upstream &gt; &amp;global_arena)</div><div class="ttdoc">Construct an arena.</div><div class="ttdef"><b>Definition:</b> arena.hpp:803</div></div>
<!-- start footer part -->
<hr class="footer"><address class="footer"><small>
Generated by&nbsp;<a href="http://www.doxygen.org/index.html"><img alt="doxygen" class="footer" height="31" src="doxygen.svg" width="104"></a> 1.8.20
</small></address>


<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script><script id="rapids-selector-pixel-invocation" type="text/javascript">_satellite.pageBottom();</script></body></html>