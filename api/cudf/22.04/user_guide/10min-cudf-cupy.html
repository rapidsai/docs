<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator">

    <title>10 Minutes to cuDF and CuPy &mdash; cudf 22.04.00 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link href="../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet">
  <link as="font" crossorigin href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2">
  <link as="font" crossorigin href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2">

    <link href="../_static/pygments.css" rel="stylesheet" type="text/css">
    <link href="../_static/copybutton.css" rel="stylesheet" type="text/css">
    <link href="../_static/params.css" rel="stylesheet" type="text/css">
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="../genindex.html" rel="index" title="Index">
    <link href="../search.html" rel="search" title="Search">
    <link href="guide-to-udfs.html" rel="next" title="Overview of User Defined Functions with cuDF">
    <link href="10min.html" rel="prev" title="10 Minutes to cuDF and Dask-cuDF">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="None" name="docsearch:language">
    

    <!-- Google Analytics -->
    
  <link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>
  <body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img alt="logo" class="logo" src="../_static/RAPIDS-logo-purple.png">
</a>


    
  </div>

  <button aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbar-collapsible" data-toggle="collapse" type="button">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div class="collapse navbar-collapse" id="navbar-collapsible">
    <div class="ml-auto" id="navbar-center">
      
      <div class="navbar-center-item">
        <ul class="navbar-nav" id="navbar-main-elements">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../basics/index.html">
  Basics
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api_docs/index.html">
  API reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/rapidsai/cudf" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/rapidsai" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><div id="rapids-pydata-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">cudf</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable/api.html">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">stable (22.04)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/cudf/nightly/index.html">nightly (22.06)</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/stable/index.html">stable (22.04)</a><a class="rapids-selector__menu-item" href="/api/cudf/legacy/index.html">legacy (22.02)</a></div></div></div>
              <div class="sidebar-start-items"><form action="../search.html" class="bd-search d-flex align-items-center" method="get">
  <i class="icon fas fa-search"></i>
  <input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search">
</form><nav aria-label="Main navigation" class="bd-links" id="bd-docs-nav">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10min.html">
   10 Minutes to cuDF and Dask-cuDF
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   10 Minutes to cuDF and CuPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="guide-to-udfs.html">
   Overview of User Defined Functions with cuDF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Working-with-missing-data.html">
   Working with missing data
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Array">
   Converting a cuDF DataFrame to a CuPy Array
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-a-cuDF-Series-to-a-CuPy-Array">
   Converting a cuDF Series to a CuPy Array
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-a-CuPy-Array-to-a-cuDF-DataFrame">
   Converting a CuPy Array to a cuDF DataFrame
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-a-CuPy-Array-to-a-cuDF-Series">
   Converting a CuPy Array to a cuDF Series
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows">
   Interweaving CuDF and CuPy for Smooth PyData Workflows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix">
   Converting a cuDF DataFrame to a CuPy Sparse Matrix
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="10-Minutes-to-cuDF-and-CuPy">
<h1>10 Minutes to cuDF and CuPy<a class="headerlink" href="#10-Minutes-to-cuDF-and-CuPy" title="Permalink to this headline">#</a></h1>
<p>This notebook provides introductory examples of how you can use cuDF and CuPy together to take advantage of CuPy array functionality (such as advanced linear algebra operations).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">import</span> <span class="nn">cudf</span>
</pre></div>
</div>
</div>
<section id="Converting-a-cuDF-DataFrame-to-a-CuPy-Array">
<h2>Converting a cuDF DataFrame to a CuPy Array<a class="headerlink" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Array" title="Permalink to this headline">#</a></h2>
<p>If we want to convert a cuDF DataFrame to a CuPy ndarray, There are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p>We can use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">DataFrame.values</span></code>.</p></li>
<li><p>We can also convert via the <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/cuda/cuda_array_interface.html">CUDA array interface</a> by using cuDF&rsquo;s <code class="docutils literal notranslate"><span class="pre">as_gpu_matrix</span></code> and CuPy&rsquo;s <code class="docutils literal notranslate"><span class="pre">asarray</span></code> functionality.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'a'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="n">nelem</span><span class="p">),</span>
                     <span class="s1">'b'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">500</span><span class="p">),</span>
                     <span class="s1">'c'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)}</span>
                   <span class="p">)</span>

<span class="o">%</span><span class="k">timeit</span> arr_cupy = cp.from_dlpack(df.to_dlpack())
<span class="o">%</span><span class="k">timeit</span> arr_cupy = df.values
<span class="o">%</span><span class="k">timeit</span> arr_cupy = df.to_cupy()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>167 &micro;s &plusmn; 789 ns per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
497 &micro;s &plusmn; 1.19 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
502 &micro;s &plusmn; 1.34 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr_cupy</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">arr_cupy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array([[    0,   500,  1000],
       [    1,   501,  1001],
       [    2,   502,  1002],
       ...,
       [ 9997, 10497, 10997],
       [ 9998, 10498, 10998],
       [ 9999, 10499, 10999]])
</pre></div></div>
</div>
</section>
<section id="Converting-a-cuDF-Series-to-a-CuPy-Array">
<h2>Converting a cuDF Series to a CuPy Array<a class="headerlink" href="#Converting-a-cuDF-Series-to-a-CuPy-Array" title="Permalink to this headline">#</a></h2>
<p>There are also multiple ways to convert a cuDF Series to a CuPy array:</p>
<ol class="arabic simple">
<li><p>We can pass the Series to <code class="docutils literal notranslate"><span class="pre">cupy.asarray</span></code> as cuDF Series exposes <code class="docutils literal notranslate"><span class="pre">`__cuda_array_interface__</span></code> &lt;<a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/interoperability.html">https://docs-cupy.chainer.org/en/stable/reference/interoperability.html</a>&gt;`__.</p></li>
<li><p>We can leverage the dlpack interface <code class="docutils literal notranslate"><span class="pre">to_dlpack()</span></code>.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">Series.values</span></code></p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="s1">'a'</span>

<span class="o">%</span><span class="k">timeit</span> cola_cupy = cp.asarray(df[col])
<span class="o">%</span><span class="k">timeit</span> cola_cupy = cp.from_dlpack(df[col].to_dlpack())
<span class="o">%</span><span class="k">timeit</span> cola_cupy = df[col].values
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>75.2 &micro;s &plusmn; 117 ns per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
185 &micro;s &plusmn; 630 ns per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
169 &micro;s &plusmn; 1.24 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cola_cupy</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">cola_cupy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array([   0,    1,    2, ..., 9997, 9998, 9999])
</pre></div></div>
</div>
<p>From here, we can proceed with normal CuPy workflows, such as reshaping the array, getting the diagonal, or calculating the norm.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_arr</span> <span class="o">=</span> <span class="n">cola_cupy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">reshaped_arr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array([[   0,    1,    2, ...,  197,  198,  199],
       [ 200,  201,  202, ...,  397,  398,  399],
       [ 400,  401,  402, ...,  597,  598,  599],
       ...,
       [9400, 9401, 9402, ..., 9597, 9598, 9599],
       [9600, 9601, 9602, ..., 9797, 9798, 9799],
       [9800, 9801, 9802, ..., 9997, 9998, 9999]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array([   0,  201,  402,  603,  804, 1005, 1206, 1407, 1608, 1809, 2010,
       2211, 2412, 2613, 2814, 3015, 3216, 3417, 3618, 3819, 4020, 4221,
       4422, 4623, 4824, 5025, 5226, 5427, 5628, 5829, 6030, 6231, 6432,
       6633, 6834, 7035, 7236, 7437, 7638, 7839, 8040, 8241, 8442, 8643,
       8844, 9045, 9246, 9447, 9648, 9849])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array(577306.967739)
</pre></div></div>
</div>
</section>
<section id="Converting-a-CuPy-Array-to-a-cuDF-DataFrame">
<h2>Converting a CuPy Array to a cuDF DataFrame<a class="headerlink" href="#Converting-a-CuPy-Array-to-a-cuDF-DataFrame" title="Permalink to this headline">#</a></h2>
<p>We can also convert a CuPy ndarray to a cuDF DataFrame. Like before, there are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p><strong>Easiest;</strong> We can directly use the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can use CUDA array interface with the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can also use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
</ol>
<p>For the latter two cases, we&rsquo;ll need to make sure that our CuPy array is Fortran contiguous in memory (if it&rsquo;s not already). We can either transpose the array or simply coerce it to be Fortran contiguous beforehand.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> reshaped_df = cudf.DataFrame(reshaped_arr)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>22 ms &plusmn; 26.6 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div>
</div>
<p>We can check whether our array is Fortran contiguous by using cupy.isfortran or looking at the <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/generated/cupy.ndarray.html#cupy.ndarray.flags">flags</a> of the array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span><span class="o">.</span><span class="n">isfortran</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>False
</pre></div></div>
</div>
<p>In this case, we&rsquo;ll need to convert it before going to a cuDF DataFrame. In the next two cells, we create the DataFrame by leveraging dlpack and the CUDA array interface, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>8.6 ms &plusmn; 33.8 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">fortran_arr</span><span class="o">.</span><span class="n">toDlpack</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>5.56 ms &plusmn; 37.6 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div>
</div>
</section>
<section id="Converting-a-CuPy-Array-to-a-cuDF-Series">
<h2>Converting a CuPy Array to a cuDF Series<a class="headerlink" href="#Converting-a-CuPy-Array-to-a-cuDF-Series" title="Permalink to this headline">#</a></h2>
<p>To convert an array to a Series, we can directly pass the array to the <code class="docutils literal notranslate"><span class="pre">Series</span></code> constructor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cudf</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>0      0
1    201
2    402
3    603
4    804
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows">
<h2>Interweaving CuDF and CuPy for Smooth PyData Workflows<a class="headerlink" href="#Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows" title="Permalink to this headline">#</a></h2>
<p>RAPIDS libraries and the entire GPU PyData ecosystem are developing quickly, but sometimes a one library may not have the functionality you need. One example of this might be taking the row-wise sum (or mean) of a Pandas DataFrame. cuDF&rsquo;s support for row-wise operations isn&rsquo;t mature, so you&rsquo;d need to either transpose the DataFrame or write a UDF and explicitly calculate the sum across each row. Transposing could lead to hundreds of thousands of columns (which cuDF wouldn&rsquo;t perform well with)
depending on your data&rsquo;s shape, and writing a UDF can be time intensive.</p>
<p>By leveraging the interoperability of the GPU PyData ecosystem, this operation becomes very easy. Let&rsquo;s take the row-wise sum of our previously reshaped cuDF DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div>
</div>
<p>We can just transform it into a CuPy array and use the <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument of <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">new_arr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>array([  19900,   59900,   99900,  139900,  179900,  219900,  259900,
        299900,  339900,  379900,  419900,  459900,  499900,  539900,
        579900,  619900,  659900,  699900,  739900,  779900,  819900,
        859900,  899900,  939900,  979900, 1019900, 1059900, 1099900,
       1139900, 1179900, 1219900, 1259900, 1299900, 1339900, 1379900,
       1419900, 1459900, 1499900, 1539900, 1579900, 1619900, 1659900,
       1699900, 1739900, 1779900, 1819900, 1859900, 1899900, 1939900,
       1979900])
</pre></div></div>
</div>
<p>With just that single line, we&rsquo;re able to seamlessly move between data structures in this ecosystem, giving us enormous flexibility without sacrificing speed.</p>
</section>
<section id="Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix">
<h2>Converting a cuDF DataFrame to a CuPy Sparse Matrix<a class="headerlink" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix" title="Permalink to this headline">#</a></h2>
<p>We can also convert a DataFrame or Series to a CuPy sparse matrix. We might want to do this if downstream processes expect CuPy sparse matrices as an input.</p>
<p>The sparse matrix data structure is defined by three dense arrays. We&rsquo;ll define a small helper function for cleanliness.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sparseformat</span><span class="o">=</span><span class="s1">'column'</span><span class="p">):</span>
    <span class="sd">"""Converts a cuDF object to a CuPy Sparse Column matrix.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Let's focus on column and row formats for now."</span><span class="p">)</span>

    <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="o">==</span> <span class="s1">'row'</span><span class="p">:</span>
        <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span>

    <span class="k">return</span> <span class="n">_sparse_constructor</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<p>We can define a sparsely populated DataFrame to illustrate this conversion to either sparse matrix format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nelem</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nelem</span><span class="o">-</span><span class="n">nonzero</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'a'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a0</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
      <th>a6</th>
      <th>a7</th>
      <th>a8</th>
      <th>a9</th>
      <th>a10</th>
      <th>a11</th>
      <th>a12</th>
      <th>a13</th>
      <th>a14</th>
      <th>a15</th>
      <th>a16</th>
      <th>a17</th>
      <th>a18</th>
      <th>a19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.380014</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>11.030136</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>5.726806</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.917846</td>
      <td>0.000000</td>
      <td>5.90886</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.646564</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.399164</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>14.092100</td>
      <td>0.000000</td>
      <td>0.378781</td>
      <td>0.420953</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.109242</td>
      <td>2.541798</td>
      <td>0.0</td>
      <td>0.071563</td>
      <td>8.223387</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>10.744624</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sparse_data</span> <span class="o">=</span> <span class="n">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sparse_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>  (896, 0)      0.7194778152522069
  (385, 0)      5.061243119202521
  (899, 0)      8.032932656540671
  (1028, 0)     10.072155866140903
  (133, 0)      13.27741318265092
  (518, 0)      2.242099518010387
  (647, 0)      6.487369007371155
  (776, 0)      5.621989952370181
  (9, 0)        8.833796529523534
  (521, 0)      7.719749292928572
  (777, 0)      7.4610987015782975
  (394, 0)      10.09026095476732
  (140, 0)      2.974228870142501
  (653, 0)      4.520704347545524
  (1037, 0)     4.53896886415556
  (400, 0)      4.0198547103826705
  (401, 0)      -0.2557920447399875
  (1041, 0)     1.8627471984893114
  (146, 0)      9.834516073722536
  (1042, 0)     7.850006814937681
  (275, 0)      1.5747512513374389
  (662, 0)      6.717038670488377
  (25, 0)       7.311464380885098
  (281, 0)      3.5147599499072024
  (409, 0)      1.121874214291239
  :     :
  (8290, 19)    19.23532976720017
  (8679, 19)    3.9092712623274224
  (8935, 19)    0.8411008847310036
  (9063, 19)    12.010953214709328
  (9319, 19)    3.470064419440258
  (8683, 19)    14.397876149427695
  (8300, 19)    10.524275022546979
  (8301, 19)    0.6266917401191829
  (8557, 19)    -0.4554588974911311
  (9197, 19)    12.379896820812874
  (8304, 19)    1.3276250981825033
  (8563, 19)    -1.579631321204169
  (8442, 19)    6.881252269650868
  (8315, 19)    0.5811637925849389
  (8575, 19)    15.52855242553137
  (9343, 19)    -0.12679091919544638
  (9569, 19)    9.316119794827424
  (9570, 19)    10.791371431930969
  (9443, 19)    4.7035396189880645
  (9452, 19)    -0.9924476181662789
  (9713, 19)    -3.2038209275781346
  (9719, 19)    0.6578276176100656
  (9847, 19)    9.57555910183088
  (9724, 19)    0.990362915454171
  (9855, 19)    1.153449284622368
</pre></div></div>
</div>
<p>From here, we could continue our workflow with a CuPy sparse matrix.</p>
<p>For a full list of the functionality built into these libraries, we encourage you to check out the API docs for <a class="reference external" href="https://docs.rapids.ai/api/cudf/nightly/">cuDF</a> and <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/index.html">CuPy</a>.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev" href="10min.html" id="prev-link" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">10 Minutes to cuDF and Dask-cuDF</p>
        </div>
    </a>
    <a class="right-next" href="guide-to-udfs.html" id="next-link" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Overview of User Defined Functions with cuDF</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2018-2021, NVIDIA.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  
<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script></body></html>