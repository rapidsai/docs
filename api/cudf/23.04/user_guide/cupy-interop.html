<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"><meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator">

    <title>Interoperability between cuDF and CuPy &mdash; cudf 23.04.00 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet">
  <link as="font" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2">

    <link href="../_static/pygments.css" rel="stylesheet" type="text/css">
    <link href="../_static/copybutton.css" rel="stylesheet" type="text/css">
    <link href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
    <link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet" type="text/css">
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" rel="preload">
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" rel="preload">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script defer="defer" src="https://docs.rapids.ai/assets/js/custom.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/cupy-interop';</script>
    <link href="../genindex.html" rel="index" title="Index">
    <link href="../search.html" rel="search" title="Search">
    <link href="options.html" rel="next" title="Options">
    <link href="guide-to-udfs.html" rel="prev" title="Overview of User Defined Functions with cuDF">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="en" name="docsearch:language">
  <script id="rapids-selector-pixel-src" src="https://assets.adobedtm.com/5d4962a43b79/814eb6e9b4e1/launch-4bc07f1e0b0b.min.js"></script><link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>
  
  
  <body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode data-offset="180">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox">
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox">
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input aria-label="Search the docs ..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." spellcheck="false" type="search">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img alt="Logo image" class="logo__image only-light" src="../_static/RAPIDS-logo-purple.png">
    <script>document.write(`<img src="../_static/RAPIDS-logo-purple.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="navbar-header-items">
    
    <div class="ms-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_docs/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../developer_guide/index.html">
                        Developer Guide
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/rapidsai/cudf" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/rapidsai" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar"><div id="rapids-pydata-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">cudf</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libcuspatial/stable">libcuspatial</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">nightly (23.04)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/nightly/index.html">nightly (23.04)</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/index.html">stable (23.02)</a><a class="rapids-selector__menu-item" href="/api/cudf/legacy/index.html">legacy (22.12)</a></div></div></div>
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_docs/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../developer_guide/index.html">
                        Developer Guide
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/rapidsai/cudf" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/rapidsai" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav aria-label="Section Navigation" class="bd-docs-nav bd-links">
  <p aria-level="1" class="bd-links__title" role="heading">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="10min.html">10 Minutes to cuDF and Dask-cuDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="pandas-comparison.html">Comparison of cuDF and Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-types.html">Supported Data Types</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="io/index.html">Input / Output</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="io/io.html">Input / Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="io/read-json.html">Working with JSON data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="missing-data.html">Working with missing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">GroupBy</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide-to-udfs.html">Overview of User Defined Functions with cuDF</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Interoperability between cuDF and CuPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="PandasCompat.html">Pandas Compatibility Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy-on-write.html">Copy-on-write</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main class="bd-main" id="main-content">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul aria-label="Breadcrumb" class="bd-breadcrumbs" role="navigation">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a aria-label="Home" class="nav-link" href="../index.html">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a class="nav-link" href="index.html">User Guide</a></li>
    
    <li aria-current="page" class="breadcrumb-item active">Interoperability between cuDF and CuPy</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="interoperability-between-cudf-and-cupy">
<h1>Interoperability between cuDF and CuPy<a class="headerlink" href="#interoperability-between-cudf-and-cupy" title="Permalink to this heading">#</a></h1>
<p>This notebook provides introductory examples of how you can use cuDF and CuPy together to take advantage of CuPy array functionality (such as advanced linear algebra operations).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>

<span class="kn">import</span> <span class="nn">cudf</span>

<span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"10.0.0"</span><span class="p">):</span>
    <span class="n">cupy_from_dlpack</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">from_dlpack</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cupy_from_dlpack</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">fromDlpack</span>
</pre></div>
</div>
</div>
</div>
<section id="converting-a-cudf-dataframe-to-a-cupy-array">
<h2>Converting a cuDF DataFrame to a CuPy Array<a class="headerlink" href="#converting-a-cudf-dataframe-to-a-cupy-array" title="Permalink to this heading">#</a></h2>
<p>If we want to convert a cuDF DataFrame to a CuPy ndarray, There are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p>We can use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">DataFrame.values</span></code>.</p></li>
<li><p>We can also convert via the <a class="reference external" href="https://numba.readthedocs.io/en/stable/cuda/cuda_array_interface.html">CUDA array interface</a> by using cuDF&rsquo;s <code class="docutils literal notranslate"><span class="pre">to_cupy</span></code> functionality.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">"a"</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelem</span><span class="p">),</span>
        <span class="s2">"b"</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">500</span><span class="p">),</span>
        <span class="s2">"c"</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="o">%</span><span class="k">timeit</span> arr_cupy = cupy_from_dlpack(df.to_dlpack())
<span class="o">%</span><span class="k">timeit</span> arr_cupy = df.values
<span class="o">%</span><span class="k">timeit</span> arr_cupy = df.to_cupy()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200 &micro;s &plusmn; 573 ns per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>627 &micro;s &plusmn; 1.39 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>632 &micro;s &plusmn; 1.11 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr_cupy</span> <span class="o">=</span> <span class="n">cupy_from_dlpack</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">arr_cupy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[    0,   500,  1000],
       [    1,   501,  1001],
       [    2,   502,  1002],
       ...,
       [ 9997, 10497, 10997],
       [ 9998, 10498, 10998],
       [ 9999, 10499, 10999]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="converting-a-cudf-series-to-a-cupy-array">
<h2>Converting a cuDF Series to a CuPy Array<a class="headerlink" href="#converting-a-cudf-series-to-a-cupy-array" title="Permalink to this heading">#</a></h2>
<p>There are also multiple ways to convert a cuDF Series to a CuPy array:</p>
<ol class="arabic simple">
<li><p>We can pass the Series to <code class="docutils literal notranslate"><span class="pre">cupy.asarray</span></code> as cuDF Series exposes <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/interoperability.html"><code class="docutils literal notranslate"><span class="pre">__cuda_array_interface__</span></code></a>.</p></li>
<li><p>We can leverage the dlpack interface <code class="docutils literal notranslate"><span class="pre">to_dlpack()</span></code>.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">Series.values</span></code></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="s2">"a"</span>

<span class="o">%</span><span class="k">timeit</span> cola_cupy = cp.asarray(df[col])
<span class="o">%</span><span class="k">timeit</span> cola_cupy = cupy_from_dlpack(df[col].to_dlpack())
<span class="o">%</span><span class="k">timeit</span> cola_cupy = df[col].values
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>89.4 &micro;s &plusmn; 179 ns per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>214 &micro;s &plusmn; 586 ns per loop (mean &plusmn; std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>189 &micro;s &plusmn; 244 ns per loop (mean &plusmn; std. dev. of 7 runs, 10000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cola_cupy</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">cola_cupy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   0,    1,    2, ..., 9997, 9998, 9999])
</pre></div>
</div>
</div>
</div>
<p>From here, we can proceed with normal CuPy workflows, such as reshaping the array, getting the diagonal, or calculating the norm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_arr</span> <span class="o">=</span> <span class="n">cola_cupy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">reshaped_arr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[   0,    1,    2, ...,  197,  198,  199],
       [ 200,  201,  202, ...,  397,  398,  399],
       [ 400,  401,  402, ...,  597,  598,  599],
       ...,
       [9400, 9401, 9402, ..., 9597, 9598, 9599],
       [9600, 9601, 9602, ..., 9797, 9798, 9799],
       [9800, 9801, 9802, ..., 9997, 9998, 9999]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   0,  201,  402,  603,  804, 1005, 1206, 1407, 1608, 1809, 2010,
       2211, 2412, 2613, 2814, 3015, 3216, 3417, 3618, 3819, 4020, 4221,
       4422, 4623, 4824, 5025, 5226, 5427, 5628, 5829, 6030, 6231, 6432,
       6633, 6834, 7035, 7236, 7437, 7638, 7839, 8040, 8241, 8442, 8643,
       8844, 9045, 9246, 9447, 9648, 9849])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array(577306.967739)
</pre></div>
</div>
</div>
</div>
</section>
<section id="converting-a-cupy-array-to-a-cudf-dataframe">
<h2>Converting a CuPy Array to a cuDF DataFrame<a class="headerlink" href="#converting-a-cupy-array-to-a-cudf-dataframe" title="Permalink to this heading">#</a></h2>
<p>We can also convert a CuPy ndarray to a cuDF DataFrame. Like before, there are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p><strong>Easiest;</strong> We can directly use the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can use CUDA array interface with the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can also use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
</ol>
<p>For the latter two cases, we&rsquo;ll need to make sure that our CuPy array is Fortran contiguous in memory (if it&rsquo;s not already). We can either transpose the array or simply coerce it to be Fortran contiguous beforehand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> reshaped_df = cudf.DataFrame(reshaped_arr)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>31.1 ms &plusmn; 102 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div></div>
</div>
<p>We can check whether our array is Fortran contiguous by using cupy.isfortran or looking at the <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/generated/cupy.ndarray.html#cupy.ndarray.flags">flags</a> of the array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span><span class="o">.</span><span class="n">isfortran</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>In this case, we&rsquo;ll need to convert it before going to a cuDF DataFrame. In the next two cells, we create the DataFrame by leveraging dlpack and the CUDA array interface, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.3 ms &plusmn; 102 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">fortran_arr</span><span class="o">.</span><span class="n">toDlpack</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8 ms &plusmn; 13.6 &micro;s per loop (mean &plusmn; std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div></div>
</div>
</section>
<section id="converting-a-cupy-array-to-a-cudf-series">
<h2>Converting a CuPy Array to a cuDF Series<a class="headerlink" href="#converting-a-cupy-array-to-a-cudf-series" title="Permalink to this heading">#</a></h2>
<p>To convert an array to a Series, we can directly pass the array to the <code class="docutils literal notranslate"><span class="pre">Series</span></code> constructor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cudf</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      0
1    201
2    402
3    603
4    804
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="interweaving-cudf-and-cupy-for-smooth-pydata-workflows">
<h2>Interweaving CuDF and CuPy for Smooth PyData Workflows<a class="headerlink" href="#interweaving-cudf-and-cupy-for-smooth-pydata-workflows" title="Permalink to this heading">#</a></h2>
<p>RAPIDS libraries and the entire GPU PyData ecosystem are developing quickly, but sometimes a one library may not have the functionality you need. One example of this might be taking the row-wise sum (or mean) of a Pandas DataFrame. cuDF&rsquo;s support for row-wise operations isn&rsquo;t mature, so you&rsquo;d need to either transpose the DataFrame or write a UDF and explicitly calculate the sum across each row. Transposing could lead to hundreds of thousands of columns (which cuDF wouldn&rsquo;t perform well with) depending on your data&rsquo;s shape, and writing a UDF can be time intensive.</p>
<p>By leveraging the interoperability of the GPU PyData ecosystem, this operation becomes very easy. Let&rsquo;s take the row-wise sum of our previously reshaped cuDF DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>190</th>
      <th>191</th>
      <th>192</th>
      <th>193</th>
      <th>194</th>
      <th>195</th>
      <th>196</th>
      <th>197</th>
      <th>198</th>
      <th>199</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>...</td>
      <td>190</td>
      <td>191</td>
      <td>192</td>
      <td>193</td>
      <td>194</td>
      <td>195</td>
      <td>196</td>
      <td>197</td>
      <td>198</td>
      <td>199</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>201</td>
      <td>202</td>
      <td>203</td>
      <td>204</td>
      <td>205</td>
      <td>206</td>
      <td>207</td>
      <td>208</td>
      <td>209</td>
      <td>...</td>
      <td>390</td>
      <td>391</td>
      <td>392</td>
      <td>393</td>
      <td>394</td>
      <td>395</td>
      <td>396</td>
      <td>397</td>
      <td>398</td>
      <td>399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400</td>
      <td>401</td>
      <td>402</td>
      <td>403</td>
      <td>404</td>
      <td>405</td>
      <td>406</td>
      <td>407</td>
      <td>408</td>
      <td>409</td>
      <td>...</td>
      <td>590</td>
      <td>591</td>
      <td>592</td>
      <td>593</td>
      <td>594</td>
      <td>595</td>
      <td>596</td>
      <td>597</td>
      <td>598</td>
      <td>599</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600</td>
      <td>601</td>
      <td>602</td>
      <td>603</td>
      <td>604</td>
      <td>605</td>
      <td>606</td>
      <td>607</td>
      <td>608</td>
      <td>609</td>
      <td>...</td>
      <td>790</td>
      <td>791</td>
      <td>792</td>
      <td>793</td>
      <td>794</td>
      <td>795</td>
      <td>796</td>
      <td>797</td>
      <td>798</td>
      <td>799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>800</td>
      <td>801</td>
      <td>802</td>
      <td>803</td>
      <td>804</td>
      <td>805</td>
      <td>806</td>
      <td>807</td>
      <td>808</td>
      <td>809</td>
      <td>...</td>
      <td>990</td>
      <td>991</td>
      <td>992</td>
      <td>993</td>
      <td>994</td>
      <td>995</td>
      <td>996</td>
      <td>997</td>
      <td>998</td>
      <td>999</td>
    </tr>
  </tbody>
</table>
<p>5 rows &times; 200 columns</p>
</div></div></div>
</div>
<p>We can just transform it into a CuPy array and use the <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument of <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_arr</span> <span class="o">=</span> <span class="n">cupy_from_dlpack</span><span class="p">(</span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">new_arr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  19900,   59900,   99900,  139900,  179900,  219900,  259900,
        299900,  339900,  379900,  419900,  459900,  499900,  539900,
        579900,  619900,  659900,  699900,  739900,  779900,  819900,
        859900,  899900,  939900,  979900, 1019900, 1059900, 1099900,
       1139900, 1179900, 1219900, 1259900, 1299900, 1339900, 1379900,
       1419900, 1459900, 1499900, 1539900, 1579900, 1619900, 1659900,
       1699900, 1739900, 1779900, 1819900, 1859900, 1899900, 1939900,
       1979900])
</pre></div>
</div>
</div>
</div>
<p>With just that single line, we&rsquo;re able to seamlessly move between data structures in this ecosystem, giving us enormous flexibility without sacrificing speed.</p>
</section>
<section id="converting-a-cudf-dataframe-to-a-cupy-sparse-matrix">
<h2>Converting a cuDF DataFrame to a CuPy Sparse Matrix<a class="headerlink" href="#converting-a-cudf-dataframe-to-a-cupy-sparse-matrix" title="Permalink to this heading">#</a></h2>
<p>We can also convert a DataFrame or Series to a CuPy sparse matrix. We might want to do this if downstream processes expect CuPy sparse matrices as an input.</p>
<p>The sparse matrix data structure is defined by three dense arrays. We&rsquo;ll define a small helper function for cleanliness.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sparseformat</span><span class="o">=</span><span class="s2">"column"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Converts a cuDF object to a CuPy Sparse Column matrix."""</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="s2">"row"</span><span class="p">,</span>
        <span class="s2">"column"</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Let's focus on column and row formats for now."</span><span class="p">)</span>

    <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="o">==</span> <span class="s2">"row"</span><span class="p">:</span>
        <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span>

    <span class="k">return</span> <span class="n">_sparse_constructor</span><span class="p">(</span><span class="n">cupy_from_dlpack</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>We can define a sparsely populated DataFrame to illustrate this conversion to either sparse matrix format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nelem</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nelem</span> <span class="o">-</span> <span class="n">nonzero</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">"a"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">arr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a0</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
      <th>a6</th>
      <th>a7</th>
      <th>a8</th>
      <th>a9</th>
      <th>a10</th>
      <th>a11</th>
      <th>a12</th>
      <th>a13</th>
      <th>a14</th>
      <th>a15</th>
      <th>a16</th>
      <th>a17</th>
      <th>a18</th>
      <th>a19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.969068</td>
      <td>-7.537624</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.30723</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.220753</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>2.854398</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>8.870761</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>8.34279</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>8.257539</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>5.009558</td>
      <td>7.659468</td>
      <td>0.000000</td>
      <td>11.068721</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sparse_data</span> <span class="o">=</span> <span class="n">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sparse_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  (130, 0)	-3.132355183125015
  (386, 0)	-1.5635836968178662
  (642, 0)	11.676102930987266
  (1154, 0)	0.2017974386550414
  (131, 0)	3.25203866918644
  (515, 0)	3.2516672620540517
  (772, 0)	-2.2621194445710593
  (1029, 0)	8.967178972054116
  (134, 0)	1.3251993581540185
  (140, 0)	5.8064732111550805
  (908, 0)	2.3010839478765455
  (1164, 0)	4.195856311350836
  (270, 0)	0.27901165943099604
  (655, 0)	6.287245676608876
  (16, 0)	11.627501331943549
  (401, 0)	-0.3335119028287925
  (787, 0)	0.668475846060449
  (1172, 0)	-5.915466718263243
  (149, 0)	4.0444145974704435
  (918, 0)	7.795656883366045
  (664, 0)	6.175196006858376
  (410, 0)	7.811699583748999
  (1050, 0)	-6.3377477114288165
  (1180, 0)	11.304309351295549
  (2305, 0)	2.0240541330584767
  :	:
  (9340, 19)	7.057039871085778
  (9468, 19)	3.3113701223736274
  (9469, 19)	5.689753571301774
  (7806, 19)	8.16163385228578
  (8318, 19)	5.818303059189008
  (8574, 19)	5.771815786678733
  (7679, 19)	6.3217353813871675
  (8319, 19)	6.3927547157493425
  (8575, 19)	2.201656531005629
  (9471, 19)	9.67076361426245
  (9568, 19)	11.928964884556176
  (9697, 19)	11.297747900591485
  (9570, 19)	3.504362747438115
  (9955, 19)	2.672453192354329
  (9833, 19)	-2.877191298010354
  (9841, 19)	8.974492428084066
  (9587, 19)	8.303050546480701
  (9715, 19)	11.948769194616274
  (9843, 19)	6.8613202513613984
  (9972, 19)	6.166193009117482
  (9592, 19)	10.814229845684528
  (9977, 19)	5.860427892711255
  (9597, 19)	16.016102662406603
  (9855, 19)	5.045606514620841
  (9983, 19)	6.7330415381921345
</pre></div>
</div>
</div>
</div>
<p>From here, we could continue our workflow with a CuPy sparse matrix.</p>
<p>For a full list of the functionality built into these libraries, we encourage you to check out the API docs for <a class="reference external" href="https://docs.rapids.ai/api/cudf/nightly/">cuDF</a> and <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/index.html">CuPy</a>.</p>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev" href="guide-to-udfs.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview of User Defined Functions with cuDF</p>
      </div>
    </a>
    <a class="right-next" href="options.html" title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Options</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-a-cudf-dataframe-to-a-cupy-array">Converting a cuDF DataFrame to a CuPy Array</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-a-cudf-series-to-a-cupy-array">Converting a cuDF Series to a CuPy Array</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-a-cupy-array-to-a-cudf-dataframe">Converting a CuPy Array to a cuDF DataFrame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-a-cupy-array-to-a-cudf-series">Converting a CuPy Array to a cuDF Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interweaving-cudf-and-cupy-for-smooth-pydata-workflows">Interweaving CuDF and CuPy for Smooth PyData Workflows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-a-cudf-dataframe-to-a-cupy-sparse-matrix">Converting a cuDF DataFrame to a CuPy Sparse Matrix</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/cupy-interop.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      &copy; Copyright 2018-2023, NVIDIA Corporation.
      <br>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  
<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script><script id="rapids-selector-pixel-invocation" type="text/javascript">_satellite.pageBottom();</script></body></html>