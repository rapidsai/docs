
<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>10 Minutes to cuDF and CuPy — cudf 0.18.0 documentation</title>
<link href="_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="_static/params.css" rel="stylesheet" type="text/css"/>
<link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js" type="text/javascript"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/clipboard.min.js"></script>
<script src="_static/copybutton.js"></script>
<script src="_static/copybutton_pydocs.js"></script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script src="_static/js/theme.js" type="text/javascript"></script>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="guide-to-udfs.html" rel="next" title="Overview of User Defined Functions with cuDF"/>
<link href="dask-cudf.html" rel="prev" title="Multi-GPU with Dask-cuDF"/>
<link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"/></head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search"><div id="rapids-sphinx-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">cudf</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/stable/api.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/legacy">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable/api.html">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable/api.html">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">stable (0.18)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/cudf/nightly/api.html">nightly (0.19)</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cudf/stable/api.html">stable (0.18)</a><a class="rapids-selector__menu-item" href="/api/cudf/legacy/api.html">legacy (0.17)</a></div></div></div>
<div role="search">
<form action="search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">cuDF API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="10min.html">10 Minutes to cuDF and Dask-cuDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Input / Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">GroupBy</a></li>
<li class="toctree-l1"><a class="reference internal" href="dask-cudf.html">Multi-GPU with Dask-cuDF</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10 Minutes to cuDF and CuPy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Array">Converting a cuDF DataFrame to a CuPy Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Converting-a-cuDF-Series-to-a-CuPy-Array">Converting a cuDF Series to a CuPy Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Converting-a-CuPy-Array-to-a-cuDF-DataFrame">Converting a CuPy Array to a cuDF DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Converting-a-CuPy-Array-to-a-cuDF-Series">Converting a CuPy Array to a cuDF Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows">Interweaving CuDF and CuPy for Smooth PyData Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix">Converting a cuDF DataFrame to a CuPy Sparse Matrix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guide-to-udfs.html">Overview of User Defined Functions with cuDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">cuDF internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="Working-with-missing-data.html">Working with missing data</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="index.html">cudf</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a class="icon icon-home" href="index.html"></a> »</li>
<li>10 Minutes to cuDF and CuPy</li>
<li class="wy-breadcrumbs-aside">
<a href="_sources/10min-cudf-cupy.ipynb.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="10-Minutes-to-cuDF-and-CuPy">
<h1>10 Minutes to cuDF and CuPy<a class="headerlink" href="#10-Minutes-to-cuDF-and-CuPy" title="Permalink to this headline">¶</a></h1>
<p>This notebook provides introductory examples of how you can use cuDF and CuPy together to take advantage of CuPy array functionality (such as advanced linear algebra operations).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">import</span> <span class="nn">cudf</span>
</pre></div>
</div>
</div>
<div class="section" id="Converting-a-cuDF-DataFrame-to-a-CuPy-Array">
<h2>Converting a cuDF DataFrame to a CuPy Array<a class="headerlink" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Array" title="Permalink to this headline">¶</a></h2>
<p>If we want to convert a cuDF DataFrame to a CuPy ndarray, There are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p>We can use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">DataFrame.values</span></code>.</p></li>
<li><p>We can also convert via the <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/cuda/cuda_array_interface.html">CUDA array interface</a> by using cuDF’s <code class="docutils literal notranslate"><span class="pre">as_gpu_matrix</span></code> and CuPy’s <code class="docutils literal notranslate"><span class="pre">asarray</span></code> functionality.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'a'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="n">nelem</span><span class="p">),</span>
                     <span class="s1">'b'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">500</span><span class="p">),</span>
                     <span class="s1">'c'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nelem</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)}</span>
                   <span class="p">)</span>

<span class="o">%</span><span class="k">timeit</span> arr_cupy = cp.fromDlpack(df.to_dlpack())
<span class="o">%</span><span class="k">timeit</span> arr_cupy = df.values
<span class="o">%</span><span class="k">timeit</span> arr_cupy = cp.asarray(df.as_gpu_matrix())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44.1 µs ± 689 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
209 µs ± 2.77 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
208 µs ± 3.14 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr_cupy</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">fromDlpack</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">arr_cupy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[    0,   500,  1000],
       [    1,   501,  1001],
       [    2,   502,  1002],
       ...,
       [ 9997, 10497, 10997],
       [ 9998, 10498, 10998],
       [ 9999, 10499, 10999]])
</pre></div></div>
</div>
</div>
<div class="section" id="Converting-a-cuDF-Series-to-a-CuPy-Array">
<h2>Converting a cuDF Series to a CuPy Array<a class="headerlink" href="#Converting-a-cuDF-Series-to-a-CuPy-Array" title="Permalink to this headline">¶</a></h2>
<p>There are also multiple ways to convert a cuDF Series to a CuPy array:</p>
<ol class="arabic simple">
<li><p>We can pass the Series to <code class="docutils literal notranslate"><span class="pre">cupy.asarray</span></code> as cuDF Series exposes <code class="docutils literal notranslate"><span class="pre">`__cuda_array_interface__</span></code> &lt;<a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/interoperability.html">https://docs-cupy.chainer.org/en/stable/reference/interoperability.html</a>&gt;`__.</p></li>
<li><p>We can leverage the dlpack interface <code class="docutils literal notranslate"><span class="pre">to_dlpack()</span></code>.</p></li>
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">Series.values</span></code></p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">col</span> <span class="o">=</span> <span class="s1">'a'</span>

<span class="o">%</span><span class="k">timeit</span> cola_cupy = cp.asarray(df[col])
<span class="o">%</span><span class="k">timeit</span> cola_cupy = cp.fromDlpack(df[col].to_dlpack())
<span class="o">%</span><span class="k">timeit</span> cola_cupy = df[col].values
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22.1 µs ± 518 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
58.3 µs ± 647 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
80.2 µs ± 647 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cola_cupy</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">cola_cupy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([   0,    1,    2, ..., 9997, 9998, 9999])
</pre></div></div>
</div>
<p>From here, we can proceed with normal CuPy workflows, such as reshaping the array, getting the diagonal, or calculating the norm.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reshaped_arr</span> <span class="o">=</span> <span class="n">cola_cupy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">reshaped_arr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[   0,    1,    2, ...,  197,  198,  199],
       [ 200,  201,  202, ...,  397,  398,  399],
       [ 400,  401,  402, ...,  597,  598,  599],
       ...,
       [9400, 9401, 9402, ..., 9597, 9598, 9599],
       [9600, 9601, 9602, ..., 9797, 9798, 9799],
       [9800, 9801, 9802, ..., 9997, 9998, 9999]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([   0,  201,  402,  603,  804, 1005, 1206, 1407, 1608, 1809, 2010,
       2211, 2412, 2613, 2814, 3015, 3216, 3417, 3618, 3819, 4020, 4221,
       4422, 4623, 4824, 5025, 5226, 5427, 5628, 5829, 6030, 6231, 6432,
       6633, 6834, 7035, 7236, 7437, 7638, 7839, 8040, 8241, 8442, 8643,
       8844, 9045, 9246, 9447, 9648, 9849])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(577306.967739)
</pre></div></div>
</div>
</div>
<div class="section" id="Converting-a-CuPy-Array-to-a-cuDF-DataFrame">
<h2>Converting a CuPy Array to a cuDF DataFrame<a class="headerlink" href="#Converting-a-CuPy-Array-to-a-cuDF-DataFrame" title="Permalink to this headline">¶</a></h2>
<p>We can also convert a CuPy ndarray to a cuDF DataFrame. Like before, there are multiple ways to do it:</p>
<ol class="arabic simple">
<li><p><strong>Easiest;</strong> We can directly use the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can use CUDA array interface with the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> constructor.</p></li>
<li><p>We can also use the <a class="reference external" href="https://github.com/dmlc/dlpack">dlpack</a> interface.</p></li>
</ol>
<p>For the latter two cases, we’ll need to make sure that our CuPy array is Fortran contiguous in memory (if it’s not already). We can either transpose the array or simply coerce it to be Fortran contiguous beforehand.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">timeit</span> reshaped_df = cudf.DataFrame(reshaped_arr)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
13.1 ms ± 193 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>190</th>
<th>191</th>
<th>192</th>
<th>193</th>
<th>194</th>
<th>195</th>
<th>196</th>
<th>197</th>
<th>198</th>
<th>199</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>...</td>
<td>190</td>
<td>191</td>
<td>192</td>
<td>193</td>
<td>194</td>
<td>195</td>
<td>196</td>
<td>197</td>
<td>198</td>
<td>199</td>
</tr>
<tr>
<th>1</th>
<td>200</td>
<td>201</td>
<td>202</td>
<td>203</td>
<td>204</td>
<td>205</td>
<td>206</td>
<td>207</td>
<td>208</td>
<td>209</td>
<td>...</td>
<td>390</td>
<td>391</td>
<td>392</td>
<td>393</td>
<td>394</td>
<td>395</td>
<td>396</td>
<td>397</td>
<td>398</td>
<td>399</td>
</tr>
<tr>
<th>2</th>
<td>400</td>
<td>401</td>
<td>402</td>
<td>403</td>
<td>404</td>
<td>405</td>
<td>406</td>
<td>407</td>
<td>408</td>
<td>409</td>
<td>...</td>
<td>590</td>
<td>591</td>
<td>592</td>
<td>593</td>
<td>594</td>
<td>595</td>
<td>596</td>
<td>597</td>
<td>598</td>
<td>599</td>
</tr>
<tr>
<th>3</th>
<td>600</td>
<td>601</td>
<td>602</td>
<td>603</td>
<td>604</td>
<td>605</td>
<td>606</td>
<td>607</td>
<td>608</td>
<td>609</td>
<td>...</td>
<td>790</td>
<td>791</td>
<td>792</td>
<td>793</td>
<td>794</td>
<td>795</td>
<td>796</td>
<td>797</td>
<td>798</td>
<td>799</td>
</tr>
<tr>
<th>4</th>
<td>800</td>
<td>801</td>
<td>802</td>
<td>803</td>
<td>804</td>
<td>805</td>
<td>806</td>
<td>807</td>
<td>808</td>
<td>809</td>
<td>...</td>
<td>990</td>
<td>991</td>
<td>992</td>
<td>993</td>
<td>994</td>
<td>995</td>
<td>996</td>
<td>997</td>
<td>998</td>
<td>999</td>
</tr>
</tbody>
</table>
<p>5 rows × 200 columns</p>
</div></div>
</div>
<p>We can check whether our array is Fortran contiguous by using cupy.isfortran or looking at the <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/reference/generated/cupy.ndarray.html#cupy.ndarray.flags">flags</a> of the array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cp</span><span class="o">.</span><span class="n">isfortran</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<p>In this case, we’ll need to convert it before going to a cuDF DataFrame. In the next two cells, we create the DataFrame by leveraging dlpack and the CUDA array interface, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.9 ms ± 26.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>it

<span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">fortran_arr</span><span class="o">.</span><span class="n">toDlpack</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5.1 ms ± 23.3 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fortran_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fortran_arr</span><span class="p">)</span>
<span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>190</th>
<th>191</th>
<th>192</th>
<th>193</th>
<th>194</th>
<th>195</th>
<th>196</th>
<th>197</th>
<th>198</th>
<th>199</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>...</td>
<td>190</td>
<td>191</td>
<td>192</td>
<td>193</td>
<td>194</td>
<td>195</td>
<td>196</td>
<td>197</td>
<td>198</td>
<td>199</td>
</tr>
<tr>
<th>1</th>
<td>200</td>
<td>201</td>
<td>202</td>
<td>203</td>
<td>204</td>
<td>205</td>
<td>206</td>
<td>207</td>
<td>208</td>
<td>209</td>
<td>...</td>
<td>390</td>
<td>391</td>
<td>392</td>
<td>393</td>
<td>394</td>
<td>395</td>
<td>396</td>
<td>397</td>
<td>398</td>
<td>399</td>
</tr>
<tr>
<th>2</th>
<td>400</td>
<td>401</td>
<td>402</td>
<td>403</td>
<td>404</td>
<td>405</td>
<td>406</td>
<td>407</td>
<td>408</td>
<td>409</td>
<td>...</td>
<td>590</td>
<td>591</td>
<td>592</td>
<td>593</td>
<td>594</td>
<td>595</td>
<td>596</td>
<td>597</td>
<td>598</td>
<td>599</td>
</tr>
<tr>
<th>3</th>
<td>600</td>
<td>601</td>
<td>602</td>
<td>603</td>
<td>604</td>
<td>605</td>
<td>606</td>
<td>607</td>
<td>608</td>
<td>609</td>
<td>...</td>
<td>790</td>
<td>791</td>
<td>792</td>
<td>793</td>
<td>794</td>
<td>795</td>
<td>796</td>
<td>797</td>
<td>798</td>
<td>799</td>
</tr>
<tr>
<th>4</th>
<td>800</td>
<td>801</td>
<td>802</td>
<td>803</td>
<td>804</td>
<td>805</td>
<td>806</td>
<td>807</td>
<td>808</td>
<td>809</td>
<td>...</td>
<td>990</td>
<td>991</td>
<td>992</td>
<td>993</td>
<td>994</td>
<td>995</td>
<td>996</td>
<td>997</td>
<td>998</td>
<td>999</td>
</tr>
</tbody>
</table>
<p>5 rows × 200 columns</p>
</div></div>
</div>
</div>
<div class="section" id="Converting-a-CuPy-Array-to-a-cuDF-Series">
<h2>Converting a CuPy Array to a cuDF Series<a class="headerlink" href="#Converting-a-CuPy-Array-to-a-cuDF-Series" title="Permalink to this headline">¶</a></h2>
<p>To convert an array to a Series, we can directly pass the array to the <code class="docutils literal notranslate"><span class="pre">Series</span></code> constructor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cudf</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reshaped_arr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0      0
1    201
2    402
3    603
4    804
dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows">
<h2>Interweaving CuDF and CuPy for Smooth PyData Workflows<a class="headerlink" href="#Interweaving-CuDF-and-CuPy-for-Smooth-PyData-Workflows" title="Permalink to this headline">¶</a></h2>
<p>RAPIDS libraries and the entire GPU PyData ecosystem are developing quickly, but sometimes a one library may not have the functionality you need. One example of this might be taking the row-wise sum (or mean) of a Pandas DataFrame. cuDF’s support for row-wise operations isn’t mature, so you’d need to either transpose the DataFrame or write a UDF and explicitly calculate the sum across each row. Transposing could lead to hundreds of thousands of columns (which cuDF wouldn’t perform well with)
depending on your data’s shape, and writing a UDF can be time intensive.</p>
<p>By leveraging the interoperability of the GPU PyData ecosystem, this operation becomes very easy. Let’s take the row-wise sum of our previously reshaped cuDF DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>190</th>
<th>191</th>
<th>192</th>
<th>193</th>
<th>194</th>
<th>195</th>
<th>196</th>
<th>197</th>
<th>198</th>
<th>199</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>...</td>
<td>190</td>
<td>191</td>
<td>192</td>
<td>193</td>
<td>194</td>
<td>195</td>
<td>196</td>
<td>197</td>
<td>198</td>
<td>199</td>
</tr>
<tr>
<th>1</th>
<td>200</td>
<td>201</td>
<td>202</td>
<td>203</td>
<td>204</td>
<td>205</td>
<td>206</td>
<td>207</td>
<td>208</td>
<td>209</td>
<td>...</td>
<td>390</td>
<td>391</td>
<td>392</td>
<td>393</td>
<td>394</td>
<td>395</td>
<td>396</td>
<td>397</td>
<td>398</td>
<td>399</td>
</tr>
<tr>
<th>2</th>
<td>400</td>
<td>401</td>
<td>402</td>
<td>403</td>
<td>404</td>
<td>405</td>
<td>406</td>
<td>407</td>
<td>408</td>
<td>409</td>
<td>...</td>
<td>590</td>
<td>591</td>
<td>592</td>
<td>593</td>
<td>594</td>
<td>595</td>
<td>596</td>
<td>597</td>
<td>598</td>
<td>599</td>
</tr>
<tr>
<th>3</th>
<td>600</td>
<td>601</td>
<td>602</td>
<td>603</td>
<td>604</td>
<td>605</td>
<td>606</td>
<td>607</td>
<td>608</td>
<td>609</td>
<td>...</td>
<td>790</td>
<td>791</td>
<td>792</td>
<td>793</td>
<td>794</td>
<td>795</td>
<td>796</td>
<td>797</td>
<td>798</td>
<td>799</td>
</tr>
<tr>
<th>4</th>
<td>800</td>
<td>801</td>
<td>802</td>
<td>803</td>
<td>804</td>
<td>805</td>
<td>806</td>
<td>807</td>
<td>808</td>
<td>809</td>
<td>...</td>
<td>990</td>
<td>991</td>
<td>992</td>
<td>993</td>
<td>994</td>
<td>995</td>
<td>996</td>
<td>997</td>
<td>998</td>
<td>999</td>
</tr>
</tbody>
</table>
<p>5 rows × 200 columns</p>
</div></div>
</div>
<p>We can just transform it into a CuPy array and use the <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument of <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">fromDlpack</span><span class="p">(</span><span class="n">reshaped_df</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span>
<span class="n">new_arr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([  19900,   59900,   99900,  139900,  179900,  219900,  259900,
        299900,  339900,  379900,  419900,  459900,  499900,  539900,
        579900,  619900,  659900,  699900,  739900,  779900,  819900,
        859900,  899900,  939900,  979900, 1019900, 1059900, 1099900,
       1139900, 1179900, 1219900, 1259900, 1299900, 1339900, 1379900,
       1419900, 1459900, 1499900, 1539900, 1579900, 1619900, 1659900,
       1699900, 1739900, 1779900, 1819900, 1859900, 1899900, 1939900,
       1979900])
</pre></div></div>
</div>
<p>With just that single line, we’re able to seamlessly move between data structures in this ecosystem, giving us enormous flexibility without sacrificing speed.</p>
</div>
<div class="section" id="Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix">
<h2>Converting a cuDF DataFrame to a CuPy Sparse Matrix<a class="headerlink" href="#Converting-a-cuDF-DataFrame-to-a-CuPy-Sparse-Matrix" title="Permalink to this headline">¶</a></h2>
<p>We can also convert a DataFrame or Series to a CuPy sparse matrix. We might want to do this if downstream processes expect CuPy sparse matrices as an input.</p>
<p>The sparse matrix data structure is defined by three dense arrays. We’ll define a small helper function for cleanliness.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sparseformat</span><span class="o">=</span><span class="s1">'column'</span><span class="p">):</span>
    <span class="sd">"""Converts a cuDF object to a CuPy Sparse Column matrix.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Let's focus on column and row formats for now."</span><span class="p">)</span>

    <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span>
    <span class="k">if</span> <span class="n">sparseformat</span> <span class="o">==</span> <span class="s1">'row'</span><span class="p">:</span>
        <span class="n">_sparse_constructor</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span>

    <span class="k">return</span> <span class="n">_sparse_constructor</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">fromDlpack</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<p>We can define a sparsely populated DataFrame to illustrate this conversion to either sparse matrix format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">nelem</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nelem</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nelem</span><span class="o">-</span><span class="n">nonzero</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'a'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>a0</th>
<th>a1</th>
<th>a2</th>
<th>a3</th>
<th>a4</th>
<th>a5</th>
<th>a6</th>
<th>a7</th>
<th>a8</th>
<th>a9</th>
<th>a10</th>
<th>a11</th>
<th>a12</th>
<th>a13</th>
<th>a14</th>
<th>a15</th>
<th>a16</th>
<th>a17</th>
<th>a18</th>
<th>a19</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.00000</td>
<td>0.0</td>
<td>16.822959</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
</tr>
<tr>
<th>1</th>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
</tr>
<tr>
<th>2</th>
<td>0.0</td>
<td>0.0</td>
<td>6.618972</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>2.25678</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
</tr>
<tr>
<th>3</th>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>2.715802</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
</tr>
<tr>
<th>4</th>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.296568</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.865495</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sparse_data</span> <span class="o">=</span> <span class="n">cudf_to_cupy_sparse_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">sparse_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;cupyx.scipy.sparse.csc.csc_matrix at 0x7f25e49466a0&gt;
</pre></div></div>
</div>
<p>From here, we could continue our workflow with a CuPy sparse matrix.</p>
<p>For a full list of the functionality built into these libraries, we encourage you to check out the API docs for <a class="reference external" href="https://docs.rapids.ai/api/cudf/nightly/">cuDF</a> and <a class="reference external" href="https://docs-cupy.chainer.org/en/stable/index.html">CuPy</a>.</p>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a accesskey="n" class="btn btn-neutral float-right" href="guide-to-udfs.html" rel="next" title="Overview of User Defined Functions with cuDF">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
<a accesskey="p" class="btn btn-neutral float-left" href="dask-cudf.html" rel="prev" title="Multi-GPU with Dask-cuDF"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<p>
        © Copyright 2018-2021, NVIDIA.

    </p>
</div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
</div>
</div>
</section>
</div>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script></body>
</html>