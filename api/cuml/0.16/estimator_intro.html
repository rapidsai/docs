
<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Training and Evaluating Machine Learning Models in cuML — cuml 0.16.0 documentation</title>
<link href="_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="_static/params.css" rel="stylesheet" type="text/css"/>
<link href="_static/references.css" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js" type="text/javascript"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/language_data.js"></script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
<script src="_static/js/theme.js" type="text/javascript"></script>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="cuml_blogs.html" rel="prev" title="cuML blogs and other references"/>
<link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"/></head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search"><div id="rapids-sphinx-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">cuml</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/api.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable/api.html">cugraph</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable/api.html">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libnvstrings/stable/annotated.html">libnvstrings</a><a class="rapids-selector__menu-item" href="/api/nvstrings/stable/api.html">nvstrings</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/annotated.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">nightly (0.16)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cuml/nightly/api.html">nightly (0.16)</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">stable (0.15)</a><a class="rapids-selector__menu-item" href="/api/cuml/legacy/api.html">legacy (0.14)</a></div></div></div>


<div role="search">
<form action="search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">cuML API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuml_intro.html">Intro and key concepts for cuML</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuml_blogs.html">cuML blogs and other references</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Training and Evaluating Machine Learning Models in cuML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Shared-Library-Imports">Shared Library Imports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1.-Classification">1. Classification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Random-Forest-Classification-and-Accuracy-metrics">Random Forest Classification and Accuracy metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Clustering">Clustering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#UMAP-and-Trustworthiness-metrics">UMAP and Trustworthiness metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#DBSCAN-and-Adjusted-Random-Index">DBSCAN and Adjusted Random Index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Regression">Regression</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Linear-regression-and-R^2-score">Linear regression and R^2 score</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="index.html">cuml</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a class="icon icon-home" href="index.html"></a> »</li>
<li>Training and Evaluating Machine Learning Models in cuML</li>
<li class="wy-breadcrumbs-aside">
<a href="_sources/estimator_intro.ipynb.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Training-and-Evaluating-Machine-Learning-Models-in-cuML">
<h1>Training and Evaluating Machine Learning Models in cuML<a class="headerlink" href="#Training-and-Evaluating-Machine-Learning-Models-in-cuML" title="Permalink to this headline">¶</a></h1>
<p>This notebook explores several basic machine learning estimators in cuML, demonstrating how to train them and evaluate them with built-in metrics functions. All of the models are trained on synthetic data, generated by cuML’s dataset utilities.</p>
<ol class="arabic simple">
<li><p>Random Forest Classifier</p></li>
<li><p>UMAP</p></li>
<li><p>DBSCAN</p></li>
<li><p>Linear Regression</p></li>
</ol>
<p><a class="reference external" href="https://colab.research.google.com/github/rapidsai/cuml/blob/branch-0.15/docs/source/estimator_intro.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a></p>
<div class="section" id="Shared-Library-Imports">
<h2>Shared Library Imports<a class="headerlink" href="#Shared-Library-Imports" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">cuml</span>
<span class="kn">from</span> <span class="nn">cupy</span> <span class="kn">import</span> <span class="n">asnumpy</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span><span class="p">,</span> <span class="n">load</span>
</pre></div>
</div>
</div>
<div class="section" id="1.-Classification">
<h3>1. Classification<a class="headerlink" href="#1.-Classification" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="Random-Forest-Classification-and-Accuracy-metrics">
<h2>Random Forest Classification and Accuracy metrics<a class="headerlink" href="#Random-Forest-Classification-and-Accuracy-metrics" title="Permalink to this headline">¶</a></h2>
<p>The Random Forest algorithm classification model builds several decision trees, and aggregates each of their outputs to make a prediction. For more information on cuML’s implementation of the Random Forest Classification model please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.ensemble.RandomForestClassifier">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.ensemble.RandomForestClassifier</a></p>
<p>Accuracy score is the ratio of correct predictions to the total number of predictions. It is used to measure the performance of classification models. For more information on the accuracy score metric please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Accuracy_and_precision">https://en.wikipedia.org/wiki/Accuracy_and_precision</a></p>
<p>For more information on cuML’s implementation of accuracy score metrics please refer to: <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.accuracy.accuracy_score">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.accuracy.accuracy_score</a></p>
<p>The cell below shows an end to end pipeline of the Random Forest Classification model. Here the dataset was generated by using sklearn’s make_classification dataset. The generated dataset was used to train and run predict on the model. Random forest’s performance is evaluated and then compared between the values obtained from the cuML and sklearn accuracy metrics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cuml.datasets.classification</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">cuml.preprocessing.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">cuml.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span> <span class="k">as</span> <span class="n">cuRF</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="c1"># synthetic dataset dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># random forest depth and size</span>
<span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">max_depth</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># generate synthetic data [ binary classification task ]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span> <span class="p">(</span> <span class="n">n_classes</span> <span class="o">=</span> <span class="n">n_classes</span><span class="p">,</span>
                             <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                             <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                             <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">cuRF</span><span class="p">(</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="n">max_depth</span><span class="p">,</span>
              <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span><span class="p">,</span>
              <span class="n">seed</span>  <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">trained_RF</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span> <span class="n">X_test</span> <span class="p">)</span>

<span class="n">cu_score</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span> <span class="p">)</span>
<span class="n">sk_score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">y_test</span> <span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">predictions</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="s2">" cuml accuracy: "</span><span class="p">,</span> <span class="n">cu_score</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s2">" sklearn accuracy : "</span><span class="p">,</span> <span class="n">sk_score</span> <span class="p">)</span>

<span class="c1"># save</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_RF</span><span class="p">,</span> <span class="s1">'RF.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">'RF.model'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/conda/envs/rapids/lib/python3.7/site-packages/ipykernel_launcher.py:25: DeprecationWarning: Parameter 'seed' is deprecated and will be removed in 0.17. Please use 'random_state' instead. Setting 'random_state' as the curent 'seed' value
/opt/conda/envs/rapids/lib/python3.7/site-packages/ipykernel_launcher.py:25: UserWarning: For reproducible results in Random Forest Classifier or for almost reproducible results in Random Forest Regressor, n_streams==1 is recommended. If n_streams is &gt; 1, results may vary due to stream/thread timing differences, even when random_state is set
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 cuml accuracy:  0.9800000190734863
 sklearn accuracy :  0.98
</pre></div></div>
</div>
<div class="section" id="Clustering">
<h3>Clustering<a class="headerlink" href="#Clustering" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="UMAP-and-Trustworthiness-metrics">
<h2>UMAP and Trustworthiness metrics<a class="headerlink" href="#UMAP-and-Trustworthiness-metrics" title="Permalink to this headline">¶</a></h2>
<p>UMAP is a dimensionality reduction algorithm which performs non-linear dimension reduction. It can also be used for visualization. For additional information on the UMAP model please refer to the documentation on <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.UMAP">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.UMAP</a></p>
<p>Trustworthiness is a measure of the extent to which the local structure is retained in the embedding of the model. Therefore, if a sample predicted by the model lay within the unexpected region of the nearest neighbors, then those samples would be penalized. For more information on the trustworthiness metric please refer to: <a class="reference external" href="https://scikit-learn.org/dev/modules/generated/sklearn.manifold.t_sne.trustworthiness.html">https://scikit-learn.org/dev/modules/generated/sklearn.manifold.t_sne.trustworthiness.html</a></p>
<p>the documentation for cuML’s implementation of the trustworthiness metric is: <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.trustworthiness.trustworthiness">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.trustworthiness.trustworthiness</a></p>
<p>The cell below shows an end to end pipeline of UMAP model. Here, the blobs dataset is created by cuml’s equivalent of make_blobs function to be used as the input. The output of UMAP’s fit_transform is evaluated using the trustworthiness function. The values obtained by sklearn and cuml’s trustworthiness are compared below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">cuml.manifold.umap</span> <span class="kn">import</span> <span class="n">UMAP</span> <span class="k">as</span> <span class="n">cuUMAP</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">trustworthiness</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cluster_std</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">X_blobs</span><span class="p">,</span> <span class="n">y_blobs</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                               <span class="n">cluster_std</span> <span class="o">=</span> <span class="n">cluster_std</span><span class="p">,</span>
                               <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                               <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="p">)</span>

<span class="n">trained_UMAP</span> <span class="o">=</span> <span class="n">cuUMAP</span><span class="p">(</span> <span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>
<span class="n">X_embedded</span> <span class="o">=</span> <span class="n">trained_UMAP</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_score</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">trustworthiness</span><span class="p">(</span> <span class="n">X_blobs</span><span class="p">,</span> <span class="n">X_embedded</span> <span class="p">)</span>
<span class="n">sk_score</span> <span class="o">=</span> <span class="n">trustworthiness</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">),</span>  <span class="n">asnumpy</span><span class="p">(</span> <span class="n">X_embedded</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">" cuml's trustworthiness score : "</span><span class="p">,</span> <span class="n">cu_score</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">" sklearn's trustworthiness score : "</span><span class="p">,</span> <span class="n">sk_score</span> <span class="p">)</span>

<span class="c1"># save</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_UMAP</span><span class="p">,</span> <span class="s1">'UMAP.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('UMAP.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/conda/envs/rapids/lib/python3.7/site-packages/ipykernel_launcher.py:19: UserWarning: Parameter should_downcast is deprecated, use convert_dtype instead.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 cuml's trustworthiness score :  0.8572506048387096
 sklearn's trustworthiness score :  0.8572074596774193
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['UMAP.model']
</pre></div></div>
</div>
</div>
<div class="section" id="DBSCAN-and-Adjusted-Random-Index">
<h2>DBSCAN and Adjusted Random Index<a class="headerlink" href="#DBSCAN-and-Adjusted-Random-Index" title="Permalink to this headline">¶</a></h2>
<p>DBSCAN is a popular and a powerful clustering algorithm. For additional information on the DBSCAN model please refer to the documentation on <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.DBSCAN">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.DBSCAN</a></p>
<p>We create the blobs dataset using the cuml equivalent of make_blobs function.</p>
<p>Adjusted random index is a metric which is used to measure the similarity between two data clusters, and it is adjusted to take into consideration the chance grouping of elements. For more information on Adjusted random index please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Rand_index">https://en.wikipedia.org/wiki/Rand_index</a></p>
<p>The cell below shows an end to end model of DBSCAN. The output of DBSCAN’s fit_predict is evaluated using the Adjusted Random Index function. The values obtained by sklearn and cuml’s adjusted random metric are compared below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">cuml</span> <span class="kn">import</span> <span class="n">DBSCAN</span> <span class="k">as</span> <span class="n">cumlDBSCAN</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">adjusted_rand_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cluster_std</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">X_blobs</span><span class="p">,</span> <span class="n">y_blobs</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                               <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                               <span class="n">cluster_std</span> <span class="o">=</span> <span class="n">cluster_std</span><span class="p">,</span>
                               <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="p">)</span>

<span class="n">cuml_dbscan</span> <span class="o">=</span> <span class="n">cumlDBSCAN</span><span class="p">(</span> <span class="n">eps</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                          <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">trained_DBSCAN</span> <span class="o">=</span> <span class="n">cuml_dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_y_pred</span> <span class="o">=</span> <span class="n">trained_DBSCAN</span><span class="o">.</span><span class="n">fit_predict</span> <span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_adjusted_rand_index</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">adjusted_rand_score</span><span class="p">(</span> <span class="n">y_blobs</span><span class="p">,</span> <span class="n">cu_y_pred</span> <span class="p">)</span>
<span class="n">sk_adjusted_rand_index</span> <span class="o">=</span> <span class="n">adjusted_rand_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span><span class="n">y_blobs</span><span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span><span class="n">cu_y_pred</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">" cuml's adjusted random index score : "</span><span class="p">,</span> <span class="n">cu_adjusted_rand_index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">" sklearn's adjusted random index score : "</span><span class="p">,</span> <span class="n">sk_adjusted_rand_index</span><span class="p">)</span>

<span class="c1"># save and optionally reload</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_DBSCAN</span><span class="p">,</span> <span class="s1">'DBSCAN.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('DBSCAN.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 cuml's adjusted random index score :  1.0
 sklearn's adjusted random index score :  1.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['DBSCAN.model']
</pre></div></div>
</div>
<div class="section" id="Regression">
<h3>Regression<a class="headerlink" href="#Regression" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="Linear-regression-and-R^2-score">
<h2>Linear regression and R^2 score<a class="headerlink" href="#Linear-regression-and-R^2-score" title="Permalink to this headline">¶</a></h2>
<p>Linear Regression is a simple machine learning model where the response y is modelled by a linear combination of the predictors in X.</p>
<p>R^2 score is also known as the coefficient of determination. It is used as a metric for scoring regression models. It scores the output of the model based on the proportion of total variation of the model. For more information on the R^2 score metrics please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Coefficient_of_determination">https://en.wikipedia.org/wiki/Coefficient_of_determination</a></p>
<p>For more information on cuML’s implementation of the r2 score metrics please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.regression.r2_score">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.regression.r2_score</a></p>
<p>The cell below uses the Linear Regression model to compare the results between cuML and sklearn trustworthiness metric. For more information on cuML’s implementation of the Linear Regression model please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#linear-regression">https://docs.rapids.ai/api/cuml/stable/api.html#linear-regression</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">from</span> <span class="nn">cuml.preprocessing.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">cuml.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span> <span class="k">as</span> <span class="n">cuLR</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_info</span> <span class="o">=</span> <span class="mi">70</span>

<span class="n">X_reg</span><span class="p">,</span> <span class="n">y_reg</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                                <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                                <span class="n">n_informative</span> <span class="o">=</span> <span class="n">n_info</span><span class="p">,</span>
                                <span class="n">random_state</span> <span class="o">=</span> <span class="mi">123</span> <span class="p">)</span>

<span class="n">X_reg_train</span><span class="p">,</span> <span class="n">X_reg_test</span><span class="p">,</span> <span class="n">y_reg_train</span><span class="p">,</span> <span class="n">y_reg_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span> <span class="n">X_reg</span><span class="p">,</span>
                                                                     <span class="n">y_reg</span><span class="p">,</span>
                                                                     <span class="n">train_size</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                                                                     <span class="n">random_state</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">cuml_reg_model</span> <span class="o">=</span> <span class="n">cuLR</span><span class="p">(</span> <span class="n">fit_intercept</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">'eig'</span> <span class="p">)</span>

<span class="n">trained_LR</span> <span class="o">=</span> <span class="n">cuml_reg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_reg_train</span><span class="p">,</span> <span class="n">y_reg_train</span> <span class="p">)</span>
<span class="n">cu_preds</span> <span class="o">=</span> <span class="n">trained_LR</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_reg_test</span> <span class="p">)</span>

<span class="n">cu_r2</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span> <span class="n">y_reg_test</span><span class="p">,</span> <span class="n">cu_preds</span> <span class="p">)</span>
<span class="n">sk_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">y_reg_test</span> <span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">cu_preds</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"cuml's r2 score : "</span><span class="p">,</span> <span class="n">cu_r2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"sklearn's r2 score : "</span><span class="p">,</span> <span class="n">sk_r2</span><span class="p">)</span>

<span class="c1"># save and reload</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_LR</span><span class="p">,</span> <span class="s1">'LR.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('LR.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cuml's r2 score :  1.0
sklearn's r2 score :  0.9999999999987126
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['LR.model']
</pre></div></div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="cuml_blogs.html" rel="prev" title="cuML blogs and other references"><span class="fa fa-arrow-circle-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<p>
        
        © Copyright 2019, nvidia

    </p>
</div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
</div>
</div>
</section>
</div>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script></body>
</html>