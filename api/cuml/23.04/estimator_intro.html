<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"><meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator">

    <title>Training and Evaluating Machine Learning Models &mdash; cuml 23.04.00 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet">
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet">

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet">
  <link as="font" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2">

    <link href="_static/pygments.css" rel="stylesheet" type="text/css">
    <link href="_static/copybutton.css" rel="stylesheet" type="text/css">
    <link href="_static/references.css" rel="stylesheet" type="text/css">
    <link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet" type="text/css">
    <link href="_static/nbsphinx-code-cells.css" rel="stylesheet" type="text/css">
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" rel="preload">
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" rel="preload">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script defer="defer" src="https://docs.rapids.ai/assets/js/custom.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'estimator_intro';</script>
    <link href="genindex.html" rel="index" title="Index">
    <link href="search.html" rel="search" title="Search">
    <link href="pickling_cuml_models.html" rel="next" title="Pickling Models for Persistence">
    <link href="user_guide.html" rel="prev" title="User Guide">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="en" name="docsearch:language">
  <script id="rapids-selector-pixel-src" src="https://assets.adobedtm.com/5d4962a43b79/814eb6e9b4e1/launch-4bc07f1e0b0b.min.js"></script><link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>
  
  
  <body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode data-offset="180">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox">
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox">
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form action="search.html" class="bd-search d-flex align-items-center" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input aria-label="Search the docs ..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." spellcheck="false" type="search">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">cuml 23.04.00 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="navbar-header-items">
    
    <div class="ms-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="cuml_intro.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="cuml_blogs.html">
                        Blogs and other references
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/rapidsai/cuml" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/rapidsai" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar"><div id="rapids-pydata-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">cuml</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libcuspatial/stable">libcuspatial</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">nightly (23.04)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/cuml/nightly/api.html">nightly (23.04)</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">stable (23.02)</a><a class="rapids-selector__menu-item" href="/api/cuml/legacy/api.html">legacy (22.12)</a></div></div></div>
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="cuml_intro.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="cuml_blogs.html">
                        Blogs and other references
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/rapidsai/cuml" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/rapidsai" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav aria-label="Section Navigation" class="bd-docs-nav bd-links">
  <p aria-level="1" class="bd-links__title" role="heading">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Training and Evaluating Machine Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="pickling_cuml_models.html">Pickling Models for Persistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution_device_interoperability.html">Using cuML on CPU, GPU, or both</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main class="bd-main" id="main-content">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul aria-label="Breadcrumb" class="bd-breadcrumbs" role="navigation">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a aria-label="Home" class="nav-link" href="index.html">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a class="nav-link" href="user_guide.html">User Guide</a></li>
    
    <li aria-current="page" class="breadcrumb-item active">Training and Evaluating Machine Learning Models</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Training-and-Evaluating-Machine-Learning-Models">
<h1>Training and Evaluating Machine Learning Models<a class="headerlink" href="#Training-and-Evaluating-Machine-Learning-Models" title="Permalink to this heading">#</a></h1>
<p>This notebook explores several basic machine learning estimators in cuML, demonstrating how to train them and evaluate them with built-in metrics functions. All of the models are trained on synthetic data, generated by cuML&rsquo;s dataset utilities.</p>
<ol class="arabic simple">
<li><p>Random Forest Classifier</p></li>
<li><p>UMAP</p></li>
<li><p>DBSCAN</p></li>
<li><p>Linear Regression</p></li>
</ol>
<section id="Shared-Library-Imports">
<h2>Shared Library Imports<a class="headerlink" href="#Shared-Library-Imports" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cuml</span>
<span class="kn">from</span> <span class="nn">cupy</span> <span class="kn">import</span> <span class="n">asnumpy</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span><span class="p">,</span> <span class="n">load</span>
</pre></div>
</div>
</div>
<section id="1.-Classification">
<h3>1. Classification<a class="headerlink" href="#1.-Classification" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="Random-Forest-Classification-and-Accuracy-metrics">
<h2>Random Forest Classification and Accuracy metrics<a class="headerlink" href="#Random-Forest-Classification-and-Accuracy-metrics" title="Permalink to this heading">#</a></h2>
<p>The Random Forest algorithm classification model builds several decision trees, and aggregates each of their outputs to make a prediction. For more information on cuML&rsquo;s implementation of the Random Forest Classification model please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.ensemble.RandomForestClassifier">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.ensemble.RandomForestClassifier</a></p>
<p>Accuracy score is the ratio of correct predictions to the total number of predictions. It is used to measure the performance of classification models. For more information on the accuracy score metric please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Accuracy_and_precision">https://en.wikipedia.org/wiki/Accuracy_and_precision</a></p>
<p>For more information on cuML&rsquo;s implementation of accuracy score metrics please refer to: <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.accuracy.accuracy_score">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.accuracy.accuracy_score</a></p>
<p>The cell below shows an end to end pipeline of the Random Forest Classification model. Here the dataset was generated by using sklearn&rsquo;s make_classification dataset. The generated dataset was used to train and run predict on the model. Random forest&rsquo;s performance is evaluated and then compared between the values obtained from the cuML and sklearn accuracy metrics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cuml.datasets.classification</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">cuml.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">cuml.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span> <span class="k">as</span> <span class="n">cuRF</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="c1"># synthetic dataset dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># random forest depth and size</span>
<span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">max_depth</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># generate synthetic data [ binary classification task ]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span> <span class="p">(</span> <span class="n">n_classes</span> <span class="o">=</span> <span class="n">n_classes</span><span class="p">,</span>
                             <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                             <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                             <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">cuRF</span><span class="p">(</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="n">max_depth</span><span class="p">,</span>
              <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span><span class="p">,</span>
              <span class="n">random_state</span>  <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="n">trained_RF</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span> <span class="n">X_test</span> <span class="p">)</span>

<span class="n">cu_score</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span> <span class="p">)</span>
<span class="n">sk_score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">y_test</span> <span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">predictions</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="s2">" cuml accuracy: "</span><span class="p">,</span> <span class="n">cu_score</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s2">" sklearn accuracy : "</span><span class="p">,</span> <span class="n">sk_score</span> <span class="p">)</span>

<span class="c1"># save</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_RF</span><span class="p">,</span> <span class="s1">'RF.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">'RF.model'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>../../thread/thread_load.cuh(36): warning: cuda.h: [jitify] File not found
../../thread/thread_store.cuh(36): warning: cuda.h: [jitify] File not found
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>/opt/conda/envs/rapids/lib/python3.10/site-packages/cuml/internals/api_decorators.py:344: UserWarning: For reproducible results in Random Forest Classifier or for almost reproducible results in Random Forest Regressor, n_streams=1 is recommended. If n_streams is &gt; 1, results may vary due to stream/thread timing differences, even when random_state is set
  return func(**kwargs)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre> cuml accuracy:  0.9639999866485596
 sklearn accuracy :  0.964
</pre></div></div>
</div>
<section id="Clustering">
<h3>Clustering<a class="headerlink" href="#Clustering" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="UMAP-and-Trustworthiness-metrics">
<h2>UMAP and Trustworthiness metrics<a class="headerlink" href="#UMAP-and-Trustworthiness-metrics" title="Permalink to this heading">#</a></h2>
<p>UMAP is a dimensionality reduction algorithm which performs non-linear dimension reduction. It can also be used for visualization. For additional information on the UMAP model please refer to the documentation on <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.UMAP">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.UMAP</a></p>
<p>Trustworthiness is a measure of the extent to which the local structure is retained in the embedding of the model. Therefore, if a sample predicted by the model lay within the unexpected region of the nearest neighbors, then those samples would be penalized. For more information on the trustworthiness metric please refer to: <a class="reference external" href="https://scikit-learn.org/dev/modules/generated/sklearn.manifold.t_sne.trustworthiness.html">https://scikit-learn.org/dev/modules/generated/sklearn.manifold.t_sne.trustworthiness.html</a></p>
<p>the documentation for cuML&rsquo;s implementation of the trustworthiness metric is: <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.trustworthiness.trustworthiness">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.trustworthiness.trustworthiness</a></p>
<p>The cell below shows an end to end pipeline of UMAP model. Here, the blobs dataset is created by cuml&rsquo;s equivalent of make_blobs function to be used as the input. The output of UMAP&rsquo;s fit_transform is evaluated using the trustworthiness function. The values obtained by sklearn and cuml&rsquo;s trustworthiness are compared below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">cuml.manifold.umap</span> <span class="kn">import</span> <span class="n">UMAP</span> <span class="k">as</span> <span class="n">cuUMAP</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">trustworthiness</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cluster_std</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">X_blobs</span><span class="p">,</span> <span class="n">y_blobs</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                               <span class="n">cluster_std</span> <span class="o">=</span> <span class="n">cluster_std</span><span class="p">,</span>
                               <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                               <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="p">)</span>

<span class="n">trained_UMAP</span> <span class="o">=</span> <span class="n">cuUMAP</span><span class="p">(</span> <span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>
<span class="n">X_embedded</span> <span class="o">=</span> <span class="n">trained_UMAP</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_score</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">trustworthiness</span><span class="p">(</span> <span class="n">X_blobs</span><span class="p">,</span> <span class="n">X_embedded</span> <span class="p">)</span>
<span class="n">sk_score</span> <span class="o">=</span> <span class="n">trustworthiness</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">),</span>  <span class="n">asnumpy</span><span class="p">(</span> <span class="n">X_embedded</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">" cuml's trustworthiness score : "</span><span class="p">,</span> <span class="n">cu_score</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">" sklearn's trustworthiness score : "</span><span class="p">,</span> <span class="n">sk_score</span> <span class="p">)</span>

<span class="c1"># save</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_UMAP</span><span class="p">,</span> <span class="s1">'UMAP.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('UMAP.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre> cuml's trustworthiness score :  0.8492631048387097
 sklearn's trustworthiness score :  0.8492635080645161
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>['UMAP.model']
</pre></div></div>
</div>
</section>
<section id="DBSCAN-and-Adjusted-Random-Index">
<h2>DBSCAN and Adjusted Random Index<a class="headerlink" href="#DBSCAN-and-Adjusted-Random-Index" title="Permalink to this heading">#</a></h2>
<p>DBSCAN is a popular and a powerful clustering algorithm. For additional information on the DBSCAN model please refer to the documentation on <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.DBSCAN">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.DBSCAN</a></p>
<p>We create the blobs dataset using the cuml equivalent of make_blobs function.</p>
<p>Adjusted random index is a metric which is used to measure the similarity between two data clusters, and it is adjusted to take into consideration the chance grouping of elements. For more information on Adjusted random index please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Rand_index">https://en.wikipedia.org/wiki/Rand_index</a></p>
<p>The cell below shows an end to end model of DBSCAN. The output of DBSCAN&rsquo;s fit_predict is evaluated using the Adjusted Random Index function. The values obtained by sklearn and cuml&rsquo;s adjusted random metric are compared below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">cuml</span> <span class="kn">import</span> <span class="n">DBSCAN</span> <span class="k">as</span> <span class="n">cumlDBSCAN</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">adjusted_rand_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cluster_std</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">X_blobs</span><span class="p">,</span> <span class="n">y_blobs</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                               <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                               <span class="n">cluster_std</span> <span class="o">=</span> <span class="n">cluster_std</span><span class="p">,</span>
                               <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="p">)</span>

<span class="n">cuml_dbscan</span> <span class="o">=</span> <span class="n">cumlDBSCAN</span><span class="p">(</span> <span class="n">eps</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                          <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">trained_DBSCAN</span> <span class="o">=</span> <span class="n">cuml_dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_y_pred</span> <span class="o">=</span> <span class="n">trained_DBSCAN</span><span class="o">.</span><span class="n">fit_predict</span> <span class="p">(</span> <span class="n">X_blobs</span> <span class="p">)</span>

<span class="n">cu_adjusted_rand_index</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">adjusted_rand_score</span><span class="p">(</span> <span class="n">y_blobs</span><span class="p">,</span> <span class="n">cu_y_pred</span> <span class="p">)</span>
<span class="n">sk_adjusted_rand_index</span> <span class="o">=</span> <span class="n">adjusted_rand_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span><span class="n">y_blobs</span><span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span><span class="n">cu_y_pred</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">" cuml's adjusted random index score : "</span><span class="p">,</span> <span class="n">cu_adjusted_rand_index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">" sklearn's adjusted random index score : "</span><span class="p">,</span> <span class="n">sk_adjusted_rand_index</span><span class="p">)</span>

<span class="c1"># save and optionally reload</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_DBSCAN</span><span class="p">,</span> <span class="s1">'DBSCAN.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('DBSCAN.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre> cuml's adjusted random index score :  1.0
 sklearn's adjusted random index score :  1.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>['DBSCAN.model']
</pre></div></div>
</div>
<section id="Regression">
<h3>Regression<a class="headerlink" href="#Regression" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="Linear-regression-and-R^2-score">
<h2>Linear regression and R^2 score<a class="headerlink" href="#Linear-regression-and-R^2-score" title="Permalink to this heading">#</a></h2>
<p>Linear Regression is a simple machine learning model where the response y is modelled by a linear combination of the predictors in X.</p>
<p>R^2 score is also known as the coefficient of determination. It is used as a metric for scoring regression models. It scores the output of the model based on the proportion of total variation of the model. For more information on the R^2 score metrics please refer to: <a class="reference external" href="https://en.wikipedia.org/wiki/Coefficient_of_determination">https://en.wikipedia.org/wiki/Coefficient_of_determination</a></p>
<p>For more information on cuML&rsquo;s implementation of the r2 score metrics please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.regression.r2_score">https://docs.rapids.ai/api/cuml/stable/api.html#cuml.metrics.regression.r2_score</a></p>
<p>The cell below uses the Linear Regression model to compare the results between cuML and sklearn trustworthiness metric. For more information on cuML&rsquo;s implementation of the Linear Regression model please refer to : <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#linear-regression">https://docs.rapids.ai/api/cuml/stable/api.html#linear-regression</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cuml.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">from</span> <span class="nn">cuml.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">cuml.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span> <span class="k">as</span> <span class="n">cuLR</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_info</span> <span class="o">=</span> <span class="mi">70</span>

<span class="n">X_reg</span><span class="p">,</span> <span class="n">y_reg</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span><span class="p">,</span>
                                <span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span><span class="p">,</span>
                                <span class="n">n_informative</span> <span class="o">=</span> <span class="n">n_info</span><span class="p">,</span>
                                <span class="n">random_state</span> <span class="o">=</span> <span class="mi">123</span> <span class="p">)</span>

<span class="n">X_reg_train</span><span class="p">,</span> <span class="n">X_reg_test</span><span class="p">,</span> <span class="n">y_reg_train</span><span class="p">,</span> <span class="n">y_reg_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span> <span class="n">X_reg</span><span class="p">,</span>
                                                                     <span class="n">y_reg</span><span class="p">,</span>
                                                                     <span class="n">train_size</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                                                                     <span class="n">random_state</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">cuml_reg_model</span> <span class="o">=</span> <span class="n">cuLR</span><span class="p">(</span> <span class="n">fit_intercept</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">'eig'</span> <span class="p">)</span>

<span class="n">trained_LR</span> <span class="o">=</span> <span class="n">cuml_reg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_reg_train</span><span class="p">,</span> <span class="n">y_reg_train</span> <span class="p">)</span>
<span class="n">cu_preds</span> <span class="o">=</span> <span class="n">trained_LR</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_reg_test</span> <span class="p">)</span>

<span class="n">cu_r2</span> <span class="o">=</span> <span class="n">cuml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span> <span class="n">y_reg_test</span><span class="p">,</span> <span class="n">cu_preds</span> <span class="p">)</span>
<span class="n">sk_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">y_reg_test</span> <span class="p">),</span> <span class="n">asnumpy</span><span class="p">(</span> <span class="n">cu_preds</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"cuml's r2 score : "</span><span class="p">,</span> <span class="n">cu_r2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"sklearn's r2 score : "</span><span class="p">,</span> <span class="n">sk_r2</span><span class="p">)</span>

<span class="c1"># save and reload</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">trained_LR</span><span class="p">,</span> <span class="s1">'LR.model'</span><span class="p">)</span>

<span class="c1"># to reload the model uncomment the line below</span>
<span class="c1"># loaded_model = load('LR.model')</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>cuml's r2 score :  1.0
sklearn's r2 score :  0.9999999999989133
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>['LR.model']
</pre></div></div>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev" href="user_guide.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">User Guide</p>
      </div>
    </a>
    <a class="right-next" href="pickling_cuml_models.html" title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Pickling Models for Persistence</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Shared-Library-Imports">Shared Library Imports</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Classification">1. Classification</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Random-Forest-Classification-and-Accuracy-metrics">Random Forest Classification and Accuracy metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Clustering">Clustering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#UMAP-and-Trustworthiness-metrics">UMAP and Trustworthiness metrics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#DBSCAN-and-Adjusted-Random-Index">DBSCAN and Adjusted Random Index</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Regression">Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Linear-regression-and-R^2-score">Linear regression and R^2 score</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/estimator_intro.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      &copy; Copyright 2020-2023, NVIDIA Corporation.
      <br>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  
<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script><script id="rapids-selector-pixel-invocation" type="text/javascript">_satellite.pageBottom();</script></body></html>