

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Running RAPIDS hyperparameter experiments at scale on Amazon SageMaker &#8212; RAPIDS Deployment Documentation  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="https://docs.rapids.ai/assets/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script defer="defer" src="https://docs.rapids.ai/assets/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/nav.js"></script>
    <script defer="defer" src="../../_static/js/notebook-gallery.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/rapids-sagemaker-higgs/notebook';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deep Dive into running Hyper Parameter Optimization on AWS SageMaker" href="../rapids-sagemaker-hpo/notebook.html" />
    <link rel="prev" title="Getting Started with Optuna and RAPIDS for HPO" href="../rapids-optuna-hpo/notebook.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://docs.rapids.ai/">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/RAPIDS-logo-purple.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/RAPIDS-logo-purple.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class=" navbar-header-items">
    
    <div class="ms-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../local.html">
                        Local
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../cloud/index.html">
                        Cloud
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hpc.html">
                        HPC
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../platforms/index.html">
                        Platforms
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tools/index.html">
                        Tools
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Workflow Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../guides/index.html">
                        Guides
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/rapidsai/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../local.html">
                        Local
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../cloud/index.html">
                        Cloud
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hpc.html">
                        HPC
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../platforms/index.html">
                        Platforms
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tools/index.html">
                        Tools
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Workflow Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../guides/index.html">
                        Guides
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/rapidsai/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../xgboost-gpu-hpo-job-parallel-k8s/notebook.html">Scaling up hyperparameter optimization with Kubernetes and XGBoost GPU algorithm</a></li>





<li class="toctree-l1"><a class="reference internal" href="../rapids-optuna-hpo/notebook.html">Getting Started with Optuna and RAPIDS for HPO</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">Running RAPIDS hyperparameter experiments at scale on Amazon SageMaker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rapids-sagemaker-hpo/notebook.html">Deep Dive into running Hyper Parameter Optimization on AWS SageMaker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rapids-ec2-mnmg/notebook.html">Multi-node multi-GPU example on AWS using dask-cloudprovider</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rapids-autoscaling-multi-tenant-kubernetes/notebook.html">Autoscaling multi-tenant Kubernetes Deep-Dive</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Workflow Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Running RAPIDS hyperparameter experiments at scale on Amazon SageMaker</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="running-rapids-hyperparameter-experiments-at-scale-on-amazon-sagemaker">
<h1>Running RAPIDS hyperparameter experiments at scale on Amazon SageMaker<a class="headerlink" href="#running-rapids-hyperparameter-experiments-at-scale-on-amazon-sagemaker" title="Permalink to this heading">#</a></h1>
<section id="import-packages-and-create-amazon-sagemaker-and-boto3-sessions">
<h2>Import packages and create Amazon SageMaker and Boto3 sessions<a class="headerlink" href="#import-packages-and-create-amazon-sagemaker-and-boto3-sessions" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sagemaker</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">boto3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">execution_role</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">region_name</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;sts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Account&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">account</span><span class="p">,</span> <span class="n">region</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;561241433344&#39;, &#39;us-west-2&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="upload-the-higgs-boson-dataset-to-s3-bucket">
<h2>Upload the higgs-boson dataset to s3 bucket<a class="headerlink" href="#upload-the-higgs-boson-dataset-to-s3-bucket" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>dataset
<span class="o">!</span>wget<span class="w"> </span>-P<span class="w"> </span>dataset<span class="w"> </span>https://archive.ics.uci.edu/ml/machine-learning-databases/00280/HIGGS.csv.gz
<span class="o">!</span>gunzip<span class="w"> </span>dataset/HIGGS.csv.gz
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3_data_dir</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">upload_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="s2">&quot;dataset/higgs-dataset&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3_data_dir</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;s3://sagemaker-us-west-2-561241433344/dataset/higgs-dataset&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-latest-rapids-container-from-dockerhub">
<h2>Download latest RAPIDS container from DockerHub<a class="headerlink" href="#download-latest-rapids-container-from-dockerhub" title="Permalink to this heading">#</a></h2>
<p>To build our RAPIDS Docker container compatible with Amazon SageMaker, you’ll start with base RAPIDS container, which the nice people at NVIDIA have already built and pushed to <a class="reference external" href="https://hub.docker.com/r/rapidsai/rapidsai-core">DockerHub</a>.</p>
<p>You will need to extend this container by creating a Dockerfile, copying the training script and installing <a class="reference external" href="https://github.com/aws/sagemaker-training-toolkit">SageMaker Training toolkit</a> to makes RAPIDS compatible with SageMaker</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<pre class="literal-block">estimator_info = {
    &quot;rapids_container&quot;: &quot;rapidsai/rapidsai-core-nightly:23.04-cuda11.8-runtime-ubuntu22.04-py3.10&quot;,
    &quot;ecr_image&quot;: &quot;sagemaker-rapids-higgs:latest&quot;,
    &quot;ecr_repository&quot;: &quot;sagemaker-rapids-higgs&quot;,
}</pre>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time
!docker pull {estimator_info[&#39;rapids_container&#39;]}
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22.12-cuda11.5-runtime-ubuntu18.04-py3.9: Pulling from rapidsai/rapidsai-core

e5416296: Pulling fs layer 
2d3ed59c: Pulling fs layer 
1b38369f: Pulling fs layer 
4c8e4d7e: Pulling fs layer 
a06239d6: Pulling fs layer 
cb87b249: Pulling fs layer 
61c55367: Pulling fs layer 
fb9847e6: Pulling fs layer 
0cc4d9ef: Pulling fs layer 
161bebe2: Pull complete 932GB/3.932GBBExtracting  14.94MB/23.41MBDownloading  355.3MB/3.932GBDownloading  706.6MB/1.552GBExtracting  447.9MB/1.552GBExtracting  1.169GB/1.552GBExtracting  3.003GB/3.932GBDigest: sha256:959a2e80642e881ef99705473d95165cda8383543cff4ae5ca554da782021e47
Status: Downloaded newer image for rapidsai/rapidsai-core:22.12-cuda11.5-runtime-ubuntu18.04-py3.9
docker.io/rapidsai/rapidsai-core:22.12-cuda11.5-runtime-ubuntu18.04-py3.9
CPU times: user 5.79 s, sys: 1 s, total: 6.79 s
Wall time: 4min 10s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>Dockerfile
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ARG RAPIDS_IMAGE

FROM $RAPIDS_IMAGE as rapids

# add sagemaker-training-toolkit [ requires build tools ], flask [ serving ], and dask-ml
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends build-essential \
    &amp;&amp; source activate rapids \
    &amp;&amp; pip3 install sagemaker-training cupy-cuda11x flask \
    &amp;&amp; pip3 install --upgrade protobuf

# Copies the training code inside the container
COPY rapids-higgs.py /opt/ml/code/rapids-higgs.py

# Defines rapids-higgs.py as script entry point
ENV SAGEMAKER_PROGRAM rapids-higgs.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<pre class="literal-block">!docker build -t sagemaker-rapids-higgs --build-arg RAPIDS_IMAGE rapidsai/rapidsai-core-nightly:23.04-cuda11.8-runtime-ubuntu22.04-py3.10 .</pre>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sending build context to Docker daemon  10.75kB
Step 1/4 : FROM rapidsai/rapidsai-core:22.12-cuda11.5-runtime-ubuntu18.04-py3.9
 ---&gt; 9de590bd08c5
Step 2/4 : RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends build-essential     &amp;&amp; source activate rapids     &amp;&amp; pip3 install sagemaker-training cupy-cuda11x flask     &amp;&amp; pip3 install --upgrade protobuf
 ---&gt; Running in bc5688af0059
Get:1 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease [1581 B]
Get:2 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Packages [1124 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]
Get:4 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:5 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3161 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1344 kB]
Get:9 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]
Get:10 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1389 kB]
Get:11 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]
Get:12 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [23.8 kB]
Get:13 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1578 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2353 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [30.8 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1430 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3581 kB]
Get:19 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [64.0 kB]
Get:20 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [20.5 kB]
Fetched 28.1 MB in 4s (7151 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  binutils binutils-common binutils-x86-64-linux-gnu cpp cpp-7 dpkg-dev g++
  g++-7 gcc gcc-7 gcc-7-base libasan4 libatomic1 libbinutils libcc1-0
  libcilkrts5 libdpkg-perl libgcc-7-dev libgomp1 libisl19 libitm1 liblsan0
  libmpc3 libmpfr6 libmpx2 libquadmath0 libstdc++-7-dev libtsan0 libubsan0
  make xz-utils
Suggested packages:
  binutils-doc cpp-doc gcc-7-locales debian-keyring g++-multilib
  g++-7-multilib gcc-7-doc libstdc++6-7-dbg gcc-multilib manpages-dev libtool
  flex bison gdb gcc-doc gcc-7-multilib libgcc1-dbg libgomp1-dbg libitm1-dbg
  libatomic1-dbg libasan4-dbg liblsan0-dbg libtsan0-dbg libubsan0-dbg
  libcilkrts5-dbg libmpx2-dbg libquadmath0-dbg bzr libstdc++-7-doc make-doc
Recommended packages:
  fakeroot libalgorithm-merge-perl libfile-fcntllock-perl
  liblocale-gettext-perl
The following NEW packages will be installed:
  binutils binutils-common binutils-x86-64-linux-gnu build-essential cpp cpp-7
  dpkg-dev g++ g++-7 gcc gcc-7 gcc-7-base libasan4 libatomic1 libbinutils
  libcc1-0 libcilkrts5 libdpkg-perl libgcc-7-dev libgomp1 libisl19 libitm1
  liblsan0 libmpc3 libmpfr6 libmpx2 libquadmath0 libstdc++-7-dev libtsan0
  libubsan0 make xz-utils
0 upgraded, 32 newly installed, 0 to remove and 26 not upgraded.
Need to get 37.2 MB of archives.
After this operation, 137 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 xz-utils amd64 5.2.2-1.3ubuntu0.1 [83.8 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 binutils-common amd64 2.30-21ubuntu1~18.04.8 [197 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libbinutils amd64 2.30-21ubuntu1~18.04.8 [488 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 binutils-x86-64-linux-gnu amd64 2.30-21ubuntu1~18.04.8 [1839 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 binutils amd64 2.30-21ubuntu1~18.04.8 [3388 B]
Get:6 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gcc-7-base amd64 7.5.0-3ubuntu1~18.04 [18.3 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic/main amd64 libisl19 amd64 0.19-1 [551 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic/main amd64 libmpfr6 amd64 4.0.1-1 [243 kB]
Get:9 http://archive.ubuntu.com/ubuntu bionic/main amd64 libmpc3 amd64 1.1.0-1 [40.8 kB]
Get:10 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 cpp-7 amd64 7.5.0-3ubuntu1~18.04 [8591 kB]
Get:11 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 cpp amd64 4:7.4.0-1ubuntu2.3 [27.7 kB]
Get:12 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libcc1-0 amd64 8.4.0-1ubuntu1~18.04 [39.4 kB]
Get:13 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libgomp1 amd64 8.4.0-1ubuntu1~18.04 [76.5 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libitm1 amd64 8.4.0-1ubuntu1~18.04 [27.9 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libatomic1 amd64 8.4.0-1ubuntu1~18.04 [9192 B]
Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libasan4 amd64 7.5.0-3ubuntu1~18.04 [358 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 liblsan0 amd64 8.4.0-1ubuntu1~18.04 [133 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libtsan0 amd64 8.4.0-1ubuntu1~18.04 [288 kB]
Get:19 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libubsan0 amd64 7.5.0-3ubuntu1~18.04 [126 kB]
Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libcilkrts5 amd64 7.5.0-3ubuntu1~18.04 [42.5 kB]
Get:21 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libmpx2 amd64 8.4.0-1ubuntu1~18.04 [11.6 kB]
Get:22 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libquadmath0 amd64 8.4.0-1ubuntu1~18.04 [134 kB]
Get:23 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libgcc-7-dev amd64 7.5.0-3ubuntu1~18.04 [2378 kB]
Get:24 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gcc-7 amd64 7.5.0-3ubuntu1~18.04 [9381 kB]
Get:25 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gcc amd64 4:7.4.0-1ubuntu2.3 [5184 B]
Get:26 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libstdc++-7-dev amd64 7.5.0-3ubuntu1~18.04 [1471 kB]
Get:27 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 g++-7 amd64 7.5.0-3ubuntu1~18.04 [9697 kB]
Get:28 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 g++ amd64 4:7.4.0-1ubuntu2.3 [1568 B]
Get:29 http://archive.ubuntu.com/ubuntu bionic/main amd64 make amd64 4.1-9.1ubuntu1 [154 kB]
Get:30 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libdpkg-perl all 1.19.0.5ubuntu2.4 [212 kB]
Get:31 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 dpkg-dev all 1.19.0.5ubuntu2.4 [607 kB]
Get:32 http://archive.ubuntu.com/ubuntu bionic/main amd64 build-essential amd64 12.4ubuntu1 [4758 B]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 37.2 MB in 3s (11.7 MB/s)
Selecting previously unselected package xz-utils.
(Reading database ... 13756 files and directories currently installed.)
Preparing to unpack .../00-xz-utils_5.2.2-1.3ubuntu0.1_amd64.deb ...
Unpacking xz-utils (5.2.2-1.3ubuntu0.1) ...
Selecting previously unselected package binutils-common:amd64.
Preparing to unpack .../01-binutils-common_2.30-21ubuntu1~18.04.8_amd64.deb ...
Unpacking binutils-common:amd64 (2.30-21ubuntu1~18.04.8) ...
Selecting previously unselected package libbinutils:amd64.
Preparing to unpack .../02-libbinutils_2.30-21ubuntu1~18.04.8_amd64.deb ...
Unpacking libbinutils:amd64 (2.30-21ubuntu1~18.04.8) ...
Selecting previously unselected package binutils-x86-64-linux-gnu.
Preparing to unpack .../03-binutils-x86-64-linux-gnu_2.30-21ubuntu1~18.04.8_amd64.deb ...
Unpacking binutils-x86-64-linux-gnu (2.30-21ubuntu1~18.04.8) ...
Selecting previously unselected package binutils.
Preparing to unpack .../04-binutils_2.30-21ubuntu1~18.04.8_amd64.deb ...
Unpacking binutils (2.30-21ubuntu1~18.04.8) ...
Selecting previously unselected package gcc-7-base:amd64.
Preparing to unpack .../05-gcc-7-base_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking gcc-7-base:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package libisl19:amd64.
Preparing to unpack .../06-libisl19_0.19-1_amd64.deb ...
Unpacking libisl19:amd64 (0.19-1) ...
Selecting previously unselected package libmpfr6:amd64.
Preparing to unpack .../07-libmpfr6_4.0.1-1_amd64.deb ...
Unpacking libmpfr6:amd64 (4.0.1-1) ...
Selecting previously unselected package libmpc3:amd64.
Preparing to unpack .../08-libmpc3_1.1.0-1_amd64.deb ...
Unpacking libmpc3:amd64 (1.1.0-1) ...
Selecting previously unselected package cpp-7.
Preparing to unpack .../09-cpp-7_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking cpp-7 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package cpp.
Preparing to unpack .../10-cpp_4%3a7.4.0-1ubuntu2.3_amd64.deb ...
Unpacking cpp (4:7.4.0-1ubuntu2.3) ...
Selecting previously unselected package libcc1-0:amd64.
Preparing to unpack .../11-libcc1-0_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libcc1-0:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libgomp1:amd64.
Preparing to unpack .../12-libgomp1_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libgomp1:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libitm1:amd64.
Preparing to unpack .../13-libitm1_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libitm1:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libatomic1:amd64.
Preparing to unpack .../14-libatomic1_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libatomic1:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libasan4:amd64.
Preparing to unpack .../15-libasan4_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking libasan4:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package liblsan0:amd64.
Preparing to unpack .../16-liblsan0_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking liblsan0:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libtsan0:amd64.
Preparing to unpack .../17-libtsan0_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libtsan0:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libubsan0:amd64.
Preparing to unpack .../18-libubsan0_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking libubsan0:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package libcilkrts5:amd64.
Preparing to unpack .../19-libcilkrts5_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking libcilkrts5:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package libmpx2:amd64.
Preparing to unpack .../20-libmpx2_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libmpx2:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libquadmath0:amd64.
Preparing to unpack .../21-libquadmath0_8.4.0-1ubuntu1~18.04_amd64.deb ...
Unpacking libquadmath0:amd64 (8.4.0-1ubuntu1~18.04) ...
Selecting previously unselected package libgcc-7-dev:amd64.
Preparing to unpack .../22-libgcc-7-dev_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking libgcc-7-dev:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package gcc-7.
Preparing to unpack .../23-gcc-7_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking gcc-7 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package gcc.
Preparing to unpack .../24-gcc_4%3a7.4.0-1ubuntu2.3_amd64.deb ...
Unpacking gcc (4:7.4.0-1ubuntu2.3) ...
Selecting previously unselected package libstdc++-7-dev:amd64.
Preparing to unpack .../25-libstdc++-7-dev_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking libstdc++-7-dev:amd64 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package g++-7.
Preparing to unpack .../26-g++-7_7.5.0-3ubuntu1~18.04_amd64.deb ...
Unpacking g++-7 (7.5.0-3ubuntu1~18.04) ...
Selecting previously unselected package g++.
Preparing to unpack .../27-g++_4%3a7.4.0-1ubuntu2.3_amd64.deb ...
Unpacking g++ (4:7.4.0-1ubuntu2.3) ...
Selecting previously unselected package make.
Preparing to unpack .../28-make_4.1-9.1ubuntu1_amd64.deb ...
Unpacking make (4.1-9.1ubuntu1) ...
Selecting previously unselected package libdpkg-perl.
Preparing to unpack .../29-libdpkg-perl_1.19.0.5ubuntu2.4_all.deb ...
Unpacking libdpkg-perl (1.19.0.5ubuntu2.4) ...
Selecting previously unselected package dpkg-dev.
Preparing to unpack .../30-dpkg-dev_1.19.0.5ubuntu2.4_all.deb ...
Unpacking dpkg-dev (1.19.0.5ubuntu2.4) ...
Selecting previously unselected package build-essential.
Preparing to unpack .../31-build-essential_12.4ubuntu1_amd64.deb ...
Unpacking build-essential (12.4ubuntu1) ...
Setting up libquadmath0:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up libgomp1:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up libatomic1:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up libcc1-0:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up make (4.1-9.1ubuntu1) ...
Setting up libtsan0:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up libmpfr6:amd64 (4.0.1-1) ...
Setting up libdpkg-perl (1.19.0.5ubuntu2.4) ...
Setting up liblsan0:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up gcc-7-base:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up binutils-common:amd64 (2.30-21ubuntu1~18.04.8) ...
Setting up libmpx2:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up xz-utils (5.2.2-1.3ubuntu0.1) ...
update-alternatives: using /usr/bin/xz to provide /usr/bin/lzma (lzma) in auto mode
update-alternatives: warning: skip creation of /usr/share/man/man1/lzma.1.gz because associated file /usr/share/man/man1/xz.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/unlzma.1.gz because associated file /usr/share/man/man1/unxz.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzcat.1.gz because associated file /usr/share/man/man1/xzcat.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzmore.1.gz because associated file /usr/share/man/man1/xzmore.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzless.1.gz because associated file /usr/share/man/man1/xzless.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzdiff.1.gz because associated file /usr/share/man/man1/xzdiff.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzcmp.1.gz because associated file /usr/share/man/man1/xzcmp.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzgrep.1.gz because associated file /usr/share/man/man1/xzgrep.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzegrep.1.gz because associated file /usr/share/man/man1/xzegrep.1.gz (of link group lzma) doesn&#39;t exist
update-alternatives: warning: skip creation of /usr/share/man/man1/lzfgrep.1.gz because associated file /usr/share/man/man1/xzfgrep.1.gz (of link group lzma) doesn&#39;t exist
Setting up libmpc3:amd64 (1.1.0-1) ...
Setting up libitm1:amd64 (8.4.0-1ubuntu1~18.04) ...
Setting up libisl19:amd64 (0.19-1) ...
Setting up libasan4:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up libbinutils:amd64 (2.30-21ubuntu1~18.04.8) ...
Setting up libcilkrts5:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up libubsan0:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up libgcc-7-dev:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up cpp-7 (7.5.0-3ubuntu1~18.04) ...
Setting up libstdc++-7-dev:amd64 (7.5.0-3ubuntu1~18.04) ...
Setting up binutils-x86-64-linux-gnu (2.30-21ubuntu1~18.04.8) ...
Setting up cpp (4:7.4.0-1ubuntu2.3) ...
Setting up binutils (2.30-21ubuntu1~18.04.8) ...
Setting up gcc-7 (7.5.0-3ubuntu1~18.04) ...
Setting up g++-7 (7.5.0-3ubuntu1~18.04) ...
Setting up gcc (4:7.4.0-1ubuntu2.3) ...
Setting up dpkg-dev (1.19.0.5ubuntu2.4) ...
Setting up g++ (4:7.4.0-1ubuntu2.3) ...
update-alternatives: using /usr/bin/g++ to provide /usr/bin/c++ (c++) in auto mode
update-alternatives: warning: skip creation of /usr/share/man/man1/c++.1.gz because associated file /usr/share/man/man1/g++.1.gz (of link group c++) doesn&#39;t exist
Setting up build-essential (12.4ubuntu1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.6) ...
Collecting sagemaker-training
  Downloading sagemaker_training-4.4.5.tar.gz (58 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 58.6/58.6 kB 4.5 MB/s eta 0:00:00
  Preparing metadata (setup.py): started
  Preparing metadata (setup.py): finished with status &#39;done&#39;
Collecting cupy-cuda11x
  Downloading cupy_cuda115-10.6.0-cp39-cp39-manylinux1_x86_64.whl (81.5 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 81.5/81.5 MB 18.4 MB/s eta 0:00:00
Collecting flask
  Downloading Flask-2.2.2-py3-none-any.whl (101 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 101.5/101.5 kB 31.1 MB/s eta 0:00:00
Requirement already satisfied: numpy in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (1.23.5)
Collecting boto3
  Downloading boto3-1.26.65-py3-none-any.whl (132 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 132.7/132.7 kB 29.0 MB/s eta 0:00:00
Requirement already satisfied: six in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (1.16.0)
Requirement already satisfied: pip in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (22.3.1)
Collecting retrying&gt;=1.3.3
  Downloading retrying-1.3.4-py3-none-any.whl (11 kB)
Collecting gevent
  Downloading gevent-22.10.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (6.4 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.4/6.4 MB 106.5 MB/s eta 0:00:00
Collecting inotify_simple==1.2.1
  Downloading inotify_simple-1.2.1.tar.gz (7.9 kB)
  Preparing metadata (setup.py): started
  Preparing metadata (setup.py): finished with status &#39;done&#39;
Collecting werkzeug&gt;=0.15.5
  Downloading Werkzeug-2.2.2-py3-none-any.whl (232 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 232.7/232.7 kB 48.1 MB/s eta 0:00:00
Collecting paramiko&gt;=2.4.2
  Downloading paramiko-3.0.0-py3-none-any.whl (210 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 210.8/210.8 kB 43.6 MB/s eta 0:00:00
Requirement already satisfied: psutil&gt;=5.6.7 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (5.9.4)
Requirement already satisfied: protobuf&lt;=3.20.2,&gt;=3.9.2 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (3.20.2)
Requirement already satisfied: scipy&gt;=1.2.2 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from sagemaker-training) (1.6.0)
Requirement already satisfied: fastrlock&gt;=0.5 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from cupy-cuda11x) (0.8)
Requirement already satisfied: Jinja2&gt;=3.0 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from flask) (3.1.2)
Requirement already satisfied: click&gt;=8.0 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from flask) (8.1.3)
Collecting itsdangerous&gt;=2.0
  Downloading itsdangerous-2.1.2-py3-none-any.whl (15 kB)
Requirement already satisfied: importlib-metadata&gt;=3.6.0 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from flask) (5.1.0)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from importlib-metadata&gt;=3.6.0-&gt;flask) (3.11.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from Jinja2&gt;=3.0-&gt;flask) (2.1.1)
Collecting pynacl&gt;=1.5
  Downloading PyNaCl-1.5.0-cp36-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux_2_24_x86_64.whl (856 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 856.7/856.7 kB 8.2 MB/s eta 0:00:00
Collecting bcrypt&gt;=3.2
  Downloading bcrypt-4.0.1-cp36-abi3-manylinux_2_24_x86_64.whl (593 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 593.2/593.2 kB 83.3 MB/s eta 0:00:00
Requirement already satisfied: cryptography&gt;=3.3 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from paramiko&gt;=2.4.2-&gt;sagemaker-training) (38.0.4)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from boto3-&gt;sagemaker-training) (1.0.1)
Collecting botocore&lt;1.30.0,&gt;=1.29.65
  Downloading botocore-1.29.65-py3-none-any.whl (10.4 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 10.4/10.4 MB 107.3 MB/s eta 0:00:00
Collecting s3transfer&lt;0.7.0,&gt;=0.6.0
  Downloading s3transfer-0.6.0-py3-none-any.whl (79 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 79.6/79.6 kB 22.9 MB/s eta 0:00:00
Requirement already satisfied: setuptools in /opt/conda/envs/rapids/lib/python3.9/site-packages (from gevent-&gt;sagemaker-training) (65.5.1)
Collecting zope.interface
  Downloading zope.interface-5.5.2-cp39-cp39-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (257 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 257.9/257.9 kB 49.1 MB/s eta 0:00:00
Collecting zope.event
  Downloading zope.event-4.6-py2.py3-none-any.whl (6.8 kB)
Collecting greenlet&gt;=2.0.0
  Downloading greenlet-2.0.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (610 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 610.9/610.9 kB 81.4 MB/s eta 0:00:00
Requirement already satisfied: python-dateutil&lt;3.0.0,&gt;=2.1 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from botocore&lt;1.30.0,&gt;=1.29.65-&gt;boto3-&gt;sagemaker-training) (2.8.2)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.25.4 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from botocore&lt;1.30.0,&gt;=1.29.65-&gt;boto3-&gt;sagemaker-training) (1.26.13)
Requirement already satisfied: cffi&gt;=1.12 in /opt/conda/envs/rapids/lib/python3.9/site-packages (from cryptography&gt;=3.3-&gt;paramiko&gt;=2.4.2-&gt;sagemaker-training) (1.15.1)
Requirement already satisfied: pycparser in /opt/conda/envs/rapids/lib/python3.9/site-packages (from cffi&gt;=1.12-&gt;cryptography&gt;=3.3-&gt;paramiko&gt;=2.4.2-&gt;sagemaker-training) (2.21)
Building wheels for collected packages: sagemaker-training, inotify_simple
  Building wheel for sagemaker-training (setup.py): started
  Building wheel for sagemaker-training (setup.py): finished with status &#39;done&#39;
  Created wheel for sagemaker-training: filename=sagemaker_training-4.4.5-cp39-cp39-linux_x86_64.whl size=77869 sha256=525d9529335cbe745c94db978088ec5e16fc6df7ee9b5d8253e3a2b6eb20aedf
  Stored in directory: /root/.cache/pip/wheels/27/ce/8c/61fd993cc09c869afdfe6fa5dda848e6e66ba38f10357fa9bd
  Building wheel for inotify_simple (setup.py): started
  Building wheel for inotify_simple (setup.py): finished with status &#39;done&#39;
  Created wheel for inotify_simple: filename=inotify_simple-1.2.1-py3-none-any.whl size=8201 sha256=bab7fdd63ad2075fb3bdad0ed1e910ab4e048c819ccf71eaf538e515659ae701
  Stored in directory: /root/.cache/pip/wheels/3f/c2/6a/6f6c65836d2fad9ae7008373d82e38b519187113fac6b720c8
Successfully built sagemaker-training inotify_simple
Installing collected packages: inotify_simple, zope.interface, zope.event, werkzeug, retrying, itsdangerous, greenlet, cupy-cuda11x, bcrypt, pynacl, gevent, flask, botocore, s3transfer, paramiko, boto3, sagemaker-training
  Attempting uninstall: botocore
    Found existing installation: botocore 1.27.59
    Uninstalling botocore-1.27.59:
      Successfully uninstalled botocore-1.27.59
ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
aiobotocore 2.4.0 requires botocore&lt;1.27.60,&gt;=1.27.59, but you have botocore 1.29.65 which is incompatible.
Successfully installed bcrypt-4.0.1 boto3-1.26.65 botocore-1.29.65 cupy-cuda11x-10.6.0 flask-2.2.2 gevent-22.10.2 greenlet-2.0.2 inotify_simple-1.2.1 itsdangerous-2.1.2 paramiko-3.0.0 pynacl-1.5.0 retrying-1.3.4 s3transfer-0.6.0 sagemaker-training-4.4.5 werkzeug-2.2.2 zope.event-4.6 zope.interface-5.5.2
WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
Requirement already satisfied: protobuf in /opt/conda/envs/rapids/lib/python3.9/site-packages (3.20.2)
Collecting protobuf
  Downloading protobuf-4.21.12-cp37-abi3-manylinux2014_x86_64.whl (409 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 409.8/409.8 kB 14.2 MB/s eta 0:00:00
Installing collected packages: protobuf
  Attempting uninstall: protobuf
    Found existing installation: protobuf 3.20.2
    Uninstalling protobuf-3.20.2:
      Successfully uninstalled protobuf-3.20.2
ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
cudf 22.12.1 requires cupy-cuda11x, which is not installed.
sagemaker-training 4.4.5 requires protobuf&lt;=3.20.2,&gt;=3.9.2, but you have protobuf 4.21.12 which is incompatible.
cudf 22.12.1 requires protobuf&lt;3.21.0a0,&gt;=3.20.1, but you have protobuf 4.21.12 which is incompatible.
Successfully installed protobuf-4.21.12
WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
Removing intermediate container bc5688af0059
 ---&gt; b58e1fb082e7
Step 3/4 : COPY rapids-higgs.py /opt/ml/code/rapids-higgs.py
 ---&gt; 7020b9ee91b2
Step 4/4 : ENV SAGEMAKER_PROGRAM rapids-higgs.py
 ---&gt; Running in b01db1cfa675
Removing intermediate container b01db1cfa675
 ---&gt; 2af65998a4b2
Successfully built 2af65998a4b2
Successfully tagged sagemaker-rapids-higgs:latest
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>images
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>REPOSITORY               TAG                                        IMAGE ID       CREATED                  SIZE
sagemaker-rapids-higgs   latest                                     2af65998a4b2   Less than a second ago   13.7GB
rapidsai/rapidsai-core   22.12-cuda11.5-runtime-ubuntu18.04-py3.9   9de590bd08c5   7 weeks ago              13.1GB
</pre></div>
</div>
</div>
</div>
</section>
<section id="publish-to-elastic-container-registry">
<h2>Publish to Elastic Container Registry<a class="headerlink" href="#publish-to-elastic-container-registry" title="Permalink to this heading">#</a></h2>
<p>When running a large-scale training job either for distributed training or for independent experiments, you will need to make sure that datasets and training scripts are all replicated at each instance in your cluster. Thankfully, the more painful of the two — moving datasets — is taken care of by Amazon SageMaker. As for the training code, you already have a Docker container ready, you simply need to push it to a container registry, and Amazon SageMaker will then pull it into each of the training compute instances in the cluster.</p>
<p>Note: SageMaker does not support using training images from private docker registry (ie. DockerHub), so we need to push
the SageMaker-compatible RAPIDS container to the Amazon Elastic Container Registry (Amazon ECR) to store your Amazon SageMaker compatible RAPIDS container and make it available for Amazon SageMaker.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ECR_container_fullname</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">.dkr.ecr.</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">.amazonaws.com/</span><span class="si">{</span><span class="n">estimator_info</span><span class="p">[</span><span class="s1">&#39;ecr_image&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ECR_container_fullname</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;561241433344.dkr.ecr.us-west-2.amazonaws.com/sagemaker-rapids-higgs:22.12-cuda11.5-runtime-ubuntu18.04-py3.9&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>tag<span class="w"> </span><span class="o">{</span>estimator_info<span class="o">[</span><span class="s1">&#39;rapids_container&#39;</span><span class="o">]}</span><span class="w"> </span><span class="o">{</span>ECR_container_fullname<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;source      : </span><span class="si">{</span><span class="n">estimator_info</span><span class="p">[</span><span class="s1">&#39;rapids_container&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;destination : </span><span class="si">{</span><span class="n">ECR_container_fullname</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>source      : rapidsai/rapidsai-core:22.12-cuda11.5-runtime-ubuntu18.04-py3.9
destination : 561241433344.dkr.ecr.us-west-2.amazonaws.com/sagemaker-rapids-higgs:22.12-cuda11.5-runtime-ubuntu18.04-py3.9
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>aws<span class="w"> </span>ecr<span class="w"> </span>create-repository<span class="w"> </span>--repository-name<span class="w"> </span><span class="o">{</span>estimator_info<span class="o">[</span><span class="s1">&#39;ecr_repository&#39;</span><span class="o">]}</span>
<span class="o">!</span><span class="k">$(</span>aws<span class="w"> </span>ecr<span class="w"> </span>get-login<span class="w"> </span>--no-include-email<span class="w"> </span>--region<span class="w"> </span><span class="o">{</span>region<span class="o">}</span><span class="k">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &quot;repository&quot;: {
        &quot;repositoryArn&quot;: &quot;arn:aws:ecr:us-west-2:561241433344:repository/sagemaker-rapids-higgs&quot;,
        &quot;registryId&quot;: &quot;561241433344&quot;,
        &quot;repositoryName&quot;: &quot;sagemaker-rapids-higgs&quot;,
        &quot;repositoryUri&quot;: &quot;561241433344.dkr.ecr.us-west-2.amazonaws.com/sagemaker-rapids-higgs&quot;,
        &quot;createdAt&quot;: 1675720898.0,
        &quot;imageTagMutability&quot;: &quot;MUTABLE&quot;,
        &quot;imageScanningConfiguration&quot;: {
            &quot;scanOnPush&quot;: false
        },
        &quot;encryptionConfiguration&quot;: {
            &quot;encryptionType&quot;: &quot;AES256&quot;
        }
    }
}
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /home/ec2-user/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>push<span class="w"> </span><span class="o">{</span>ECR_container_fullname<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The push refers to repository [561241433344.dkr.ecr.us-west-2.amazonaws.com/sagemaker-rapids-higgs]

601675bf: Preparing 
a211643c: Preparing 
51d8b000: Preparing 
f7b7f229: Preparing 
48598b79: Preparing 
2b6403fc: Preparing 
ca9f5267: Preparing 
e36e26b2: Preparing 
2c4843ad: Preparing 
01675bf: Pushed   7.197GB/7.157GBPushing  46.22MB/1.823GBPushing  332.4MB/7.157GBPushing  1.682GB/7.157GBPushing  2.411GB/7.157GBPushing  3.426GB/3.649GBPushing  5.013GB/7.157GB22.12-cuda11.5-runtime-ubuntu18.04-py3.9: digest: sha256:959a2e80642e881ef99705473d95165cda8383543cff4ae5ca554da782021e47 size: 2432
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-your-amazon-sagemaker-compatible-rapids-container-locally">
<h2>Testing your Amazon SageMaker compatible RAPIDS container locally<a class="headerlink" href="#testing-your-amazon-sagemaker-compatible-rapids-container-locally" title="Permalink to this heading">#</a></h2>
<p>Before you go off and spend time and money on running a large experiment on a large cluster, you should run a local Amazon SageMaker training job to ensure the container performs as expected. Make sure you have <a class="reference external" href="https://github.com/aws/sagemaker-python-sdk#installing-the-sagemaker-python-sdk">SageMaker SDK</a> installed on your local machine.</p>
<p>Define some default hyperparameters. Take your best guess, you can find the full list of RandomForest hyperparameters on the <a class="reference external" href="https://docs.rapids.ai/api/cuml/stable/api.html#random-forest">cuML docs</a> page.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparams</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;n_bins&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;split_criterion&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># GINI:0, ENTROPY:1</span>
    <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># true: sample with replacement, false: sample without replacement</span>
    <span class="s2">&quot;max_leaves&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># unlimited leaves</span>
    <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now, specify the instance type as <code class="docutils literal notranslate"><span class="pre">local_gpu</span></code>. This assumes that you have a GPU locally. If you don’t have a local GPU, you can test this on a Amazon SageMaker managed GPU instance — simply replace <code class="docutils literal notranslate"><span class="pre">local_gpu</span></code> with with a <code class="docutils literal notranslate"><span class="pre">p3</span></code> or <code class="docutils literal notranslate"><span class="pre">p2</span></code> GPU instance by updating the <code class="docutils literal notranslate"><span class="pre">instance_type</span></code> variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.estimator</span> <span class="kn">import</span> <span class="n">Estimator</span>

<span class="n">rapids_estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">ECR_container_fullname</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">execution_role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s2">&quot;ml.p3.2xlarge&quot;</span><span class="p">,</span>  <span class="c1">#&#39;local_gpu&#39;</span>
    <span class="n">max_run</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">max_wait</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">use_spot_instances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparams</span><span class="p">,</span>
    <span class="n">metric_definitions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc&quot;</span><span class="p">,</span> <span class="s2">&quot;Regex&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc: ([0-9</span><span class="se">\\</span><span class="s2">.]+)&quot;</span><span class="p">}],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">rapids_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">s3_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:sagemaker:Creating training-job with name: sagemaker-rapids-higgs-2023-02-07-03-57-40-523
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-02-07 03:57:41 Starting - Starting the training job...
2023-02-07 03:58:10 Starting - Preparing the instances for training.........
2023-02-07 03:59:21 Downloading - Downloading input data........................
2023-02-07 04:03:38 Training - Training image download completed. Training in progress...<span class=" -Color -Color-Blue">[WARN  tini (7)] Tini is not running as PID 1 .</span>
<span class=" -Color -Color-Blue">Zombie processes will not be re-parented to Tini, so zombie reaping won&#39;t work.</span>
<span class=" -Color -Color-Blue">To fix the problem, run Tini as PID 1.</span>
<span class=" -Color -Color-Blue">This container image and its contents are governed by the NVIDIA Deep Learning Container License.</span>
<span class=" -Color -Color-Blue">By pulling and using the container, you accept the terms and conditions of this license:</span>
<span class=" -Color -Color-Blue">https://developer.download.nvidia.com/licenses/NVIDIA_Deep_Learning_Container_License.pdf</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.469 ServerApp] dask_labextension | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.470 ServerApp] jupyter_server_proxy | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[W 2023-02-07 04:03:52.472 LabApp] &#39;token&#39; has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.</span>
<span class=" -Color -Color-Blue">[W 2023-02-07 04:03:52.472 LabApp] &#39;allow_origin&#39; has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.</span>
<span class=" -Color -Color-Blue">[W 2023-02-07 04:03:52.472 LabApp] &#39;base_url&#39; has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.476 ServerApp] jupyterlab | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.476 ServerApp] jupyterlab_nvdashboard | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.480 ServerApp] nbclassic | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.481 ServerApp] Writing Jupyter server cookie secret to /root/.local/share/jupyter/runtime/jupyter_cookie_secret</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.485 ServerApp] notebook_shim | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.485 ServerApp] panel.io.jupyter_server_extension | extension was successfully linked.</span>
<span class=" -Color -Color-Blue">[W 2023-02-07 04:03:52.508 ServerApp] All authentication is disabled.  Anyone who can connect to this server will be able to run code.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.510 ServerApp] notebook_shim | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:52.511 ServerApp] dask_labextension | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.114 ServerApp] jupyter_server_proxy | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.115 LabApp] JupyterLab extension loaded from /opt/conda/envs/rapids/lib/python3.9/site-packages/jupyterlab</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.115 LabApp] JupyterLab application directory is /opt/conda/envs/rapids/share/jupyter/lab</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.119 ServerApp] jupyterlab | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[W 2023-02-07 04:03:53.119 ServerApp] jupyterlab_nvdashboard | extension failed loading with message: &#39;NoneType&#39; object is not callable</span>
<span class=" -Color -Color-Blue">[E 2023-02-07 04:03:53.119 ServerApp] jupyterlab_nvdashboard | stack trace</span>
<span class=" -Color -Color-Blue">    Traceback (most recent call last):</span>
<span class=" -Color -Color-Blue">      File &quot;/opt/conda/envs/rapids/lib/python3.9/site-packages/jupyter_server/extension/manager.py&quot;, line 355, in load_extension</span>
<span class=" -Color -Color-Blue">        extension.load_all_points(self.serverapp)</span>
<span class=" -Color -Color-Blue">      File &quot;/opt/conda/envs/rapids/lib/python3.9/site-packages/jupyter_server/extension/manager.py&quot;, line 229, in load_all_points</span>
<span class=" -Color -Color-Blue">        return [self.load_point(point_name, serverapp) for point_name in self.extension_points]</span>
<span class=" -Color -Color-Blue">      File &quot;/opt/conda/envs/rapids/lib/python3.9/site-packages/jupyter_server/extension/manager.py&quot;, line 229, in &lt;listcomp&gt;</span>
<span class=" -Color -Color-Blue">        return [self.load_point(point_name, serverapp) for point_name in self.extension_points]</span>
<span class=" -Color -Color-Blue">      File &quot;/opt/conda/envs/rapids/lib/python3.9/site-packages/jupyter_server/extension/manager.py&quot;, line 222, in load_point</span>
<span class=" -Color -Color-Blue">        return point.load(serverapp)</span>
<span class=" -Color -Color-Blue">      File &quot;/opt/conda/envs/rapids/lib/python3.9/site-packages/jupyter_server/extension/manager.py&quot;, line 148, in load</span>
<span class=" -Color -Color-Blue">        return loader(serverapp)</span>
<span class=" -Color -Color-Blue">    TypeError: &#39;NoneType&#39; object is not callable</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.123 ServerApp] nbclassic | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.124 ServerApp] panel.io.jupyter_server_extension | extension was successfully loaded.</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.125 ServerApp] Serving notebooks from local directory: /rapids/notebooks</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.125 ServerApp] Jupyter Server 1.23.3 is running at:</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.125 ServerApp] http://ip-10-0-233-172.us-west-2.compute.internal:8888/lab</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.125 ServerApp]  or http://127.0.0.1:8888/lab</span>
<span class=" -Color -Color-Blue">[I 2023-02-07 04:03:53.125 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span>
</pre></div>
</div>
</div>
</div>
<p>Congrats, you successfully trained your Random Forest model on the HIGGS dataset using an Amazon SageMaker compatible RAPIDS container. Now you are ready to run experiments on a cluster to try out different hyperparameters and options in parallel.</p>
</section>
<section id="define-hyperparameter-ranges-and-run-a-large-scale-search-experiment">
<h2>Define hyperparameter ranges and run a large-scale search experiment<a class="headerlink" href="#define-hyperparameter-ranges-and-run-a-large-scale-search-experiment" title="Permalink to this heading">#</a></h2>
<p>There’s not a whole lot of code changes required to go from local training to training at scale. First, rather than define a fixed set of hyperparameters, you’ll define a range using the SageMaker SDK:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.tuner</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IntegerParameter</span><span class="p">,</span>
    <span class="n">CategoricalParameter</span><span class="p">,</span>
    <span class="n">ContinuousParameter</span><span class="p">,</span>
    <span class="n">HyperparameterTuner</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hyperparameter_ranges</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
    <span class="s2">&quot;n_bins&quot;</span><span class="p">:</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
    <span class="s2">&quot;split_criterion&quot;</span><span class="p">:</span> <span class="n">CategoricalParameter</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="n">CategoricalParameter</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]),</span>
    <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="n">ContinuousParameter</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Next, you’ll change the instance type to the actual GPU instance you want to train on in the cloud. Here you’ll choose an Amazon SageMaker compute instance with 4 NVIDIA Tesla V100 based GPU instance — <code class="docutils literal notranslate"><span class="pre">ml.p3.8xlarge</span></code>. If you have a training script that can leverage multiple GPUs, you can choose up to 8 GPUs per instance for faster training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.estimator</span> <span class="kn">import</span> <span class="n">Estimator</span>

<span class="n">rapids_estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">ECR_container_fullname</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">execution_role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s2">&quot;ml.p3.8xlarge&quot;</span><span class="p">,</span>
    <span class="n">max_run</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">max_wait</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">use_spot_instances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparams</span><span class="p">,</span>
    <span class="n">metric_definitions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc&quot;</span><span class="p">,</span> <span class="s2">&quot;Regex&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc: ([0-9</span><span class="se">\\</span><span class="s2">.]+)&quot;</span><span class="p">}],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now you define a HyperparameterTuner object using the estimator you defined above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">HyperparameterTuner</span><span class="p">(</span>
    <span class="n">rapids_estimator</span><span class="p">,</span>
    <span class="n">objective_metric_name</span><span class="o">=</span><span class="s2">&quot;test_acc&quot;</span><span class="p">,</span>
    <span class="n">hyperparameter_ranges</span><span class="o">=</span><span class="n">hyperparameter_ranges</span><span class="p">,</span>
    <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;Bayesian&quot;</span><span class="p">,</span>
    <span class="n">max_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_parallel_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">objective_type</span><span class="o">=</span><span class="s2">&quot;Maximize&quot;</span><span class="p">,</span>
    <span class="n">metric_definitions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc&quot;</span><span class="p">,</span> <span class="s2">&quot;Regex&quot;</span><span class="p">:</span> <span class="s2">&quot;test_acc: ([0-9</span><span class="se">\\</span><span class="s2">.]+)&quot;</span><span class="p">}],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_name</span> <span class="o">=</span> <span class="s2">&quot;rapidsHPO&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S-%j&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">s3_data_dir</span><span class="p">},</span> <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:sagemaker.estimator:No finished training job found associated with this estimator. Please make sure this estimator is only used for building workflow config
INFO:sagemaker:Creating hyperparameter tuning job with name: rapidsHPO2023-02-07-16-09-47-038
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>..............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
</pre></div>
</div>
</div>
</div>
</section>
<section id="clean-up">
<h2>Clean up<a class="headerlink" href="#clean-up" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Delete S3 buckets and files you don’t need</p></li>
<li><p>Kill training jobs that you don’t want running</p></li>
<li><p>Delete container images and the repository you just created</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="n">ecr</span> <span class="n">delete</span><span class="o">-</span><span class="n">repository</span> <span class="o">--</span><span class="n">force</span> <span class="o">--</span><span class="n">repository</span><span class="o">-</span><span class="n">name</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../rapids-optuna-hpo/notebook.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Getting Started with Optuna and RAPIDS for HPO</p>
      </div>
    </a>
    <a class="right-next"
       href="../rapids-sagemaker-hpo/notebook.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deep Dive into running Hyper Parameter Optimization on AWS SageMaker</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages-and-create-amazon-sagemaker-and-boto3-sessions">Import packages and create Amazon SageMaker and Boto3 sessions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upload-the-higgs-boson-dataset-to-s3-bucket">Upload the higgs-boson dataset to s3 bucket</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-latest-rapids-container-from-dockerhub">Download latest RAPIDS container from DockerHub</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publish-to-elastic-container-registry">Publish to Elastic Container Registry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-your-amazon-sagemaker-compatible-rapids-container-locally">Testing your Amazon SageMaker compatible RAPIDS container locally</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-hyperparameter-ranges-and-run-a-large-scale-search-experiment">Define hyperparameter ranges and run a large-scale search experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clean-up">Clean up</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item"> 
<div class="tocsection onthispage">
  <i class="fa-regular fa-file"></i> Related files
</div>
<nav id="bd-toc-nav" class="page-toc related-files">
  
<ul class="visible nav section-nav flex-column">
  
  <li class="toc-h2 nav-item toc-entry">
    
    <a
      class="reference external nav-link"
      href="Dockerfile"
    >
      Dockerfile
    </a>
    
  </li>
  
  <li class="toc-h2 nav-item toc-entry">
    
    <a
      class="reference external nav-link"
      href="notebook.ipynb"
    >
      notebook.ipynb
    </a>
    
  </li>
  
  <li class="toc-h2 nav-item toc-entry">
    
    <a
      class="reference external nav-link"
      href="rapids-higgs.py"
    >
      rapids-higgs.py
    </a>
    
  </li>
  
</ul> 
  <div style="font-size: 0.9em; margin-top: 0.5em">
    <a href="all_files.zip"
      ><i class="fa-solid fa-download"></i> Download all
    </a>
  </div>
  
</nav>
</div>

  <div class="sidebar-secondary-item">
<div class="tocsection onthispage"><i class="fa-solid fa-tags"></i> Tags</div>
<nav id="bd-toc-nav" class="page-toc">
  <div class="tagwrapper">
    
    <a href="../?filters=library/cudf">
      <span class="sd-sphinx-override sd-badge">library/cudf</span>
    </a>
    
    <a href="../?filters=cloud/aws/sagemaker">
      <span class="sd-sphinx-override sd-badge">cloud/aws/sagemaker</span>
    </a>
    
    <a href="../?filters=workflow/hpo">
      <span class="sd-sphinx-override sd-badge">workflow/hpo</span>
    </a>
    
    <a href="../?filters=library/cuml">
      <span class="sd-sphinx-override sd-badge">library/cuml</span>
    </a>
    
    <a href="../?filters=library/scikit-learn">
      <span class="sd-sphinx-override sd-badge">library/scikit-learn</span>
    </a>
    
    <a href="../?filters=data-format/csv">
      <span class="sd-sphinx-override sd-badge">data-format/csv</span>
    </a>
    
    <a href="../?filters=data-storage/s3">
      <span class="sd-sphinx-override sd-badge">data-storage/s3</span>
    </a>
    
  </div>
</nav>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, NVIDIA.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>