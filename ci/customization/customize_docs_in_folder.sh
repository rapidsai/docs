#!/bin/bash
# SPDX-FileCopyrightText: Copyright (c) 2025, NVIDIA CORPORATION & AFFILIATES.
# All rights reserved.
# SPDX-License-Identifier: Apache-2.0

#######################################
# Recursively customizes all docs in a specified folder relative
# to the project's root. Intended to be run from the project's
# root directory
#
# Usage:
# customization/customize_docs_in_folder.sh api/
#
# Positional Arguments:
#   1) FOLDER_TO_CUSTOMIZE: project root relative folder to customize (i.e. api/, api/rmm, etc.)
#######################################
set -euo pipefail

display_usage() {
  echo "Usage:"
  echo " - customization/customize_docs_in_folder.sh api/       # update files in api/ folder"
  echo " - customization/customize_docs_in_folder.sh api/cudf   # update files in api/cudf folder"
}

FOLDER_TO_CUSTOMIZE=$1

if [[ $# -ne 1 ]]; then
  display_usage
  exit 1
fi

if [ ! -d "${FOLDER_TO_CUSTOMIZE}" ]; then
  echo "Couldn't find subfolder: ${FOLDER_TO_CUSTOMIZE}"
  exit 1
fi

SCRIPT_SRC_FOLDER="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )" # directory of where this script is located
JTD_SEARCH_TERM='sphinx_rtd_theme'
DOXYGEN_SEARCH_TERM='Generated by Doxygen'
PYDATA_SEARCH_TERM='pydata-sphinx-theme'

MANIFEST_FILE="./files-to-customize.txt"
grep "${JTD_SEARCH_TERM}\|${DOXYGEN_SEARCH_TERM}\|${PYDATA_SEARCH_TERM}" -rl \
  --include=\*.html \
  --exclude-dir=stable \
  --exclude-dir=nightly \
  --exclude-dir=latest \
  --exclude-dir=legacy \
  --exclude-dir=cudf-java \
  "${FOLDER_TO_CUSTOMIZE}" \
> "${MANIFEST_FILE}"

echo "Customizing $(wc -l < ${MANIFEST_FILE} | tr -d ' ') HTML files"
python -u ${SCRIPT_SRC_FOLDER}/customize_doc.py "${MANIFEST_FILE}"
echo "Done customizing"
